var version="3.0.1";var ajaxUrl="ajax.php";var TEMP={};var HROS={};HROS.CONFIG={website:"http://"+location.hostname+location.pathname,sinaweiboAppkey:"",tweiboAppkey:"",memberID:0,desk:1,dockPos:"",appXY:"",appSize:"",appButtonTop:20,appButtonLeft:20,windowIndexid:1e4,widgetIndexid:1,windowMinWidth:215,windowMinHeight:59,wallpaperState:1,wallpaper:"",wallpaperType:"",wallpaperWidth:0,wallpaperHeight:0};HROS.VAR={zoomLevel:1,isAppMoving:false,dock:"",desk1:"",desk2:"",desk3:"",desk4:"",desk5:"",folder:""};var appbtnTemp=template('<li id="<%=id%>" class="appbtn" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" top="<%=top%>" left="<%=left%>" style="top:<%=top%>px;left:<%=left%>px">'+'<div><img src="<%=imgsrc%>" alt="<%=title%>"></div>'+"<span><%=title%></span>"+"</li>");var addbtnTemp=template('<li class="appbtn add" style="top:<%=top%>px;left:<%=left%>px">'+'<i class="addicon"></i>'+"<span>添加应用</span>"+"</li>");var taskTemp=template('<a id="<%=id%>" class="task-item task-item-current" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<div class="task-item-icon">'+'<img src="<%=imgsrc%>">'+"</div>"+'<div class="task-item-txt"><%=title%></div>'+"</a>");var widgetWindowTemp=template('<div id="<%=id%>" class="widget" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" style="z-index:<%=zIndex%>;width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;right:<%=right%>px">'+'<div class="move">'+'<a class="ha-close" href="javascript:;" title="关闭"></a>'+"<% if(issetbar){ %>"+'<a class="ha-star" href="javascript:;" title="评分"></a>'+'<a class="ha-share" href="javascript:;" title="分享"></a>'+"<% } %>"+"</div>"+'<div class="frame">'+'<iframe src="<%=url%>" frameborder="0" allowtransparency="true"></iframe>'+"</div>"+"</div>");var windowTemp=template('<div id="<%=id%>" class="window-container window-current<% if(isflash){ %> window-container-flash<% } %>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="<% if(isopenmax){ %>width:100%;height:100%;left:0;top:0;<% }else{ %>width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;left:<%=left%>px;<% } %>z-index:<%=zIndex%>" ismax="<% if(isopenmax){ %>1<% }else{ %>0<% } %>">'+'<div style="height:100%">'+'<div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>"><span class="title"><%=title%></span>'+'<div class="title-handle">'+'<a class="ha-hide" btn="hide" href="javascript:;" title="最小化"><b class="hide-b"></b></a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="javascript:;" title="最大化" <% if(isopenmax){ %>style="display:none"<% } %>><b class="max-b"></b></a>'+'<a class="ha-revert" btn="revert" href="javascript:;" title="还原" <% if(!isopenmax){ %>style="display:none"<% } %>><b class="revert-b"></b><b class="revert-t"></b></a>'+"<% } %>"+"<% if(istitlebarFullscreen){ %>"+'<a class="ha-fullscreen" btn="fullscreen" href="javascript:;" title="全屏">+</a>'+"<% } %>"+'<a class="ha-close" btn="close" href="javascript:;" title="关闭">×</a>'+"</div>"+"</div>"+'<div class="window-frame">'+"<% if(isflash){ %>"+'<div class="window-mask"><div class="maskbg"></div><div>运行中，点击恢复显示 :)</div></div>'+"<% }else{ %>"+'<div class="window-mask window-mask-noflash"></div>'+"<% } %>"+'<div class="window-loading"></div>'+'<iframe id="<%=id%>_iframe" frameborder="0" src="<%=url%>"></iframe>'+"</div>"+'<div class="set-bar"><div class="fr">'+"<% if(issetbar){ %>"+'<a class="btn share"><i class="icon icon104"></i><span class="btn-con">分享</span></a>'+'<a class="btn star"><i class="icon icon177"></i><span class="btn-con">评分</span></a>'+'<a class="btn detail"><i class="icon icon120"></i><span class="btn-con">详情</span></a>'+"<% } %>"+'<a class="btn refresh"><i class="icon icon158"></i><span class="btn-con">刷新</span></a>'+"</div></div>"+"</div>"+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"></div>'+'<div class="window-resize window-resize-r" resize="r"></div>'+'<div class="window-resize window-resize-b" resize="b"></div>'+'<div class="window-resize window-resize-l" resize="l"></div>'+'<div class="window-resize window-resize-rt" resize="rt"></div>'+'<div class="window-resize window-resize-rb" resize="rb"></div>'+'<div class="window-resize window-resize-lt" resize="lt"></div>'+'<div class="window-resize window-resize-lb" resize="lb"></div>'+"<% } %>"+"</div>");var folderWindowTemp=template('<div id="<%=id%>" class="folder-window window-container window-current" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;left:<%=left%>px;z-index:<%=zIndex%>">'+'<div style="height:100%">'+'<div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>"><span class="title"><%=title%></span>'+'<div class="title-handle">'+'<a class="ha-hide" btn="hide" href="javascript:;" title="最小化"><b class="hide-b"></b></a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="javascript:;" title="最大化"><b class="max-b"></b></a>'+'<a class="ha-revert" btn="revert" href="javascript:;" title="还原" style="display:none"><b class="revert-b"></b><b class="revert-t"></b></a>'+"<% } %>"+'<a class="ha-close" btn="close" href="javascript:;" title="关闭">×</a>'+"</div>"+"</div>"+'<div class="window-frame">'+'<div class="folder_body"></div>'+"</div>"+'<div class="set-bar"><div class="fr">'+'<a class="btn refresh"><i class="icon icon158"></i><span class="btn-con">刷新</span></a>'+"</div></div>"+"</div>"+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"></div>'+'<div class="window-resize window-resize-r" resize="r"></div>'+'<div class="window-resize window-resize-b" resize="b"></div>'+'<div class="window-resize window-resize-l" resize="l"></div>'+'<div class="window-resize window-resize-rt" resize="rt"></div>'+'<div class="window-resize window-resize-rb" resize="rb"></div>'+'<div class="window-resize window-resize-lt" resize="lt"></div>'+'<div class="window-resize window-resize-lb" resize="lb"></div>'+"<% } %>"+"</div>");var folderViewTemp=template('<div id="<%=id%>" class="quick_view_container" appid="<%=appid%>" realappid="<%=realappid%>" style="top:<%=top%>px;left:<%=left%>px">'+'<div class="perfect_nine_box">'+'<div class="perfect_nine_t">'+'<div class="perfect_nine_t_m"></div>'+"</div>"+'<span class="perfect_nine_t_l"></span>'+'<span class="perfect_nine_t_r"></span>'+'<div class="perfect_nine_middle">'+'<span class="perfect_nine_m_l">'+'<div class="perfect_nine_m_l_t" style="top:0px;height:<%=mlt%>px"></div>'+'<div class="perfect_nine_m_l_m" style="top:<%=mlt%>px;height:20px;display:<% if(mlm){ %>block<% }else{ %>none<% } %>"></div>'+'<div class="perfect_nine_m_l_b" style="top:<% if(mlm){ %><%=mlt+20%><% }else{ %><%=mlt%><% } %>px;height:<%=mlb%>px"></div>'+"</span>"+'<span class="perfect_nine_m_r">'+'<div class="perfect_nine_m_r_t" style="top:0px;height:<%=mrt%>px"></div>'+'<div class="perfect_nine_m_r_m" style="top:<%=mrt%>px;height:20px;display:<% if(mrm){ %>block<% }else{ %>none<% } %>"></div>'+'<div class="perfect_nine_m_r_b" style="top:<% if(mrm){ %><%=mrt+20%><% }else{ %><%=mrt%><% } %>px;height:<%=mrb%>px"></div>'+"</span>"+'<div class="perfect_nine_context">'+'<div class="quick_view_container_control">'+'<a href="javascript:;" class="quick_view_container_open">打开</a>'+"</div>"+'<div class="quick_view_container_list folder-window" id="quick_view_container_list_<%=appid%>" realid="<%=appid%>">'+'<div class="quick_view_container_list_in" id="quick_view_container_list_in_<%=appid%>" style="height:<%=height%>px">'+"<%==apps%>"+"</div>"+'<div class="scrollBar"></div>'+'<div class="scrollBar_bgc"></div>'+"</div>"+"</div>"+"</div>"+'<div class="perfect_nine_b">'+'<div class="perfect_nine_b_m"></div>'+"</div>"+'<span class="perfect_nine_b_l"></span>'+'<span class="perfect_nine_b_r"></span>'+"</div>"+"</div>");var suggestTemp=template('<li class="resultList" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<a href="javascript:;"><div><%=name%></div></a>'+"</li>");var editFolderDialogTemp=template('<div id="addfolder">'+'<a class="folderSelector"><img src="<%=src%>"></a>'+'<div class="folderNameTxt">请输入文件夹名称：</div>'+'<div class="folderInput"><input type="text" class="folderName" id="folderName" value="<%=name%>"></div>'+'<div class="folderNameError">文件夹名称不能只包含空字符</div>'+'<div class="fcDropdown">'+'<a class="fcDropdown_item" title="默认"><img class="fcDropdown_img" src="img/ui/folder_default.png"></a>'+'<a class="fcDropdown_item" title="文本"><img class="fcDropdown_img" src="img/ui/folder_doc.png"></a>'+'<a class="fcDropdown_item" title="游戏"><img class="fcDropdown_img" src="img/ui/folder_game.png"></a>'+'<a class="fcDropdown_item" title="生活"><img class="fcDropdown_img" src="img/ui/folder_life.png"></a>'+'<a class="fcDropdown_item" title="音乐"><img class="fcDropdown_img" src="img/ui/folder_music.png"></a>'+'<a class="fcDropdown_item" title="工具"><img class="fcDropdown_img" src="img/ui/folder_tool.png"></a>'+'<a class="fcDropdown_item" title="视频"><img class="fcDropdown_img" src="img/ui/folder_video.png"></a>'+"</div>"+"</div>");var starDialogTemp=template('<div id="star">'+'<div class="grade-box">'+'<div class="star-num"><%=point%></div>'+'<div class="star-box">'+"<div>打分：</div>"+'<i style="width:<%=realpoint%>%"></i>'+"<ul>"+'<li class="grade-1" num="1"><a href="javascript:;"><em>很不好用</em></a></li>'+'<li class="grade-2" num="2"><a href="javascript:;"><em>体验一般般</em></a></li>'+'<li class="grade-3" num="3"><a href="javascript:;"><em>比较好用</em></a></li>'+'<li class="grade-4" num="4"><a href="javascript:;"><em>很好用</em></a></li>'+'<li class="grade-5" num="5"><a href="javascript:;"><em>棒极了，推荐</em></a></li>'+"</ul>"+"</div>"+"</div>"+"</div>");var shareDialogTemp=template('<div id="share">'+'<a class="tsina" href="http://service.weibo.com/share/share.php?title=<%=title%>&url=<%=url%>&searchPic=true&appkey=<%=sinaweiboAppkey%>" target="_blank">新浪微博</a>'+'<a class="tqq" href="http://v.t.qq.com/share/share.php?title=<%=title%>&url=<%=url%>&appkey=<%=tweiboAppkey%>" target="_blank">腾讯微博</a>'+'<a class="tsohu" href="http://t.sohu.com/third/post.jsp?url=<%=url%>&title=<%=title%>&content=utf-8" target="_blank">搜狐微博</a>'+'<a class="twangyi" href="http://t.163.com/article/user/checkLogin.do?info=<%=title%>+<%=url%>" target="_blank">网易微博</a>'+'<a class="qzone" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=<%=url%>&title=<%=title%>" target="_blank">QQ空间</a>'+'<a class="renren" href="http://share.renren.com/share/buttonshare.do?link=<%=url%>&title=<%=title%>" target="_blank">人人网</a>'+'<a class="baidu" href="http://cang.baidu.com/do/add?it=<%=title%>&iu=<%=url%>" target="_blank">百度收藏</a>'+'<a class="douban" href="http://shuo.douban.com/!service/share?image=&href=<%=url%>&name=<%=title%>" target="_blank">豆瓣</a>'+"</div>");var uploadFileDialogTemp=template('<div id="uploadfilebtnbox">'+'请选择文件<input type="file" name="xfile[]" id="uploadfilebtn" />'+"</div>"+'<div id="uploadfile"><%=list%></div>');var uploadFileDialogListTemp=template("<% for(var i = 0; i < list.length; i++){ %>"+'<div class="filelist">'+'<div class="name" title="<%=list[i].name%>"><div style="width:10000px"><%=list[i].name%></div></div>'+'<div class="size"><%=list[i].size%></div>'+'<div class="do">[&nbsp;<a href="javascript:;" class="del">删</a>&nbsp;]</div>'+'<div class="progress"></div>'+"</div>"+"<% } %>");var helpTemp=template('<div id="help">'+'<a href="javascript:;" class="close" title="关闭新手帮助">×</a>'+'<div id="step1" class="step" step="1" style="position:relative;left:50%;top:50%;margin-left:-160px;margin-top:-60px;width:280px;height:100px">'+'<p style="text-align:center">'+'<span class="h2">欢迎使用HoorayOS</span>'+"<br>下面我会简单介绍下如何使用，以便你快速上手<br>"+'<a href="javascript:;" class="next">下一步</a>'+"</p>"+"</div>"+'<div id="step2" class="step" step="2" style="top:90px;left:140px;width:250px">'+'<b class="jt jt_left" style="left:-40px;top:20px"></b>'+"<p>"+'<span class="h1">①</span><span class="h2">桌面</span>'+"<br>可以在应用中心添加自己需要的应用到桌面<br>"+'<a href="javascript:;" class="next">下一步</a>'+"</p>"+"</div>"+'<div id="step3" class="step" step="3" style="top:90px;left:50%;margin-left:-125px;width:250px">'+'<b class="jt jt_top" style="top:-40px;left:30px"></b>'+"<p>"+'<span class="h1">②</span><span class="h2">应用码头</span>'+"<br>可以将桌面应用拖放到这<br>"+'<a href="javascript:;" class="next">下一步</a>'+"</p>"+"</div>"+'<div id="step4" class="step" step="4" style="top:130px;left:50%;margin-left:-125px;width:250px">'+'<b class="jt jt_top" style="top:-40px;left:30px"></b>'+"<p>"+'<span class="h1">③</span><span class="h2">翻页导航</span>'+"<br>可以快速切换当前桌面<br>"+'<a href="javascript:;" class="next">下一步</a>'+"</p>"+"</div>"+'<div id="step5" class="step" step="5" style="bottom:50px;left:50%;margin-left:-125px;width:250px">'+'<b class="jt jt_bottom" style="bottom:-40px;left:30px"></b>'+"<p>"+'<span class="h1">④</span><span class="h2">任务栏</span>'+"<br>这个就不用我介绍了吧 =)<br>"+'<a href="javascript:;" class="over">&nbsp;完&nbsp;成&nbsp;</a>'+"</p>"+"</div>"+"</div>");HROS.app=function(){return{init:function(){$("#desk").on("click","li.add",function(){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php",width:800,height:484,isflash:false})});HROS.app.move();HROS.app.moveScrollbar();$("body").on("contextmenu",".appbtn:not(.add)",function(e){HROS.popupMenu.hide();var t;switch($(this).attr("type")){case"app":case"widget":t=HROS.popupMenu.app($(this));break;case"papp":case"pwidget":t=HROS.popupMenu.papp($(this));break;case"folder":t=HROS.popupMenu.folder($(this));break}var i=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var a=$(window).height()-e.clientY<t.height()?e.clientY-t.height():e.clientY;t.css({left:i,top:a}).show();return false});HROS.app.get()},updateXY:function(e){if(HROS.CONFIG.appXY!=e){HROS.CONFIG.appXY=e;HROS.deskTop.appresize();if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setAppXY&appxy="+e})}}},updateSize:function(e){if(HROS.CONFIG.appSize!=e){HROS.CONFIG.appSize=e;HROS.deskTop.appresize();if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setAppSize&appsize="+e})}}},get:function(){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getMyApp",beforeSend:function(){HROS.VAR.isAppMoving=true}}).done(function(e){HROS.VAR.isAppMoving=false;e=$.parseJSON(e);HROS.VAR.dock=e["dock"];HROS.VAR.desk1=e["desk1"];HROS.VAR.desk2=e["desk2"];HROS.VAR.desk3=e["desk3"];HROS.VAR.desk4=e["desk4"];HROS.VAR.desk5=e["desk5"];HROS.VAR.folder=e["folder"];HROS.app.set()})},set:function(){if($("#desktop").css("display")!=="none"){switch(HROS.CONFIG.appSize){case"s":$("#desk").removeClass("smallIcon").addClass("smallIcon");break;case"m":$("#desk").removeClass("smallIcon");break}var grid=HROS.grid.getAppGrid(),dockGrid=HROS.grid.getDockAppGrid();if(HROS.VAR.dock!=""){var dock_append="";$(HROS.VAR.dock).each(function(e){dock_append+=appbtnTemp({top:dockGrid[e]["startY"],left:dockGrid[e]["startX"],title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon})});$("#dock-bar .dock-applist").html("").append(dock_append)}else{$("#dock-bar .dock-applist").html("")}for(var j=1;j<=5;j++){var desk_append="",desk=eval("HROS.VAR.desk"+j);if(desk!=""){$(desk).each(function(e){desk_append+=appbtnTemp({top:grid[e]["startY"]+7,left:grid[e]["startX"]+16,title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon})})}desk_append+=addbtnTemp({top:grid[desk.length]["startY"]+7,left:grid[desk.length]["startX"]+16});$("#desk-"+j+" li").remove();$("#desk-"+j+" .desktop-apps-container").append(desk_append)}HROS.deskTop.appresize();HROS.folderView.resize();$("#desk .folder-window").each(function(){HROS.window.updateFolder($(this).attr("appid"))});HROS.app.getScrollbar()}else{HROS.appmanage.getScrollbar()}},add:function(e,t){function i(){t&&t()}if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addMyApp&id="+e+"&desk="+HROS.CONFIG.desk}).done(function(e){i()})}else{i()}},remove:function(e,t){function i(){HROS.widget.removeCookie(e);t&&t()}if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=delMyApp&id="+e}).done(function(e){i()})}else{i()}},move:function(){$("#dock-bar .dock-applist").on("mousedown","li",function(e){e.preventDefault();e.stopPropagation();if(e.button==0||e.button==1){var t=$(this),i,a,o,s,n,p,r,d=$('<li id="shortcut_shadow">'+t.html()+"</li>");n=o=e.clientX;p=s=e.clientY;i=n-t.offset().left;a=p-t.offset().top;$(document).on("mousemove",function(e){$("body").append(d);r=HROS.maskBox.desk();r.show();o=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;_l=o-i;_t=s-a;if(n!=o||p!=s){d.css({left:_l,top:_t}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");d.remove();if(typeof r!=="undefined"){r.hide()}if(n==o&&p==s){switch(t.attr("type")){case"app":case"papp":HROS.window.create(t.attr("realappid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("realappid"),t.attr("type"));break;case"folder":HROS.folderView.get(t);break}return false}var e=HROS.grid.searchFolderGrid(o,s);if(e!=null){if(t.hasClass("folder")==false){var i=t.attr("appid"),a=t.index(),l=e;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToFolder(i,a,l)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-folder&id="+i+"&from="+a+"&to="+l}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToFolder(i,a,l)}}}else{var c,f;var h=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(t);var u=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(t);var m=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var w=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;f=HROS.grid.searchDockAppGrid(o-m,s-w);if(f!=null){if(f!=t.index()){var i=t.attr("appid"),a=t.index(),l=f;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDock(i,a,l)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-dock&id="+i+"&from="+a+"&to="+l}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDock(i,a,l)}}}else{var k=HROS.CONFIG.dockPos=="left"?73:0,v=HROS.CONFIG.dockPos=="top"?73:0;var g=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),O=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();c=HROS.grid.searchAppGrid(o-k+g,s-v+O);if(c!=null){var i=t.attr("appid"),a=t.index(),l=c+1,R=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDesk(i,a,l,R)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-desk&id="+i+"&from="+a+"&to="+l+"&desk="+R}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDesk(i,a,l,R)}}}}})}});$("#desktop .desktop-apps-container").on("mousedown","li:not(.add)",function(e){e.preventDefault();e.stopPropagation();if(e.button==0||e.button==1){var t=$(this),i,a,o,s,n,p,r,d=$('<li id="shortcut_shadow">'+t.html()+"</li>");n=o=e.clientX;p=s=e.clientY;i=n-t.offset().left;a=p-t.offset().top;$(document).on("mousemove",function(e){$("body").append(d);r=HROS.maskBox.desk();r.show();o=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;_l=o-i;_t=s-a;if(n!=o||p!=s){d.css({left:_l,top:_t}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");d.remove();if(typeof r!=="undefined"){r.hide()}if(n==o&&p==s){switch(t.attr("type")){case"app":case"papp":HROS.window.create(t.attr("realappid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("realappid"),t.attr("type"));break;case"folder":HROS.folderView.get(t);break}return false}var e=HROS.grid.searchFolderGrid(o,s);if(e!=null){if(t.attr("type")!="folder"){var i=t.attr("appid"),a=t.index(),l=e,c=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToFolder(i,a,l,c)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-folder&id="+i+"&from="+a+"&to="+l+"&desk="+c}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToFolder(i,a,l,c)}}}else{var f,h;var u=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(t);var m=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(t);var w=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var k=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;h=HROS.grid.searchDockAppGrid(o-w,s-k);if(h!=null){var i=t.attr("appid"),a=t.index(),l=h+1,c=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDock(i,a,l,c)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-dock&id="+i+"&from="+a+"&to="+l+"&desk="+c}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDock(i,a,l,c)}}else{var v=HROS.CONFIG.dockPos=="left"?73:0,g=HROS.CONFIG.dockPos=="top"?73:0;var O=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),R=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();f=HROS.grid.searchAppGrid(o-v+O,s-g+R);if(f!=null&&f!=t.index()){var i=t.attr("appid"),a=t.index(),l=f,c=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDesk(i,a,l,c)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-desk&id="+i+"&from="+a+"&to="+l+"&desk="+c}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDesk(i,a,l,c)}}}}})}});$("body").on("mousedown",".folder_body li, .quick_view_container li",function(e){e.preventDefault();e.stopPropagation();if(e.button==0||e.button==1){var t=$(this),i,a,o,s,n,p,r,d=$('<li id="shortcut_shadow">'+t.html()+"</li>");n=o=e.clientX;p=s=e.clientY;i=n-t.offset().left;a=p-t.offset().top;$(document).on("mousemove",function(e){$("body").append(d);r=HROS.maskBox.desk();r.show();o=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;_l=o-i;_t=s-a;if(n!=o||p!=s){d.css({left:_l,top:_t}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");d.remove();if(typeof r!=="undefined"){r.hide()}if(n==o&&p==s){switch(t.attr("type")){case"app":case"papp":HROS.window.create(t.attr("realappid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("realappid"),t.attr("type"));break}return false}var e=HROS.grid.searchFolderGrid(o,s);if(e!=null){if(t.parents(".folder-window").attr("appid")!=e){var i=t.attr("appid"),a=t.index(),l=e,c=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToFolder(i,a,l,c)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-folder&id="+i+"&from="+a+"&to="+l}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToFolder(i,a,l,c)}}}else{var f,h;var u=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(t);var m=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(t);var w=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var k=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;h=HROS.grid.searchDockAppGrid(o-w,s-k);if(h!=null){var i=t.attr("appid"),a=t.index(),l=h+1,c=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid"),v=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToDock(i,a,l,c,v)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-dock&id="+i+"&to="+a+"&desk="+v}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToDock(i,a,l,c,v)}}else{var g=HROS.CONFIG.dockPos=="left"?73:0,O=HROS.CONFIG.dockPos=="top"?73:0;var R=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),S=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();f=HROS.grid.searchAppGrid(o-g+R,s-O+S);if(f!=null){var i=t.attr("appid"),a=t.index(),l=f+1,c=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid"),v=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToDesk(i,a,l,c,v)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-desk&id="+i+"&to="+l+"&desk="+v}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToDesk(i,a,l,c,v)}}}}})}})},getScrollbar:function(){setTimeout(function(){$("#desk .desktop-container").each(function(){var e=$(this).children(".desktop-apps-container"),t=$(this).children(".scrollbar");var i=e.nextAll(".scrollbar-x").position().left,a=e.nextAll(".scrollbar-y").position().top;t.hide();e.scrollLeft(0).scrollTop(0);if(HROS.CONFIG.appXY=="x"){var o=parseInt(e.children(".add").css("top"))+108;if(e.height()/o<1){e.nextAll(".scrollbar-y").height(e.height()/o*e.height());a=a+e.nextAll(".scrollbar-y").height()>e.height()?e.height()-e.nextAll(".scrollbar-y").height():a;e.nextAll(".scrollbar-y").css("top",a).show();e.scrollTop(a/e.height()*o)}}else{var s=parseInt(e.children(".add").css("left"))+106;if(e.width()/s<1){e.nextAll(".scrollbar-x").width(e.width()/s*e.width());i=i+e.nextAll(".scrollbar-x").width()>e.width()?e.width()-e.nextAll(".scrollbar-w").width():i;e.nextAll(".scrollbar-x").css("left",i).show();e.scrollLeft(i/e.width()*s)}}})},500)},moveScrollbar:function(){$("#desk .scrollbar").on("mousedown",function(e){var t,i,a,o,s,n,p,r;var d=$(this),l=d.prevAll(".desktop-apps-container");s=parseInt(l.children(".add").css("left"))+106;n=parseInt(l.children(".add").css("top"))+108;p=l.width()-d.width();r=l.height()-d.height();if(d.hasClass("scrollbar-x")){t=e.clientX-d.position().left}else{i=e.clientY-d.position().top}$(document).on("mousemove",function(e){if(d.hasClass("scrollbar-x")){a=e.clientX-t<0?0:e.clientX-t>p?p:e.clientX-t;d.css("left",a);l.scrollLeft(a/l.width()*s)}else{o=e.clientY-i<0?0:e.clientY-i>r?r:e.clientY-i;d.css("top",o);l.scrollTop(o/l.height()*n)}}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});for(var e=1;e<=5;e++){$("#desk-"+e).on("mousewheel",function(e,t){var i=$(this).find(".desktop-apps-container");if(HROS.CONFIG.appXY=="x"){var a=parseInt(i.find(".add").css("top"))+108,o;if(t<0){o=i.scrollTop()+200>a-i.height()?a-i.height():i.scrollTop()+200}else{o=i.scrollTop()-200<0?0:i.scrollTop()-200}i.stop(false,true).animate({scrollTop:o},300);i.nextAll(".scrollbar-y").stop(false,true).animate({top:o/a*i.height()},300)}else{var s=parseInt(i.find(".add").css("left"))+106,n;if(t<0){n=i.scrollLeft()+200>s-i.width()?s-i.width():i.scrollLeft()+200}else{n=i.scrollLeft()-200<0?0:i.scrollLeft()-200}i.stop(false,true).animate({scrollLeft:n},300);i.nextAll(".scrollbar-x").stop(false,true).animate({left:n/s*i.width()},300)}})}},checkIsMoving:function(){var e=false;if(HROS.VAR.isAppMoving){$.dialog({title:"温馨提示",icon:"warning",content:"数据正在处理中，请稍后。",ok:true});e=true}else{HROS.VAR.isAppMoving=true}return e},dataWarning:function(){$.dialog({title:"温馨提示",icon:"warning",content:"数据错误，请刷新后重试。",ok:true})},dataDockToFolder:function(e,t,i){var a=false;$(HROS.VAR.dock).each(function(t){if(this.appid==e){$(HROS.VAR.folder).each(function(e){if(this.appid==i){HROS.VAR.folder[e].apps.push(HROS.VAR.dock[t]);HROS.VAR.folder[e].apps=HROS.VAR.folder[e].apps.sortBy(function(e){return e.appid},true);HROS.VAR.dock.splice(t,1);a=true;return false}});return false}});if(a){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return a},dataDockToDock:function(e,t,i){var a=false;if(t>i){if(HROS.VAR.dock[t]!=null){HROS.VAR.dock.splice(i,0,HROS.VAR.dock[t]);HROS.VAR.dock.splice(t+1,1);a=true}}else if(t<i){if(HROS.VAR.dock[i]!=null){HROS.VAR.dock.splice(i+1,0,HROS.VAR.dock[t]);HROS.VAR.dock.splice(t,1);a=true}}if(a){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return a},dataDockToDesk:function(id,from,to,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(HROS.VAR.dock[from]!=null){desk.splice(to,0,HROS.VAR.dock[from]);HROS.VAR.dock.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDockToOtherdesk:function(id,from,todesk){var rtn=false;todesk=eval("HROS.VAR.desk"+todesk);if(HROS.VAR.dock[from]!=null){todesk.push(HROS.VAR.dock[from]);HROS.VAR.dock.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDockToDelete:function(e,t){var i=false;if(HROS.VAR.dock[t]!=null){HROS.VAR.dock.splice(t,1);i=true}if(i){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return i},dataDeskToFolder:function(id,from,to,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==to&&desk[from]!=null){HROS.VAR.folder[e].apps.push(desk[from]);HROS.VAR.folder[e].apps=HROS.VAR.folder[e].apps.sortBy(function(e){return e.appid},true);desk.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToDock:function(id,from,to,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(desk[from]!=null){HROS.VAR.dock.splice(to,0,desk[from]);desk.splice(from,1);if(HROS.VAR.dock.length>7){desk.push(HROS.VAR.dock[7]);HROS.VAR.dock.splice(7,1)}rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToDesk:function(id,from,to,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(from>to){if(desk[from]!=null){desk.splice(to,0,desk[from]);desk.splice(from+1,1);rtn=true}}else if(from<to){if(desk[to]!=null){desk.splice(to+1,0,desk[from]);desk.splice(from,1);rtn=true}}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToOtherdesk:function(id,from,to,todesk,fromdesk){var rtn=false;fromdesk=eval("HROS.VAR.desk"+fromdesk);todesk=eval("HROS.VAR.desk"+todesk);if(fromdesk[from]!=null){if(to!=-1){todesk.splice(to,0,fromdesk[from])}else{todesk.push(fromdesk[from])}fromdesk.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToFolder:function(e,t,i,a){var o=false,s=0,n,p;$(HROS.VAR.folder).each(function(e){if(this.appid==a&&HROS.VAR.folder[e].apps[t]!=null){n=e;s+=1}if(this.appid==i){p=e;s+=1}});if(s==2){HROS.VAR.folder[p].apps.push(HROS.VAR.folder[n].apps[t]);HROS.VAR.folder[p].apps=HROS.VAR.folder[p].apps.sortBy(function(e){return e.appid},true);HROS.VAR.folder[n].apps.splice(t,1);o=true}if(o){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return o},dataFolderToDock:function(id,from,to,fromFolderId,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){HROS.VAR.dock.splice(to,0,HROS.VAR.folder[e].apps[from]);
HROS.VAR.folder[e].apps.splice(from,1);if(HROS.VAR.dock.length>7){desk.push(HROS.VAR.dock[7]);HROS.VAR.dock(7,1)}rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToDesk:function(id,from,to,fromFolderId,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){desk.splice(to,0,HROS.VAR.folder[e].apps[from]);HROS.VAR.folder[e].apps.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToOtherdesk:function(id,from,todesk,fromFolderId){var rtn=false;todesk=eval("HROS.VAR.desk"+todesk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){todesk.push(HROS.VAR.folder[e].apps[from]);HROS.VAR.folder[e].apps.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataAllDockToDesk:function(desk){desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.dock).each(function(e){desk.push(HROS.VAR.dock[e])});HROS.VAR.dock.splice(0,HROS.VAR.dock.length)},dataDeleteByAppid:function(appid){$(HROS.VAR.dock).each(function(e){if(this.appid==appid){HROS.VAR.dock.splice(e,1);return false}});for(var i=1;i<=5;i++){var desk=eval("HROS.VAR.desk"+i);$(desk).each(function(e){if(this.appid==appid){desk.splice(e,1);if(this.type=="folder"){$(HROS.VAR.folder).each(function(e){if(this.appid==appid){HROS.VAR.folder.splice(e,1);return false}})}return false}})}$(HROS.VAR.folder).each(function(e){$(this.apps).each(function(t){if(this.appid==appid){HROS.VAR.folder[e].apps.splice(t,1);return false}})})}}}();HROS.appmanage=function(){return{init:function(){$("#appmanage .amg_close").off("click").on("click",function(){HROS.appmanage.close()});$("#amg_folder_container").on("contextmenu",".appbtn",function(){return false});HROS.appmanage.move();HROS.appmanage.moveScrollbar()},set:function(){$("#desktop").hide();$("#appmanage").show();$("#amg_folder_container .folderItem").show().addClass("folderItem_turn");$("#amg_folder_container .folderInner").height($(window).height()-80);var dock_append="";if(HROS.VAR.dock!=""){var manageDockGrid=HROS.grid.getManageDockAppGrid();$(HROS.VAR.dock).each(function(e){dock_append+=appbtnTemp({top:10,left:manageDockGrid[e]["startX"],title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon})})}$("#amg_dock_container").html(dock_append);for(var j=0;j<5;j++){var desk_append="",desk=eval("HROS.VAR.desk"+(j+1));var manageAppGrid=HROS.grid.getManageAppGrid();if(desk!=""){$(desk).each(function(e){desk_append+=appbtnTemp({top:manageAppGrid[e]["startY"],left:0,title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon})})}$("#amg_folder_container .folderItem:eq("+j+") .folderInner").html(desk_append)}HROS.appmanage.getScrollbar()},move:function(){$("#amg_dock_container").on("mousedown","li",function(e){e.preventDefault();e.stopPropagation();if(e.button==0||e.button==1){var t=$(this),i,a,o,s,n,p,r,d=$('<li id="shortcut_shadow">'+t.html()+"</li>");n=o=e.clientX;p=s=e.clientY;i=n-t.offset().left;a=p-t.offset().top;$(document).on("mousemove",function(e){$("body").append(d);r=HROS.maskBox.desk();r.show();o=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;_l=o-i;_t=s-a;if(n!=o||p!=s){d.css({left:_l,top:_t}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");d.remove();if(typeof r!=="undefined"){r.hide()}if(n==o&&p==s){HROS.appmanage.close();switch(t.attr("type")){case"widget":case"pwidget":HROS.widget.create(t.attr("realappid"),t.attr("type"));break;case"app":case"papp":case"folder":HROS.window.create(t.attr("realappid"),t.attr("type"));break}return false}var e,i;if(s<=80){var a=$("#amg_dock_container li").length-1;i=HROS.grid.searchManageDockAppGrid(o);i=i>a?a:i;if(i!=t.index()){var l=t.attr("appid"),c=t.index(),f=i;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDock(l,c,f)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-dock&id="+l+"&from="+c+"&to="+f}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDock(l,c,f)}}}else{var h=parseInt(o/($(window).width()/5));var a=$("#amg_folder_container .folderItem:eq("+h+") .folderInner li").length-1;e=HROS.grid.searchManageAppGrid(s-80+$("#amg_folder_container .folderItem:eq("+h+") .folderInner").scrollTop());e=e>a?a:e;var l=t.attr("appid"),c=t.index(),f=e+1,u=h+1;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDesk(l,c,f,u)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-desk&id="+l+"&from="+c+"&to="+f+"&desk="+u}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDesk(l,c,f,u)}}})}return false});$("#amg_folder_container").on("mousedown","li.appbtn:not(.add)",function(e){e.preventDefault();e.stopPropagation();if(e.button==0||e.button==1){var t=$(this),i,a,o,s,n,p,r,d=$('<li id="shortcut_shadow2">'+t.html()+"</li>");n=o=e.clientX;p=s=e.clientY;i=n-t.offset().left;a=p-t.offset().top;$(document).on("mousemove",function(e){$("body").append(d);r=HROS.maskBox.desk();r.show();o=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;_l=o-i;_t=s-a;if(n!=o||p!=s){d.css({left:_l,top:_t}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");d.remove();if(typeof r!=="undefined"){r.hide()}if(n==o&&p==s){HROS.appmanage.close();switch(t.attr("type")){case"widget":case"pwidget":HROS.widget.create(t.attr("realappid"),t.attr("type"));break;case"app":case"papp":case"folder":HROS.window.create(t.attr("realappid"),t.attr("type"));break}return false}var e,i;if(s<=80){function a(){var e=$("#amg_dock_container li").length-1;i=HROS.grid.searchManageDockAppGrid(o);i=i>e?e:i;var a=t.attr("appid"),s=t.index(),n=i+1,p=t.parent().attr("desk");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDock(a,s,n,p)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-dock&id="+a+"&from="+s+"&to="+n+"&desk="+p}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDock(a,s,n,p)}}if(HROS.CONFIG.dockPos=="none"){$.dialog({title:"温馨提示",icon:"warning",content:"当前应用码头处于停用状态，是否开启？",ok:function(){HROS.dock.updatePos("top");a()},cancel:true})}else{a()}}else{var l=parseInt(o/($(window).width()/5));var c=$("#amg_folder_container .folderItem:eq("+l+") .folderInner li").length-1;e=HROS.grid.searchManageAppGrid(s-80+$("#amg_folder_container .folderItem:eq("+l+") .folderInner").scrollTop());if(l+1==t.parent().attr("desk")){e=e>c?c:e;if(e!=t.index()){var f=t.attr("appid"),h=t.index(),u=e,m=l+1;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDesk(f,h,u,m)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-desk&id="+f+"&from="+h+"&to="+u+"&desk="+m}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDesk(f,h,u,m)}}}else{e=e>c?c:e;var f=t.attr("appid"),h=t.index(),u=e,w=l+1,k=t.parent().attr("desk");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToOtherdesk(f,h,u,w,k)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-otherdesk&id="+f+"&from="+h+"&to="+u+"&fromdesk="+k+"&todesk="+w}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToOtherdesk(f,h,u,w,k)}}}})}return false})},getScrollbar:function(){$("#amg_folder_container .folderInner").height($(window).height()-80);$("#amg_folder_container .folderItem").each(function(){var e=$(this).find(".folderInner"),t=parseInt(e.children(".appbtn:last").css("top"))+41,i=e.next(".scrollBar");var a=i.position().top;i.hide();e.scrollTop(0);if(e.height()/t<1){i.height(e.height()/t*e.height());a=a+i.height()>e.height()?e.height()-i.height():a;i.css("top",a).show();e.scrollTop(a/e.height()*t)}})},moveScrollbar:function(){$(".scrollBar").on("mousedown",function(e){var t,i,a,o;var s=$(this),n=s.prev(".folderInner");a=parseInt(n.children(".appbtn:last").css("top"))+41;o=n.height()-s.height();t=e.clientY-s.offset().top;$(document).on("mousemove",function(e){i=e.clientY-t-80<0?0:e.clientY-t-80>o?o:e.clientY-t-80;s.css("top",i);n.scrollTop(i/n.height()*a)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("#amg_folder_container .folderInner").on("mousewheel",function(e,t){var i=$(this),a=parseInt(i.children(".appbtn:last").css("top"))+41,o;if(t<0){o=i.scrollTop()+120>a-i.height()?a-i.height():i.scrollTop()+120}else{o=i.scrollTop()-120<0?0:i.scrollTop()-120}i.stop(false,true).animate({scrollTop:o},300);i.next(".scrollBar").stop(false,true).animate({top:o/a*i.height()},300)})},resize:function(){HROS.appmanage.getScrollbar()},close:function(){$("#amg_dock_container").html("");$("#amg_folder_container .folderInner").html("");$("#desktop").show();$("#appmanage").hide();$("#amg_folder_container .folderItem").removeClass("folderItem_turn");HROS.app.set();HROS.deskTop.resize()}}}();HROS.base=function(){return{init:function(){(function(e){e["lock"]=true;e["fixed"]=true;e["resize"]=false;e["background"]="#000";e["opacity"]=.5})($.dialog.defaults);if(!$.browser.msie){window.onbeforeunload=HROS.util.confirmExit}HROS.CONFIG.memberID=$.cookie("memberID");$("body").on("contextmenu",function(){return false});HROS.copyright.init();HROS.copyright.show();HROS.zoom.init();HROS.deskTop.init();HROS.wallpaper.init();HROS.navbar.init();HROS.searchbar.init();HROS.startmenu.init();HROS.taskbar.init();HROS.dock.init();HROS.app.init();HROS.widget.init();HROS.window.init();HROS.folderView.init();HROS.appmanage.init();HROS.popupMenu.init();HROS.base.run();$(document).ajaxSuccess(function(e,t,i){if($.trim(t.responseText)=="ERROR_NOT_LOGGED_IN"){HROS.CONFIG.memberID=0;$.dialog({title:"温馨提示",icon:"warning",content:"系统检测到您尚未登录，为了更好的操作，是否登录？",ok:function(){HROS.base.login()}})}});console.log(" __    __ ________ ________ _______  ________ __    __    ________ ________ ");console.log("|  |  |  |   __   |   __   |   __  \\|   __   |  |  |  |  |   __   |   _____|");console.log("|  |__|  |  |  |  |  |  |  |  |__|  |  |__|  |  |__|  |  |  |  |  |  |_____ ");console.log("|   __   |  |  |  |  |  |  |      _/|   __   |__    __|  |  |  |  |_____   |");console.log("|  |  |  |  |__|  |  |__|  |  |\\  \\ |  |  |  |  |  |     |  |__|  |_____|  |");console.log("|__|  |__|________|________|__| \\__\\|__|  |__|  |__|     |________|________|");console.log("想学习HoorayOS，还是发现了什么bug？不如和我们一起为HoorayOS添砖加瓦吧！");console.log("QQ群：213804727")},login:function(){$("#lrbox").animate({top:0},500,function(){changeTabindex("login")})},logout:function(){$.ajax({type:"POST",url:"login.ajax.php",data:"ac=logout",success:function(){window.onbeforeunload=null;location.reload()}})},checkLogin:function(){return HROS.CONFIG.memberID!=0?true:false},setSkin:function(e,t){function i(e,t){if(e.attachEvent){e.attachEvent("onload",t)}else{setTimeout(function(){a(e,t)},0)}}function a(e,t){if(t.isCalled){return}var i=false;if(/webkit/i.test(navigator.userAgent)){if(e["sheet"]){i=true}}else if(e["sheet"]){try{if(e["sheet"].cssRules){i=true}}catch(o){if(o.code===1e3){i=true}}}if(i){setTimeout(function(){t()},1)}else{setTimeout(function(){a(e,t)},1)}}$("#window-skin").attr("id","window-skin-ready2remove");var o=document.createElement("link");o.rel="stylesheet";o.href="img/skins/"+e+".css?"+version;o.id="window-skin";document.getElementsByTagName("head")[0].appendChild(o);i(o,function(){$("#window-skin-ready2remove").remove();HROS.CONFIG.skin=e;t&&t()})},help:function(){if(!$.browser.msie||$.browser.msie&&$.browser.version<9){$("body").append(helpTemp);$("#step1").show();$(".close").on("click",function(){$("#help").remove()});$(".next").on("click",function(){var e=$(this).parents(".step");var t=e.attr("step");e.hide();$("#step"+(parseInt(t)+1)).show()});$(".over").on("click",function(){$("#help").remove()})}},run:function(){var e=location.search;var t=new Object;if(e.indexOf("?")!=-1){var i=e.substr(1);strs=i.split("&");for(var a=0;a<strs.length;a++){t[strs[a].split("=")[0]]=unescape(strs[a].split("=")[1])}}if(typeof t["run"]!="undefined"&&typeof t["type"]!="undefined"){if(t["type"]=="app"){HROS.window.create(t["run"])}else{if(!HROS.widget.checkCookie(t["run"],t["type"])){HROS.widget.create(t["run"])}}}}}}();HROS.copyright=function(){return{init:function(){$("#copyright .close").on("click",function(){HROS.copyright.hide()})},show:function(){var e=HROS.maskBox.copyright();e.show();$("#copyright").show()},hide:function(){var e=HROS.maskBox.copyright();e.hide();$("#copyright").hide()}}}();HROS.deskTop=function(){return{init:function(){$(window).on("resize",function(){HROS.deskTop.resize()});$("body").on("click","#desktop",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide()}).on("contextmenu","#desktop",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();var t=HROS.popupMenu.desk();var i=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var a=$(window).height()-e.clientY<t.height()?e.clientY-t.height():e.clientY;t.css({left:i,top:a}).show();return false})},resize:function(){if($("#desktop").is(":visible")){HROS.dock.setPos();HROS.deskTop.appresize();HROS.deskTop.windowresize()}else{HROS.appmanage.resize()}HROS.wallpaper.set(false)},appresize:function(){switch(HROS.CONFIG.appSize){case"s":$("#desk").removeClass("smallIcon").addClass("smallIcon");break;case"m":$("#desk").removeClass("smallIcon");break}var e=HROS.grid.getAppGrid(),t=HROS.grid.getDockAppGrid();$("#dock-bar .dock-applist li").each(function(e){$(this).css({left:t[e]["startX"],top:t[e]["startY"]});$(this).attr("left",$(this).offset().left).attr("top",$(this).offset().top)});for(var i=1;i<=5;i++){$("#desk-"+i+" li").each(function(t){var i=e[t]["startX"]+16,a=e[t]["startY"]+7;$(this).stop(true,false).animate({left:i,top:a},500);switch(HROS.CONFIG.dockPos){case"top":$(this).attr("left",i).attr("top",a+73);break;case"left":$(this).attr("left",i+73).attr("top",a);break;case"right":$(this).attr("left",i).attr("top",a);break}})}HROS.app.getScrollbar()},windowresize:function(){$("#desk div.window-container").each(function(){var e=$(this).data("info");currentW=$(window).width()-$(this).width();currentH=$(window).height()-$(this).height();var t=e["left"]/e["emptyW"]*currentW>=currentW?currentW:e["left"]/e["emptyW"]*currentW;t=t<=0?0:t;var i=e["top"]/e["emptyH"]*currentH>=currentH?currentH:e["top"]/e["emptyH"]*currentH;i=i<=0?0:i;if($(this).attr("state")!="hide"){$(this).animate({left:t,top:i},500,function(){e["left"]=t;e["top"]=i;e["emptyW"]=$(window).width()-$(this).width();e["emptyH"]=$(window).height()-$(this).height()})}else{e["left"]=t;e["top"]=i;e["emptyW"]=$(window).width()-$(this).width();e["emptyH"]=$(window).height()-$(this).height()}})},updateDefaultDesk:function(e){if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setDesk&desk="+e})}}}}();HROS.dock=function(){return{init:function(){HROS.dock.setPos();HROS.dock.move();$("body").on("contextmenu","#dock-container",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();var t=HROS.popupMenu.dock();var i=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var a=$(window).height()-e.clientY<t.height()?e.clientY-t.height():e.clientY;t.css({left:i,top:a}).show();return false});$(".dock-tool-setting").on("mousedown",function(){return false}).on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"sysapp/desksetting/index.php",width:750,height:450,isflash:false})}else{HROS.base.login()}});$(".dock-tool-style").on("mousedown",function(){return false}).on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isflash:false})}else{HROS.base.login()}});$(".dock-tool-start").on("mousedown",function(){return false}).on("click",function(){HROS.startmenu.show();return false})},setPos:function(){HROS.navbar.switchDesk(HROS.CONFIG.desk);var e=$("#desk-"+HROS.CONFIG.desk),t=$("#desk .desktop-container");var i=e.css("width","100%").width(),a=e.css("height","100%").height();$("#dock-container").removeClass("dock-top dock-left dock-right");$("#dock-bar").removeClass("top-bar left-bar right-bar").hide();if(HROS.CONFIG.dockPos=="top"){$("#dock-bar").addClass("top-bar").children("#dock-container").addClass("dock-top");t.css({width:i,height:a-143,left:i,top:73});e.css({left:0});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="left"){$("#dock-bar").addClass("left-bar").children("#dock-container").addClass("dock-left");t.css({width:i-73,height:a-70,left:i+73,top:0});e.css({left:73});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="right"){$("#dock-bar").addClass("right-bar").children("#dock-container").addClass("dock-right");t.css({width:i-73,height:a-70,left:i,top:0});e.css({left:0});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="none"){t.css({width:i,height:a-70,left:i,top:0});e.css({left:0})}HROS.taskbar.resize();HROS.folderView.resize()},updatePos:function(e){if(e!=HROS.CONFIG.dockPos&&typeof e!="undefined"){HROS.CONFIG.dockPos=e;if(e=="none"){HROS.app.dataAllDockToDesk(HROS.CONFIG.desk)}HROS.dock.setPos();HROS.app.set();if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setDockPos&dock="+e+"&desk="+HROS.CONFIG.desk})}}},move:function(){$("#dock-container").on("mousedown",function(e){if(e.button==0||e.button==1){var t=HROS.maskBox.dock(),i;$(document).on("mousemove",function(e){t.show();if(e.clientY<t.height()*.2){i="top"}else if(e.clientX<t.width()*.5){i="left"}else{i="right"}$(".dock_drap_effect").removeClass("hover");$(".dock_drap_effect_"+i).addClass("hover")}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");t.hide();HROS.dock.updatePos(i)})}})}}}();HROS.folderView=function(){return{init:function(){$(window).on("resize",function(){HROS.folderView.resize()});$("body").on("click",".quick_view_container",function(){HROS.popupMenu.hide()}).on("click",".quick_view_container_open",function(){HROS.window.create($(this).parents(".quick_view_container").attr("appid"),"folder");HROS.folderView.hide()}).on("click",".appbtn",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide()});HROS.folderView.moveScrollbar()},get:function(e){setTimeout(function(){var t=false;$("body .quick_view_container").each(function(){if($(this).attr("realappid")==e.attr("realappid")){t=true;return false}});if(t){var i="#qv_"+e.attr("appid")}else{HROS.folderView.hide()}var a="";$(HROS.VAR.folder).each(function(){if(this.appid==e.attr("appid")){a=this.apps;return false}});var o="",s=0;if(a!=""){$(a).each(function(){switch(this.type){case"app":case"widget":case"papp":case"pwidget":o+=appbtnTemp({top:0,left:0,title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid,imgsrc:this.icon});break}});if(a.length%4==0){s+=Math.floor(a.length/4)*60}else{s+=(Math.floor(a.length/4)+1)*60}}else{o="文件夹为空";s+=30}var n,p;if(e.parent("div").hasClass("dock-applist")){n=parseInt(e.attr("left"))+60;p=parseInt(e.attr("top"))}else{n=parseInt(e.attr("left"))+80;p=parseInt(e.attr("top"))-20}var r=false;if(s+p+46>$(window).height()){var d=s+p+46-$(window).height();if(d<=p){p-=d}else{s-=d-p;p=0;r=true}}if(n+340>$(window).width()){n-=340+80;if(t){$(i+" .quick_view_container_list_in").html("").append(o);$(i).stop(true,false).animate({left:n,top:p},500);$(i+" .perfect_nine_m_l_t").stop(true,false).animate({top:0,height:Math.ceil((s+26)/2)},200);$(i+" .perfect_nine_m_l_m").stop(true,false).animate({top:Math.ceil((s+26)/2)},200).hide();$(i+" .perfect_nine_m_l_b").stop(true,false).animate({top:Math.ceil((s+26)/2),height:Math.ceil((s+26)/2)+20},200);$(i+" .perfect_nine_m_r_t").stop(true,false).animate({top:0,height:parseInt(e.attr("top"))-p},200);$(i+" .perfect_nine_m_r_m").stop(true,false).animate({top:parseInt(e.attr("top"))-p},200).show();$(i+" .perfect_nine_m_r_b").stop(true,false).animate({top:parseInt(e.attr("top"))-p+20,height:s+26-(parseInt(e.attr("top"))-p)-20+20},200);$(i+" .quick_view_container_list_in").stop(true,false).animate({height:s},200)}else{$("body").append(folderViewTemp({id:"qv_"+e.attr("appid"),appid:e.attr("appid"),realappid:e.attr("realappid"),apps:o,top:p,left:n,height:s,mlt:Math.ceil((s+26)/2),mlm:false,mlb:Math.ceil((s+26)/2),mrt:e.offset().top-p,mrm:true,mrb:s+26-(e.offset().top-p)-20}))}}else{if(t){$(i+" .quick_view_container_list_in").html("").append(o);$(i).stop(true,false).animate({left:n,top:p},500);$(i+" .perfect_nine_m_l_t").stop(true,false).animate({top:0,height:parseInt(e.attr("top"))-p},200);$(i+" .perfect_nine_m_l_m").stop(true,false).animate({top:parseInt(e.attr("top"))-p},200).show();$(i+" .perfect_nine_m_l_b").stop(true,false).animate({top:parseInt(e.attr("top"))-p+20,height:s+26-(parseInt(e.attr("top"))-p)-20},200);$(i+" .perfect_nine_m_r_t").stop(true,false).animate({top:0,height:Math.ceil((s+26)/2)},200);$(i+" .perfect_nine_m_r_m").stop(true,false).animate({top:Math.ceil((s+26)/2)},200).hide();$(i+" .perfect_nine_m_r_b").stop(true,false).animate({top:Math.ceil((s+26)/2),height:Math.ceil((s+26)/2)},200);$(i+" .quick_view_container_list_in").stop(true,false).animate({height:s},200)}else{$("body").append(folderViewTemp({id:"qv_"+e.attr("appid"),appid:e.attr("appid"),realappid:e.attr("realappid"),apps:o,top:p,left:n,height:s,mlt:e.offset().top-p,mlm:true,mlb:s+26-(e.offset().top-p)-20,mrt:Math.ceil((s+26)/2),mrm:false,mrb:Math.ceil((s+26)/2)}))}}var l="#quick_view_container_list_in_"+e.attr("appid");var c="#quick_view_container_list_"+e.attr("appid")+" .scrollBar";$("#quick_view_container_list_"+e.attr("appid")+" .scrollBar_bgc").hide();$(c).hide().height(0);if(r){$("#quick_view_container_list_"+e.attr("appid")+" .scrollBar_bgc").show();$(c).show().height($(l).height()/(Math.ceil($(l).children().length/4)*60)*$(l).height())}},0)},resize:function(){$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))})},moveScrollbar:function(){$("body").on("mousedown",".quick_view_container .quick_view_container_list .scrollBar",function(e){var t=$(this),i=t.prev(".quick_view_container_list_in");var a=i.offset().top;var o,s,n,p;n=Math.ceil(i.children().length/4)*60;p=i.height()-t.height();o=e.clientY-t.offset().top;$(document).on("mousemove",function(e){s=e.clientY-o-a<0?0:e.clientY-o-a>p?p:e.clientY-o-a;t.css("top",s);i.scrollTop(s/i.height()*n)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("body").on("mousewheel",".quick_view_container_list_in",function(e,t){var i=$(this),a=Math.ceil($(this).children().length/4)*60,o;if(t<0){o=i.scrollTop()+40>a-i.height()?a-i.height():i.scrollTop()+40}else{o=i.scrollTop()-40<0?0:i.scrollTop()-40}i.stop(false,true).animate({scrollTop:o},300);$(this).next(".scrollBar").stop(false,true).animate({top:o/a*i.height()},300)})},hide:function(){$(".quick_view_container").remove()}}}();HROS.grid=function(){return{getAppGrid:function(){var e,t;e=$("#desk-"+HROS.CONFIG.desk).width()-HROS.CONFIG.appButtonLeft;t=$("#desk-"+HROS.CONFIG.desk).height()-HROS.CONFIG.appButtonTop;var i=[],a=HROS.CONFIG.appButtonTop,o=HROS.CONFIG.appButtonLeft;var s=100,n=120;if(HROS.CONFIG.appSize=="s"){s=80;n=100}for(var p=0;p<1e4;p++){i.push({startY:a,endY:a+s,startX:o,endX:o+n});if(HROS.CONFIG.appXY=="x"){o+=n;if(o+100>e){a+=s;o=HROS.CONFIG.appButtonLeft}}else{a+=s;if(a+70>t){a=HROS.CONFIG.appButtonTop;o+=n}}}return i},searchAppGrid:function(e,t){var i=HROS.grid.getAppGrid(),a=i.length;var o=0,s=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length-1;for(var n=0;n<a;n++){if(e>=i[n].startX&&e<=i[n].endX){o+=1}if(t>=i[n].startY&&t<=i[n].endY){o+=1}if(o===2){return n>s?s:n}else{o=0}}return null},getDockAppGrid:function(){var e=$("#dock-bar .dock-applist").height();var t=[],i=0,a=0;for(var o=0;o<7;o++){t.push({startY:a,endY:a+62,startX:i,endX:i+62});a+=62;if(a+62>e){a=0;i+=62}}return t},searchDockAppGrid:function(e,t){var i=HROS.grid.getDockAppGrid(),a=i.length,o=0,s=$("#dock-bar .dock-applist li").length-1;for(var n=0;n<a;n++){if(e>=i[n].startX&&e<=i[n].endX){o+=1}if(t>=i[n].startY&&t<=i[n].endY){o+=1}if(o===2){return n>s?s:n}else{o=0}}return null},getFolderGrid:function(){var e=[];$(".quick_view_container, .folder-window:visible").each(function(){e.push({zIndex:$(this).css("z-index"),id:$(this).attr("appid"),startY:$(this).offset().top,endY:$(this).offset().top+$(this).height(),startX:$(this).offset().left,endX:$(this).offset().left+$(this).width()})});e.sort(function(e,t){return t["zIndex"]-e["zIndex"]});return e},searchFolderGrid:function(e,t){var i=HROS.grid.getFolderGrid(),a=i.length,o=0;for(var s=0;s<a;s++){if(e>=i[s].startX&&e<=i[s].endX){o+=1}if(t>=i[s].startY&&t<=i[s].endY){o+=1}if(o===2){return i[s]["id"]}else{o=0}}return null},getManageDockAppGrid:function(){var e=[],t=20;for(var i=0;i<1e4;i++){e.push({startX:t,endX:t+72});t+=72}return e},getManageDockAppGridOnMove:function(){var e=[],t=20;for(var i=0;i<1e4;i++){e.push({startX:t,endX:t+(i==0?29:72)});t+=i==0?29:72}return e},searchManageDockAppGrid:function(e){var t=HROS.grid.getManageDockAppGridOnMove(),i=0;var a=0;for(var o=0;o<t.length;o++){if(e>=t[o].startX&&e<=t[o].endX){i+=1}if(i===1){a=o;break}else{i=0}}return a},getManageAppGrid:function(){var e=[],t=0;for(var i=0;i<1e4;i++){e.push({startY:t,endY:t+40});t+=40}return e},getManageAppGridOnMove:function(){var e=[],t=0;for(var i=0;i<1e4;i++){e.push({startY:t,endY:t+(i==0?20:40)});t+=i==0?20:40}return e},searchManageAppGrid:function(e){var t=HROS.grid.getManageAppGridOnMove(),i=0;var a=0;for(var o=0;o<t.length;o++){if(e>=t[o].startY&&e<=t[o].endY){i+=1}if(i===1){a=o;break}else{i=0}}return a}}}();HROS.maskBox=function(){return{desk:function(){if(!TEMP.maskBoxDesk){TEMP.maskBoxDesk=$('<div id="maskbox"></div>');$("body").append(TEMP.maskBoxDesk)}return TEMP.maskBoxDesk},dock:function(){if(!TEMP.maskBoxDock){TEMP.maskBoxDock=$('<div id="maskbox-dockdrap"><div id="docktop" class="dock_drap_effect dock_drap_effect_top"></div><div id="dockleft" class="dock_drap_effect dock_drap_effect_left"></div><div id="dockright" class="dock_drap_effect dock_drap_effect_right"></div><div id="dockmask" class="dock_drap_mask"><div class="dock_drop_region_top"><div class="text">拖放至顶部</div></div><div class="dock_drop_region_left"><div class="text">拖放至左侧</div></div><div class="dock_drop_region_right"><div class="text">拖放至右侧</div></div></div></div>');$("body").append(TEMP.maskBoxDock)}return TEMP.maskBoxDock},copyright:function(){if(!TEMP.maskBoxCopyright){TEMP.maskBoxCopyright=$('<div id="maskbox-copyright"></div>');$("body").append(TEMP.maskBoxCopyright)}return TEMP.maskBoxCopyright}}}();HROS.navbar=function(){return{init:function(){$("#nav-bar").css({left:$(window).width()/2-105,top:80}).show();HROS.navbar.hotkey();HROS.navbar.getAvatar();HROS.navbar.move()},hotkey:function(){Mousetrap.bind(["ctrl+up","command+up"],function(){HROS.appmanage.init();return false});Mousetrap.bind(["ctrl+f","command+f"],function(){HROS.searchbar.get();return false});Mousetrap.bind(["ctrl+1","command+1"],function(){HROS.navbar.switchDesk(1);return false});Mousetrap.bind(["ctrl+2","command+2"],function(){HROS.navbar.switchDesk(2);return false});Mousetrap.bind(["ctrl+3","command+3"],function(){HROS.navbar.switchDesk(3);return false});Mousetrap.bind(["ctrl+4","command+4"],function(){HROS.navbar.switchDesk(4);return false});Mousetrap.bind(["ctrl+5","command+5"],function(){HROS.navbar.switchDesk(5);return false})},getAvatar:function(){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAvatar"}).done(function(e){$("#nav-bar .indicator-header-img").attr("src",e)})},openAccount:function(){if(HROS.CONFIG.memberID!=0){HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"sysapp/account/index.php",width:550,height:580})}else{HROS.base.login()}},move:function(){$("#nav-bar, #navbarHeaderImg, #nav-bar .nav-container a.indicator").on("mousedown",function(e){e.preventDefault();e.stopPropagation();HROS.popupMenu.hide();HROS.folderView.hide();if(e.button==0||e.button==1){var t,i,a,o,s,n,p,r=$("#nav-bar"),d=$(this);s=a=r.offset().left;n=o=r.offset().top;t=e.clientX-s;i=e.clientY-n;$(document).on("mousemove",function(e){p=HROS.maskBox.desk();p.show();a=e.clientX-t<=0?0:e.clientX-t>$(window).width()-240?$(window).width()-240:e.clientX-t;o=e.clientY-i<=10?10:e.clientY-i>$(window).height()-50?$(window).height()-50:e.clientY-i;r.css({left:a,top:o})}).on("mouseup",function(){if(s==a&&n==o){if(typeof d.attr("index")!=="undefined"){HROS.navbar.switchDesk(d.attr("index"))}else if(d.hasClass("indicator-manage")){HROS.appmanage.set()}else if(d.hasClass("indicator-search")){HROS.searchbar.get()}else if(d.hasClass("indicator-header")){HROS.navbar.openAccount()}}if(typeof p!=="undefined"){p.hide()}$(this).off("mousemove").off("mouseup")})}}).on("click",function(e){e.stopPropagation()})},switchDesk:function(e){var t=/^\+?[1-5]*$/;e=t.test(e)?e:1;var i=$("#navContainer"),a=HROS.CONFIG.desk,o=e,s=$("#desk-"+a).offset().left,n=$("#desk-"+o).offset().left;if(a!=o){if(!$("#desk-"+o).hasClass("animated")&&!$("#desk-"+a).hasClass("animated")){$("#desk-"+a).addClass("animated").animate({left:n},500,"easeInOutCirc",function(){$(this).removeClass("animated")});$("#desk-"+o).addClass("animated").animate({left:s},500,"easeInOutCirc",function(){$(this).removeClass("animated");i.removeClass("nav-current-"+a).addClass("nav-current-"+o);HROS.CONFIG.desk=o})}}else{i.removeClass("nav-current-"+a).addClass("nav-current-"+o)}}}}();HROS.popupMenu=function(){return{init:function(){$(".popup-menu").on("contextmenu",function(){return false});$("body").on("mouseenter",".popup-menu li",function(){if($(this).children(".popup-menu").length==1){$(this).children("a").addClass("focus");$(this).children(".popup-menu").show();if($(this).parents(".popup-menu").offset().left+$(this).parents(".popup-menu").width()*2+10<$(window).width()){$(this).children(".popup-menu").css({left:$(this).parents(".popup-menu").width()-5,top:0})}else{$(this).children(".popup-menu").css({left:-1*$(this).parents(".popup-menu").width(),top:0})}if($(this).children(".popup-menu").offset().top+$(this).children(".popup-menu").height()+10>$(window).height()){$(this).children(".popup-menu").css({top:$(window).height()-$(this).children(".popup-menu").height()-$(this).children(".popup-menu").offset().top-10})}}}).on("mouseleave",".popup-menu li",function(){$(this).children("a").removeClass("focus");$(this).children(".popup-menu").hide()})},app:function(e){HROS.window.show2under();if(!TEMP.popupMenuApp){TEMP.popupMenuApp=$('<div class="popup-menu app-menu"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开应用</a></li><li><a menu="move" href="javascript:;">移动应用到<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="moveto" desk="1" href="javascript:;">桌面1</a></li><li><a menu="moveto" desk="2" href="javascript:;">桌面2</a></li><li><a menu="moveto" desk="3" href="javascript:;">桌面3</a></li><li><a menu="moveto" desk="4" href="javascript:;">桌面4</a></li><li><a menu="moveto" desk="5" href="javascript:;">桌面5</a></li></ul></div></li><li><a menu="edit" href="javascript:;"><b class="edit"></b>编辑</a></li><li><a menu="del" href="javascript:;"><b class="uninstall"></b>卸载应用</a></li></ul></div>');$("body").append(TEMP.popupMenuApp)}$('.app-menu a[menu="moveto"]').removeClass("disabled");if(e.parent().hasClass("desktop-apps-container")){$('.app-menu a[menu="moveto"]').each(function(){if($(this).attr("desk")==HROS.CONFIG.desk){$(this).addClass("disabled")
}})}$('.app-menu a[menu="moveto"]').off("click").on("click",function(){var t=e.attr("appid"),i=e.index(),a=-1,o=$(this).attr("desk"),s=HROS.CONFIG.desk,n=e.parents(".folder-window").attr("appid")||e.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){var p=false;if(e.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,i,o)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-otherdesk&id="+t+"&from="+i+"&todesk="+o}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.parent().hasClass("desktop-apps-container")){if(HROS.app.dataDeskToOtherdesk(t,i,a,o,s)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-otherdesk&id="+t+"&from="+i+"&to="+a+"&todesk="+o+"&fromdesk="+s}).done(function(e){HROS.VAR.isAppMoving=false})}}else{if(HROS.app.dataFolderToOtherdesk(t,i,o,n)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-otherdesk&id="+t+"&from="+i+"&todesk="+o+"&fromfolderid="+n}).done(function(e){HROS.VAR.isAppMoving=false})}}}}else{if(e.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,i,o)}else if(e.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,i,o,s)}else{HROS.app.dataFolderToOtherdesk(t,i,o,n)}}$(".popup-menu").hide()});$('.app-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(e.attr("realappid"),e.attr("type"));$(".popup-menu").hide()});$('.app-menu a[menu="edit"]').off("click").on("click",function(){if(HROS.base.checkLogin()){$.dialog.open("sysapp/dialog/app.php?id="+e.attr("appid"),{id:"editdialog",title:"编辑应用“"+e.children("span").text()+"”",width:600,height:350})}else{HROS.base.login()}$(".popup-menu").hide()});$('.app-menu a[menu="del"]').off("click").on("click",function(){HROS.app.dataDeleteByAppid(e.attr("appid"));HROS.widget.removeCookie(e.attr("realappid"),e.attr("type"));HROS.app.remove(e.attr("appid"),function(){e.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.remove();HROS.deskTop.resize()})});$(".popup-menu").hide()});return TEMP.popupMenuApp},papp:function(e){HROS.window.show2under();if(!TEMP.popupMenuPapp){TEMP.popupMenuPapp=$('<div class="popup-menu papp-menu"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开应用</a></li><li><a menu="move" href="javascript:;">移动应用到<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="moveto" desk="1" href="javascript:;">桌面1</a></li><li><a menu="moveto" desk="2" href="javascript:;">桌面2</a></li><li><a menu="moveto" desk="3" href="javascript:;">桌面3</a></li><li><a menu="moveto" desk="4" href="javascript:;">桌面4</a></li><li><a menu="moveto" desk="5" href="javascript:;">桌面5</a></li></ul></div></li><li><a menu="edit" href="javascript:;"><b class="edit"></b>编辑</a></li><li><a menu="del" href="javascript:;"><b class="del"></b>删除应用</a></li></ul></div>');$("body").append(TEMP.popupMenuPapp)}$('.papp-menu a[menu="moveto"]').removeClass("disabled");if(e.parent().hasClass("desktop-apps-container")){$('.papp-menu a[menu="moveto"]').each(function(){if($(this).attr("desk")==HROS.CONFIG.desk){$(this).addClass("disabled")}})}$('.papp-menu a[menu="moveto"]').off("click").on("click",function(){var t=e.attr("appid"),i=e.index(),a=-1,o=$(this).attr("desk"),s=HROS.CONFIG.desk,n=e.parents(".folder-window").attr("appid")||e.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){var p=false;if(e.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,i,o)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-otherdesk&id="+t+"&from="+i+"&todesk="+o}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.parent().hasClass("desktop-container")){if(HROS.app.dataDeskToOtherdesk(t,i,a,o,s)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-otherdesk&id="+t+"&from="+i+"&to="+a+"&todesk="+o+"&fromdesk="+s}).done(function(e){HROS.VAR.isAppMoving=false})}}else{if(HROS.app.dataFolderToOtherdesk(t,i,o,n)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-otherdesk&id="+t+"&from="+i+"&todesk="+o+"&fromfolderid="+n}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{if(e.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,i,o)}else if(e.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,i,o,s)}else{HROS.app.dataFolderToOtherdesk(t,i,o,n)}}$(".popup-menu").hide()});$('.papp-menu a[menu="open"]').off("click").on("click",function(){switch(e.attr("type")){case"papp":HROS.window.create(e.attr("realappid"),e.attr("type"));break;case"pwidget":HROS.widget.create(e.attr("realappid"),e.attr("type"));break}$(".popup-menu").hide()});$('.papp-menu a[menu="edit"]').off("click").on("click",function(){if(HROS.base.checkLogin()){$.dialog.open("sysapp/dialog/papp.php?id="+e.attr("appid"),{id:"editdialog",title:"编辑私人应用“"+e.children("span").text()+"”",width:600,height:450})}else{HROS.base.login()}$(".popup-menu").hide()});$('.papp-menu a[menu="del"]').off("click").on("click",function(){HROS.app.dataDeleteByAppid(e.attr("appid"));HROS.widget.removeCookie(e.attr("realappid"),e.attr("type"));HROS.app.remove(e.attr("appid"),function(){e.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.remove();HROS.deskTop.resize()})});$(".popup-menu").hide()});return TEMP.popupMenuPapp},folder:function(e){HROS.window.show2under();if(!TEMP.popupMenuFolder){TEMP.popupMenuFolder=$('<div class="popup-menu folder-menu"><ul><li><a menu="view" href="javascript:;">预览</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开</a></li><li><a menu="move" href="javascript:;">移动应用到<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="moveto" desk="1" href="javascript:;">桌面1</a></li><li><a menu="moveto" desk="2" href="javascript:;">桌面2</a></li><li><a menu="moveto" desk="3" href="javascript:;">桌面3</a></li><li><a menu="moveto" desk="4" href="javascript:;">桌面4</a></li><li><a menu="moveto" desk="5" href="javascript:;">桌面5</a></li></ul></div></li><li><a menu="rename" href="javascript:;"><b class="edit"></b>重命名</a></li><li><a menu="del" href="javascript:;"><b class="del"></b>删除</a></li></ul></div>');$("body").append(TEMP.popupMenuFolder)}$('.folder-menu a[menu="moveto"]').removeClass("disabled");if(e.parent().hasClass("desktop-apps-container")){$('.folder-menu a[menu="moveto"]').each(function(){if($(this).attr("desk")==HROS.CONFIG.desk){$(this).addClass("disabled")}})}$('.folder-menu a[menu="view"]').off("click").on("click",function(){HROS.folderView.get(e);$(".popup-menu").hide()});$('.folder-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(e.attr("realappid"),e.attr("type"));$(".popup-menu").hide()});$('.folder-menu a[menu="moveto"]').off("click").on("click",function(){var t=e.attr("appid"),i=e.index(),a=-1,o=$(this).attr("desk"),s=HROS.CONFIG.desk,n=e.parents(".folder-window").attr("appid")||e.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){var p=false;if(e.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,i,o)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=dock-otherdesk&id="+t+"&from="+i+"&todesk="+o}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.parent().hasClass("desktop-apps-container")){if(HROS.app.dataDeskToOtherdesk(t,i,a,o,s)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=desk-otherdesk&id="+t+"&from="+i+"&to="+a+"&todesk="+o+"&fromdesk="+s}).done(function(e){HROS.VAR.isAppMoving=false})}}else{if(HROS.app.dataFolderToOtherdesk(t,i,o,n)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&movetype=folder-otherdesk&id="+t+"&from="+i+"&todesk="+o+"&fromfolderid="+n}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{if(e.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,i,o)}else if(e.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,i,o,s)}else{HROS.app.dataFolderToOtherdesk(t,i,o,n)}}$(".popup-menu").hide()});$('.folder-menu a[menu="rename"]').off("click").on("click",function(){if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"重命名“"+e.find("span").text()+"”文件夹",padding:0,content:editFolderDialogTemp({name:e.find("span").text(),src:e.find("img").attr("src")}),ok:function(){if($("#folderName").val()!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateFolder&name="+$("#folderName").val()+"&icon="+$(".folderSelector img").attr("src")+"&id="+e.attr("appid")}).done(function(e){HROS.app.get()})}else{$(".folderNameError").show();return false}},cancel:true});$(".folderSelector").off("click").on("click",function(){$(".fcDropdown").show()});$(".fcDropdown_item").off("click").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$(".fcDropdown").hide()})}else{HROS.base.login()}$(".popup-menu").hide()});$('.folder-menu a[menu="del"]').off("click").on("click",function(){$.dialog({id:"delfolder",title:"删除“"+e.find("span").text()+"”文件夹",content:"删除文件夹的同时会删除文件夹内所有应用",icon:"warning",ok:function(){HROS.app.remove(e.attr("appid"),function(){HROS.app.dataDeleteByAppid(e.attr("appid"));e.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.remove();HROS.deskTop.resize()})})},cancel:true});$(".popup-menu").hide()});return TEMP.popupMenuFolder},dock:function(){HROS.window.show2under();if(!TEMP.popupMenuDock){TEMP.popupMenuDock=$('<div class="popup-menu dock-menu"><ul><li><a menu="dockpos" pos="top" href="javascript:;"><b class="hook"></b>向上停靠</a></li><li><a menu="dockpos" pos="left" href="javascript:;"><b class="hook"></b>向左停靠</a></li><li><a menu="dockpos" pos="right" href="javascript:;"><b class="hook"></b>向右停靠</a></li><li><a menu="dockpos" pos="none" href="javascript:;">隐藏</a></li></ul></div>');$("body").append(TEMP.popupMenuDock);$('.dock-menu a[menu="dockpos"]').on("click",function(){if($(this).attr("pos")=="none"){$.dialog({title:"隐藏应用码头",content:"<p>如果应用码头存在应用，隐藏后会将应用转移到当前桌面。</p><p>如果需要再次开启，可在桌面空白处右键，进入“桌面设置”里开启。</p>",ok:function(){HROS.dock.updatePos("none")},okVal:"确认隐藏",cancel:true})}else{HROS.dock.updatePos($(this).attr("pos"))}$(".popup-menu").hide()})}$('.dock-menu a[menu="dockpos"]').each(function(){$(this).children(".hook").hide();if($(this).attr("pos")==HROS.CONFIG.dockPos){$(this).children(".hook").show()}$(".popup-menu").hide()});return TEMP.popupMenuDock},task:function(e){HROS.window.show2under();if(!TEMP.popupMenuTask){TEMP.popupMenuTask=$('<div class="popup-menu task-menu"><ul><li><a menu="max" href="javascript:;">最大化</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="hide" href="javascript:;">最小化</a></li><li><a menu="close" href="javascript:;">关闭</a></li></ul></div>');$("body").append(TEMP.popupMenuTask)}$('.task-menu a[menu="max"]').off("click").on("click",function(){HROS.window.max(e.attr("appid"),e.attr("type"));$(".popup-menu").hide()});$('.task-menu a[menu="hide"]').off("click").on("click",function(){HROS.window.hide(e.attr("appid"),e.attr("type"));$(".popup-menu").hide()});$('.task-menu a[menu="close"]').off("click").on("click",function(){HROS.window.close(e.attr("appid"),e.attr("type"));$(".popup-menu").hide()});return TEMP.popupMenuTask},desk:function(){HROS.window.show2under();if(!TEMP.popupMenuDesk){TEMP.popupMenuDesk=$('<div class="popup-menu desk-menu"><ul><li><a menu="hideall" href="javascript:;">显示桌面</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="closeall" href="javascript:;">关闭所有应用</a></li><li><a href="javascript:;">新建<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="addfolder" href="javascript:;"><b class="folder"></b>新建文件夹</a></li><li><a menu="addpapp" href="javascript:;"><b class="customapp"></b>新建私人应用</a></li></ul></div></li><!--li style="border-bottom:1px solid #F0F0F0"><b class="upload"></b><a menu="uploadfile" href="javascript:;">上传文件</a></li--><li><a menu="themes" href="javascript:;"><b class="themes"></b>主题设置</a></li><li><a menu="setting" href="javascript:;"><b class="setting"></b>桌面设置</a></li><li style="border-bottom:1px solid #F0F0F0"><a href="javascript:;">图标设置<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a href="javascript:;">排列<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="orderby" orderby="x" href="javascript:;"><b class="hook"></b>横向排列</a></li><li><a menu="orderby" orderby="y" href="javascript:;"><b class="hook"></b>纵向排列</a></li></ul></div></li><li><a href="javascript:;">尺寸<b class="arrow">»</b></a><div class="popup-menu"><ul><li><a menu="size" size="s" href="javascript:;"><b class="hook"></b>小图标</a></li><li><a menu="size" size="m" href="javascript:;"><b class="hook"></b>大图标</a></li></ul></div></li></ul></div></li><li><a menu="logout" href="javascript:;">注销</a></li></ul></div>');$("body").append(TEMP.popupMenuDesk);$('.desk-menu a[menu="orderby"]').on("click",function(){HROS.app.updateXY($(this).attr("orderby"));$(".popup-menu").hide()});$('.desk-menu a[menu="size"]').on("click",function(){HROS.app.updateSize($(this).attr("size"));$(".popup-menu").hide()});$('.desk-menu a[menu="hideall"]').on("click",function(){HROS.window.hideAll();$(".popup-menu").hide()});$('.desk-menu a[menu="closeall"]').on("click",function(){HROS.window.closeAll();$(".popup-menu").hide()});$('.desk-menu a[menu="addfolder"]').on("click",function(){if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"新建文件夹",padding:0,content:editFolderDialogTemp({name:"新建文件夹",src:"img/ui/folder_default.png"}),ok:function(){if($("#folderName").val()!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addFolder&name="+$("#folderName").val()+"&icon="+$(".folderSelector img").attr("src")+"&desk="+HROS.CONFIG.desk}).done(function(e){HROS.app.get()})}else{$(".folderNameError").show();return false}},cancel:true});$(".folderSelector").on("click",function(){$("#addfolder .fcDropdown").show();return false});$(document).click(function(){$("#addfolder .fcDropdown").hide()});$(".fcDropdown_item").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$("#addfolder .fcDropdown").hide()})}else{HROS.base.login()}$(".popup-menu").hide()});$('.desk-menu a[menu="addpapp"]').on("click",function(){if(HROS.base.checkLogin()){$.dialog.open("sysapp/dialog/papp.php?desk="+HROS.CONFIG.desk,{id:"editdialog",title:"新建私人应用",width:600,height:450})}else{HROS.base.login()}$(".popup-menu").hide()});$('.desk-menu a[menu="uploadfile"]').on("click",function(){HROS.uploadFile.getDialog();$(".popup-menu").hide()});$('.desk-menu a[menu="themes"]').on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isflash:false})}else{HROS.base.login()}$(".popup-menu").hide()});$('.desk-menu a[menu="setting"]').on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"sysapp/desksetting/index.php",width:750,height:450,isflash:false})}else{HROS.base.login()}$(".popup-menu").hide()});$('.desk-menu a[menu="logout"]').on("click",function(){HROS.base.logout();$(".popup-menu").hide()})}$('.desk-menu a[menu="orderby"]').each(function(){$(this).children(".hook").hide();if($(this).attr("orderby")==HROS.CONFIG.appXY){$(this).children(".hook").show()}$(".popup-menu").hide()});$('.desk-menu a[menu="size"]').each(function(){$(this).children(".hook").hide();if($(this).attr("size")==HROS.CONFIG.appSize){$(this).children(".hook").show()}$(".popup-menu").hide()});return TEMP.popupMenuDesk},hide:function(){$(".popup-menu").hide()}}}();HROS.searchbar=function(){return{init:function(){$("#pageletSearchInput").on("click",function(){return false});$("#search-suggest .resultBox").on("click","li",function(){switch($(this).attr("type")){case"app":HROS.window.create($(this).attr("realappid"),$(this).attr("type"));break;case"widget":HROS.widget.create($(this).attr("realappid"),$(this).attr("type"));break}});$("#search-suggest .openAppMarket a, #pageletSearchButton").on("click",function(){HROS.searchbar.openAppMarket($("#pageletSearchInput").val())});$("#pageletSearchInput").on("keydown",function(e){if(e.keyCode=="13"){HROS.searchbar.openAppMarket($(this).val())}})},get:function(){var e="";searchFunc=setInterval(function(){var t=$("#pageletSearchInput").val();if(t!=""){$("#search-suggest").show();if(t!=e){e=t;HROS.searchbar.getSuggest(t)}}else{$("#search-suggest").hide()}},1e3);HROS.searchbar.set()},set:function(){$("#search-bar").css({left:$("#nav-bar").offset().left+27,top:$("#nav-bar").offset().top+35}).removeClass("above").show();$("#search-suggest").css({left:$("#nav-bar").offset().left+27,top:$("#nav-bar").offset().top+68});$("#search-suggest .openAppMarket").css("top",$("#search-suggest .resultBox").height()).removeClass("above");$("#pageletSearchInput").focus();if($("#nav-bar").offset().top+35+$("#search-suggest .resultBox").height()+44+50>$(window).height()){$("#search-bar").addClass("above").css("top",$("#nav-bar").offset().top-35);if($("#search-suggest").is(":visible")){$("#search-suggest .openAppMarket").addClass("above");$("#search-suggest").css("top",$("#search-bar").offset().top-$("#search-suggest .resultBox").height());$("#search-suggest .openAppMarket").css("top",-44)}}},getSuggest:function(val){var apps=[];$(HROS.VAR.dock).each(function(){if(jQuery.inArray(this.type,["app","widget"])>=0){apps.push(this)}});for(var i=1;i<=5;i++){var desk=eval("HROS.VAR.desk"+i);$(desk).each(function(){if(jQuery.inArray(this.type,["app","widget"])>=0){apps.push(this)}})}$(HROS.VAR.folder).each(function(){$(this.apps).each(function(){if(jQuery.inArray(this.type,["app","widget"])>=0){apps.push(this)}})});var suggest="";$(apps).each(function(){if(this.name.indexOf(val)>=0){suggest+=suggestTemp({name:this.name,appid:this.appid,realappid:this.realappid,type:this.type})}});$("#search-suggest .resultBox").html(suggest);HROS.searchbar.set()},openAppMarket:function(e){if(e!=""){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?searchkey="+e,width:800,height:484,isflash:false,refresh:true})}HROS.searchbar.hide()},hide:function(){if(typeof searchFunc!="undefined"){clearInterval(searchFunc)}$("#search-bar, #search-suggest").hide();$("#pageletSearchInput").val("");$("#search-suggest .resultBox").html("")}}}();HROS.startmenu=function(){return{init:function(){$("#startmenu-container .startmenu-nick a").on("click",function(){HROS.navbar.openAccount()});$("#startmenu-container .startmenu-exit a").on("click",function(){HROS.base.logout()});$("#startmenu-container .startmenu-feedback").on("click",function(){HROS.window.createTemp({appid:"hoorayos-feedback",title:"反馈",url:"http://hoorayos.com/feedback.html",width:700,height:500,isflash:false})});$("#startmenu-container .startmenu a").on("click",function(){switch($(this).attr("class")){case"help":HROS.base.help();break;case"about":HROS.copyright.show();break}})},show:function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();$("#startmenu-container").show();switch(HROS.CONFIG.dockPos){case"top":$("#startmenu-container").css({top:75,left:$("#dock-container").offset().left+350});break;case"left":var e=$("#dock-container").offset().top+$("#dock-container").height()-$("#startmenu-container").height()-20;if($("#dock-container").offset().top+$("#dock-container").height()>$(window).height()){e=$(window).height()-$("#startmenu-container").height()-20}$("#startmenu-container").css({top:e,left:75});break;case"right":var e=$("#dock-container").offset().top+$("#dock-container").height()-$("#startmenu-container").height()-20;if($("#dock-container").offset().top+$("#dock-container").height()>$(window).height()){e=$(window).height()-$("#startmenu-container").height()-20}var t=$(window).width()-$("#dock-container").width()-$("#startmenu-container").width();$("#startmenu-container").css({top:e,left:t});break}},hide:function(){$("#startmenu-container").hide()}}}();HROS.taskbar=function(){return{init:function(){$(window).on("resize",function(){HROS.taskbar.resize()});HROS.taskbar.click();HROS.taskbar.pageClick()},click:function(){$("#task-content-inner").on("click","a.task-item",function(){if($(this).hasClass("task-item-current")){HROS.window.hide($(this).attr("appid"))}else{HROS.window.show2top($(this).attr("appid"))}}).on("contextmenu","a.task-item",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();var t=HROS.popupMenu.task($(this));var i=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var a=e.clientY-t.height();t.css({left:i,top:a}).show();return false})},pageClick:function(){$("#task-next-btn").on("click",function(){if($(this).hasClass("disable")==false){var e=$("#task-bar").width(),t=$("#task-content-inner .task-item").length*114,i=e-112,a=t-i;var o=parseInt($("#task-content-inner").css("margin-left"))-114;if(o<=a*-1){o=a*-1;$("#task-next a").addClass("disable")}$("#task-pre a").removeClass("disable");$("#task-content-inner").animate({marginLeft:o},200)}});$("#task-pre-btn").on("click",function(){if($(this).hasClass("disable")==false){var e=parseInt($("#task-content-inner").css("margin-left"))+114;if(e>=0){e=0;$("#task-pre a").addClass("disable")}$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginLeft:e},200)}})},resize:function(){$("#task-content-inner").removeClass("fl");if(HROS.CONFIG.dockPos=="left"){$("#task-bar").css({left:73,right:0})}else if(HROS.CONFIG.dockPos=="right"){$("#task-bar").css({left:0,right:73});$("#task-content-inner").addClass("fl")}else{$("#task-bar").css({left:0,right:0})}var e=$("#task-bar").width(),t=$("#task-content-inner .task-item").length*114,i=e-112;$("#task-content-inner").css("width",t);if(t>=i){$("#task-next, #task-pre").show();$("#task-content").css("width",i);$("#task-content-inner").addClass("fl").stop(true,false).animate({marginLeft:0},200);$("#task-next a").removeClass("disable");$("#task-pre a").addClass("disable")}else{$("#task-next, #task-pre").hide();$("#task-content").css("width","100%");$("#task-content-inner").css({"margin-left":0,"margin-right":0})}}}}();HROS.uploadFile=function(){var e=[];return{getDialog:function(){var t=[];for(var i=0;i<e.length;i++){t.push({name:e[i].name,size:e[i].size<1048576?Math.round(e[i].size/1024)+" kb":Math.round(e[i].size/1048576*100)/100+" mb"})}var a=uploadFileDialogListTemp({list:t});if(typeof $.dialog.list["uploadfile"]=="object"){$("#uploadfile").html(a)}else{$.dialog({id:"uploadfile",title:"上传文件",padding:0,content:uploadFileDialogTemp({list:a}),button:[{name:"上传",callback:function(){if(e.length!=0){for(var t=0,i;i=e[t];t++){(function(e){var t=new FormData;t.append("xfile",e);var i=new XMLHttpRequest;if(i.upload){i.upload.addEventListener("progress",function(t){if(t.lengthComputable){$("#uploadfile .filelist:eq("+e.index+") .do").html("[&nbsp;--&nbsp;]");var i=Math.ceil(t.loaded/t.total*100);$("#uploadfile .filelist:eq("+e.index+") .progress").css({width:i+"%"})}},false);i.addEventListener("load",function(t){if(i.readyState==4&&i.status==200){var a=jQuery.parseJSON(t.target.responseText);if(a.error==null){$("#uploadfile .filelist:eq("+e.index+") .do").html("[&nbsp;√&nbsp;]")}else{$("#uploadfile .filelist:eq("+e.index+") .do").html("[&nbsp;×&nbsp;]").attr("title",a.error)}}},false);i.open("post","ajax.php?ac=html5upload",true);i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.send(t)}})(i)}e=[]}return false}},{name:"关闭",callback:function(){e=[];xhr=null}}]})}},init:function(){if(window.FileReader){var t=document.body;t.addEventListener("dragenter",function(e){e.preventDefault()},false);t.addEventListener("dragleave",function(e){e.preventDefault()},false);t.addEventListener("dragover",function(e){e.preventDefault()},false);t.addEventListener("drop",function(e){e.preventDefault();HROS.uploadFile.getDialog();i(e);HROS.uploadFile.getDialog()},false)}$("body").on("change","#uploadfilebtn",function(e){i(e);HROS.uploadFile.getDialog()});$("body").on("click","#uploadfile .del",function(){var t=$(this).parents(".filelist");var i=t.index();t.slideUp("slow",function(){$(this).remove()});var o=[];for(var s=0;s<e.length;s++){if(s!=i){o.push(e[s])}}e=o;a();HROS.uploadFile.getDialog()});var i=function(t){var i=t.target.files||t.dataTransfer.files;if(i.length!=0){var o=[];for(var s=0;s<i.length;s++){if(i[s]["size"]>104857600){o.push('"'+i[s]["name"]+'" 文件过大，请上传小于100MB的文件！')}else{e.push(i[s])}}if(o!=""){contentHtml=o.join("<br>");$.dialog({padding:10,content:contentHtml})}}a()};var a=function(){for(var t=0;t<e.length;t++){e[t]["index"]=t}console.log(e)}}}}();HROS.util=function(){return{confirmExit:function(){return"你确定要离开当前页面么？"}}}();HROS.wallpaper=function(){return{init:function(){HROS.wallpaper.set()},get:function(e){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getWallpaper",success:function(t){var i=t.split("<{|}>");HROS.CONFIG.wallpaperState=parseInt(i[0]);switch(HROS.CONFIG.wallpaperState){case 1:case 2:HROS.CONFIG.wallpaper=i[1];HROS.CONFIG.wallpaperType=i[2];HROS.CONFIG.wallpaperWidth=parseInt(i[3]);HROS.CONFIG.wallpaperHeight=parseInt(i[4]);break;case 3:HROS.CONFIG.wallpaper=i[1];break}e&&e()}})},set:function(e){var e=typeof e=="undefined"?true:e;if(e){$("#zoomWallpaperGrid").remove()}var t=$(window).width(),i=$(window).height();switch(HROS.CONFIG.wallpaperState){case 1:case 2:switch(HROS.CONFIG.wallpaperType){case"pingpu":if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:url('+HROS.CONFIG.wallpaper+') repeat"></div>')}break;case"juzhong":if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:url('+HROS.CONFIG.wallpaper+') no-repeat 50% 50%"></div>')}break;case"tianchong":var a=(i-HROS.CONFIG.wallpaperHeight)/2,o=(t-HROS.CONFIG.wallpaperWidth)/2;if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+i+"px;width:"+t+'px"><img id="zoomWallpaper" style="position:absolute;height:'+HROS.CONFIG.wallpaperHeight+"px;width:"+HROS.CONFIG.wallpaperWidth+"px;top:"+a+"px;left:"+o+'px"><div style="position:absolute;height:'+i+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show()})}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:i+"px",width:t+"px"});$("#zoomWallpaper").css({top:a+"px",left:o+"px"})}break;case"shiying":var s,n,a,o;if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth>i/t){s=i;n=HROS.CONFIG.wallpaperWidth*(i/HROS.CONFIG.wallpaperHeight);a=0;o=(t-n)/2}else if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth<i/t){n=t;s=HROS.CONFIG.wallpaperHeight*(t/HROS.CONFIG.wallpaperWidth);o=0;a=(i-s)/2}else{s=HROS.CONFIG.wallpaperHeight;n=HROS.CONFIG.wallpaperWidth;a=o=0}if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+i+"px;width:"+t+'px"><img id="zoomWallpaper" style="position:absolute;height:'+s+"px;width:"+n+"px;top:"+a+"px;left:"+o+'px"><div style="position:absolute;height:'+i+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show()})}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:i+"px",width:t+"px"});$("#zoomWallpaper").css({height:s+"px",width:n+"px",top:a+"px",left:o+"px"})}break;case"lashen":if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+i+"px;width:"+t+'px"><img id="zoomWallpaper" style="position:absolute;height:'+i+"px;width:"+t+'px;top:0;left:0"><div style="position:absolute;height:'+i+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show()})}else{$("#zoomWallpaperGrid").css({height:i+"px",width:t+"px"}).children("#zoomWallpaper, div").css({height:i+"px",width:t+"px"})}break}break;case 3:if(e){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div></div><iframe id="iframeWallpaper" frameborder="no" border="0" scrolling="no" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="'+HROS.CONFIG.wallpaper+'"></iframe></div>')}break}},update:function(e,t,i){function a(){HROS.wallpaper.get(function(){HROS.wallpaper.set()})}if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setWallpaper&wpstate="+e+"&wptype="+t+"&wp="+i}).done(function(e){a()})}else{a()}}}}();HROS.widget=function(){return{init:function(){HROS.widget.handle();HROS.widget.move();HROS.widget.reduction();$("#desk").on("mouseover",".widget",function(){$(this).children(".move").show()}).on("mouseout",".widget",function(){$(this).children(".move").hide()})},createTemp:function(e){var t=e.appid==null?Date.parse(new Date):e.appid;var i=false;$("#desk .widget").each(function(){if($(this).attr("realappid")==t){i=true;return false}});if(!i){function a(e){$("#desk").append(widgetWindowTemp({width:e.width,height:e.height,type:"widgetTemp",id:"w_"+e.appid,appid:e.appid,realappid:e.appid,top:e.top,right:e.right,url:e.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:0}));HROS.CONFIG.widgetIndexid+=1}a({appid:t,url:e.url,width:e.width,height:e.height,top:e.top==null?0:e.top,right:e.right==null?0:e.right})}},create:function(e,t){var t=t==null?"widget":t,i;var a=false;$("#desk .widget").each(function(){if($(this).attr("realappid")==e){a=true;i=$(this).attr("appid");return false}});if(!a&&$("#d_"+i).attr("opening")!=1){$("#d_"+i).attr("opening",1);function o(i){var a="#w_"+i.appid;if(HROS.widget.checkCookie(e,t)){var o=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));$(o).each(function(){if(this.realappid==i.realappid&&this.type==i.type){i.top=this.top;i.right=this.right}})}else{HROS.widget.addCookie(i.realappid,i.type,0,0)}TEMP.widgetTemp={title:i.title,width:i.width,height:i.height,type:i.type,id:"w_"+i.appid,appid:i.appid,realappid:i.realappid==0?i.appid:i.realappid,top:typeof i.top=="undefined"?0:i.top,right:typeof i.right=="undefined"?0:i.right,url:i.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:1};$("#desk").append(widgetWindowTemp(TEMP.widgetTemp));$(a).data("info",TEMP.widgetTemp);HROS.CONFIG.widgetIndexid+=1}ZENG.msgbox.show("小挂件正在加载中，请耐心等待...",6,1e5);$.ajax({type:"POST",url:ajaxUrl,data:"ac=getMyAppById&id="+e+"&type="+t}).done(function(a){ZENG.msgbox._hide();a=$.parseJSON(a);if(a!=null){if(a["error"]=="ERROR_NOT_FOUND"){ZENG.msgbox.show("小挂件不存在，建议删除",5,2e3);HROS.widget.removeCookie(e,t)}else if(a["error"]=="ERROR_NOT_INSTALLED"){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+e,width:800,height:484,isflash:false,refresh:true});HROS.widget.removeCookie(e,t)}else{o({appid:a["appid"],realappid:a["realappid"],title:a["name"],url:a["url"],type:a["type"],width:a["width"],height:a["height"],top:0,right:0})}}else{ZENG.msgbox.show("小挂件加载失败",5,2e3)}$("#d_"+i).attr("opening",0)})}},reduction:function(){var e=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));$(e).each(function(){HROS.widget.create(this.realappid,this.type)})},checkCookie:function(e,t){var i=false,a=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));$(a).each(function(){if(this.realappid==e&&this.type==t){i=true}});return i},addCookie:function(e,t,i,a){if(t=="widget"||t=="pwidget"){var o=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));if(HROS.widget.checkCookie(e,t)){$(o).each(function(){if(this.realappid==e&&this.type==t){this.top=i;this.right=a}})}else{if(o==null){o=[]}o.push({realappid:e,type:t,top:i,right:a})}$.cookie("widgetState"+HROS.CONFIG.memberID,$.toJSON(o),{expires:95})
}},removeCookie:function(e,t){if(t=="widget"||t=="pwidget"){if(HROS.widget.checkCookie(e,t)){var i=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));$(i).each(function(a){if(this.realappid==e&&this.type==t){i.splice(a,1);return false}});$.cookie("widgetState"+HROS.CONFIG.memberID,$.toJSON(i),{expires:95})}}},move:function(){$("#desk").on("mousedown",".widget .move",function(e){var t=$(this).parents(".widget");HROS.widget.show2top(t.attr("appid"));var i,a,o,s,n;a=e.clientX-t.offset().left;o=e.clientY-t.offset().top;$(document).on("mousemove",function(e){i=HROS.maskBox.desk();i.show();s=e.clientY-o;s=s<0?0:s;n=e.clientX-a;n=$(window).width()-t.width()-n;t.css({top:s,right:n})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof i!=="undefined"){i.hide()}if(t.attr("type")!="widgetTemp"){HROS.widget.addCookie(t.attr("realappid"),t.attr("type"),s,n)}})})},close:function(e){var t="#w_"+e;HROS.widget.removeCookie($(t).attr("realappid"),$(t).attr("type"));$(t).html("").remove()},show2top:function(e){var t="#w_"+e;$(t).css("z-index",HROS.CONFIG.widgetIndexid);HROS.CONFIG.widgetIndexid+=1},handle:function(){$("#desk").on("mousedown",".widget a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("click",".widget .ha-close",function(e){var t=$(this).parents(".widget");HROS.widget.close(t.attr("appid"))}).on("click",".widget .ha-star",function(){var e=$(this).parents(".widget");$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAppStar&id="+e.data("info").realappid}).done(function(t){$.dialog({title:"给“"+e.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({point:Math.floor(t),realpoint:t*20})})});$("body").off("click").on("click","#star ul li",function(){var t=$(this).attr("num");var i=$(this).parent("ul").data("realappid");if(!isNaN(t)&&/^[1-5]$/.test(t)){if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateAppStar&id="+e.data("info").realappid+"&starnum="+t}).done(function(e){$.dialog.list["star"].close();if(e){ZENG.msgbox.show("打分成功！",4,2e3)}else{ZENG.msgbox.show("你已经打过分了！",1,2e3)}})}else{HROS.base.login()}}})}).on("click",".widget .ha-share",function(){var e=$(this).parents(".widget");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey==""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey==""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+e.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+e.data("info").realappid+"%26type=widget"})});$("body").off("click").on("click","#share a",function(){$.dialog.list["share"].close()})})}}}();HROS.window=function(){return{init:function(){HROS.window.handle();HROS.window.move();HROS.window.resize();$("#desk").on("click",".window-container .window-mask, .window-container .folder_body",function(){HROS.window.show2top($(this).parents(".window-container").attr("appid"),true)});$("#desk").on("contextmenu",".window-container",function(){return false});$("#desk").on("click",".folder_body li",function(){return false}).on("contextmenu",".folder_body .appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();switch($(this).attr("type")){case"app":case"widget":var t=HROS.popupMenu.app($(this));break;case"papp":case"pwidget":var t=HROS.popupMenu.papp($(this));break}var i=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var a=$(window).height()-e.clientY<t.height()?e.clientY-t.height():e.clientY;t.css({left:i,top:a}).show();return false})},createTemp:function(e){var t="app",i=e.appid==null?Date.parse(new Date):e.appid;var a=false;$("#task-content-inner a.task-item").each(function(){if($(this).attr("realappid")==i){a=true;HROS.window.show2top($(this).attr("appid"));return false}});if(!a){function o(e){var t="#w_"+e.appid;$("#task-content-inner").prepend(taskTemp({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.appid,title:e.title,imgsrc:e.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={width:e.width,height:e.height,top:($(window).height()-e.height)/2<=0?0:($(window).height()-e.height)/2,left:($(window).width()-e.width)/2<=0?0:($(window).width()-e.width)/2,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.appid,title:e.title,url:e.url,imgsrc:e.imgsrc,isresize:e.isresize,isopenmax:e.isopenmax,istitlebar:e.isresize,istitlebarFullscreen:e.isresize?window.fullScreenApi.supportsFullScreen==true?true:false:false,issetbar:e.issetbar,isflash:e.isflash};$("#desk").append(windowTemp(TEMP.windowTemp));$(t).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;$(t+" iframe").load(function(){$(t+" .window-frame").children("div").eq(1).fadeOut()});HROS.window.show2top(e.appid)}o({type:t,appid:i,realappid:i,imgsrc:"img/ui/default_icon.png",title:e.title,url:e.url,width:e.width,height:e.height,isresize:typeof e.isresize=="undefined"?false:e.isresize,isopenmax:typeof e.isopenmax=="undefined"?false:e.isopenmax,issetbar:false,isflash:typeof e.isflash=="undefined"?true:e.isflash})}else{if(e.refresh){var s="#w_"+i;$(s).find("iframe").attr("src",e.url)}}},create:function(e,t){var t=t==null?"app":t,i;var a=false;$("#task-content-inner a.task-item").each(function(){if($(this).attr("realappid")==e){a=true;i=$(this).attr("appid");HROS.window.show2top(i);return false}});if(!a&&$("#d_"+i).attr("opening")!=1){$("#d_"+i).attr("opening",1);function o(e){var t="#w_"+e.appid;var i=($(window).height()-e.height)/2<=0?0:($(window).height()-e.height)/2;var a=($(window).width()-e.width)/2<=0?0:($(window).width()-e.width)/2;switch(e.type){case"app":case"papp":$("#task-content-inner").prepend(taskTemp({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={width:e.width,height:e.height,top:i,left:a,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,url:e.url,imgsrc:e.imgsrc,isresize:e.isresize==1?true:false,isopenmax:e.isresize==1?e.isopenmax==1?true:false:false,istitlebar:e.isresize==1?true:false,istitlebarFullscreen:e.isresize==1?window.fullScreenApi.supportsFullScreen==true?true:false:false,issetbar:e.issetbar==1?true:false,isflash:e.isflash==1?true:false};$("#desk").append(windowTemp(TEMP.windowTemp));$(t).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;$(t+" iframe").load(function(){$(t+" .window-frame").children("div").fadeOut()});HROS.window.show2top(e.appid);break;case"folder":$("#task-content-inner").prepend(taskTemp({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc}));HROS.taskbar.resize();TEMP.folderWindowTemp={width:e.width,height:e.height,top:i,left:a,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc};$("#desk").append(folderWindowTemp(TEMP.folderWindowTemp));$(t).data("info",TEMP.folderWindowTemp);HROS.CONFIG.windowIndexid+=1;var o="";$(HROS.VAR.folder).each(function(){if(this.appid==e.appid){o=this.apps;return false}});if(o!=""){var s="";$(o).each(function(){s+=appbtnTemp({top:0,left:0,title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid,imgsrc:this.icon})});$(t).find(".folder_body").append(s)}HROS.window.show2top(e.appid);break}}ZENG.msgbox.show("应用正在加载中，请耐心等待...",6,1e5);$.ajax({type:"POST",url:ajaxUrl,data:"ac=getMyAppById&id="+e+"&type="+t}).done(function(t){ZENG.msgbox._hide();t=$.parseJSON(t);if(t!=null){if(t["error"]=="ERROR_NOT_FOUND"){ZENG.msgbox.show("应用不存在，建议删除",5,2e3)}else if(t["error"]=="ERROR_NOT_INSTALLED"){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+e,width:800,height:484,isflash:false,refresh:true})}else{o({type:t["type"],appid:t["appid"],realappid:t["realappid"],title:t["name"],imgsrc:t["icon"],url:t["url"],width:t["width"],height:t["height"],isresize:t["isresize"],isopenmax:t["isopenmax"],issetbar:t["issetbar"],isflash:t["isflash"]})}}else{ZENG.msgbox.show("数据拉取失败",5,2e3)}$("#d_"+i).attr("opening",0)})}},close:function(e){var t="#w_"+e,i="#t_"+e;$(t).removeData("info").html("").remove();$("#task-content-inner "+i).html("").remove();$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);$("#task-bar, #nav-bar").removeClass("min-zIndex");HROS.taskbar.resize()},closeAll:function(){$("#desk .window-container").each(function(){HROS.window.close($(this).attr("appid"))})},hide:function(e){var t="#w_"+e,i="#t_"+e;$(t).css("left",-1e4).attr("state","hide");$("#task-content-inner "+i).removeClass("task-item-current");if($(t).attr("ismax")==1){$("#task-bar, #nav-bar").removeClass("min-zIndex")}},hideAll:function(){$("#task-content-inner a.task-item").removeClass("task-item-current");$("#desk-"+HROS.CONFIG.desk).nextAll("div.window-container").css("left",-1e4).attr("state","hide")},max:function(e){HROS.window.show2top(e);var t="#w_"+e,i="#t_"+e;$(t+" .title-handle .ha-max").hide().next(".ha-revert").show();$(t).addClass("window-maximize").attr("ismax",1).animate({width:"100%",height:"100%",top:0,left:0},200);$("#task-bar, #nav-bar").addClass("min-zIndex")},revert:function(e){HROS.window.show2top(e);var t="#w_"+e,i="#t_"+e;$(t+" .title-handle .ha-revert").hide().prev(".ha-max").show();var a=$(t),o=a.data("info");a.removeClass("window-maximize").attr("ismax",0).animate({width:o["width"],height:o["height"],left:o["left"],top:o["top"]},500);$("#task-bar, #nav-bar").removeClass("min-zIndex")},refresh:function(e){var t="#w_"+e,i="#t_"+e;if($(t+"_iframe").length!=0){$(t+"_iframe").attr("src",$(t+"_iframe").attr("src"))}else{HROS.window.updateFolder(e)}},show2top:function(e,t){t=t==null?false:t;var i="#w_"+e,a="#t_"+e;var o=$(i).data("info");var s=[];function n(){HROS.window.show2under();$("#task-content-inner "+a).addClass("task-item-current");if($(i).attr("ismax")==1){$("#task-bar, #nav-bar").addClass("min-zIndex")}$(i).addClass("window-current").css({"z-index":HROS.CONFIG.windowIndexid,left:o["left"],top:o["top"]}).attr("state","show");if($(i).attr("ismax")==1){$(i).css({left:0,top:0})}$(i+" .window-mask").hide();$(i+" iframe").show();HROS.CONFIG.windowIndexid+=1}if(t){var p=$(i).offset().left,r=p+$(i).width();var d=$(i).offset().top,l=d+$(i).height();var c=p+$(i).width()/2,f=d+$(i).height()/2;var h=parseInt($(i).css("zIndex"));$("#desk .window-container:not("+i+")").each(function(){var e=$(this).offset().left,t=e+$(this).width();var i=$(this).offset().top,a=i+$(this).height();var o=e+$(this).width()/2,n=i+$(this).height()/2;var u=parseInt($(this).css("zIndex"));var m="";if(u>h){if(e>=p&&e<=r&&i>=d&&i<=l||e>=p&&e<=r&&a>=d&&a<=l||t>=p&&t<=r&&i>=d&&i<=l||t>=p&&t<=r&&a>=d&&a<=l){m="x"}if(e>=p&&e<=r&&i<d&&a>l||t>=p&&t<=r&&i<d&&a>l){m="x"}if(i>=d&&i<=l&&e<p&&t>r||a>=d&&a<=l&&e<p&&t>r){m="y"}if(e>=p&&e<=r&&a>=d&&a<=l&&t>=p&&t<=r&&a>=d&&a<=l||e>=p&&e<=r&&i>=d&&i<=l&&t>=p&&t<=r&&i>=d&&i<=l){m="y"}}if(m!=""){var w,k;if(m=="x"){if(o>c){w="right";k=r-e+30}else{w="left";k=t-p+30}}else{if(n>f){w="bottom";k=l-i+30}else{w="top";k=a-d+30}}s.push({id:$(this).attr("id"),direction:w,distance:k})}});var u=0;for(var m=0;m<s.length;m++){var w=$("#"+s[m].id).offset().left,k=$("#"+s[m].id).offset().top;if(s[m].direction=="left"){$("#"+s[m].id).delay(u).animate({left:w-s[m].distance},300).animate({left:w},300)}else if(s[m].direction=="right"){$("#"+s[m].id).delay(u).animate({left:w+s[m].distance},300).animate({left:w},300)}else if(s[m].direction=="top"){$("#"+s[m].id).delay(u).animate({top:k-s[m].distance},300).animate({top:k},300)}else if(s[m].direction=="bottom"){$("#"+s[m].id).delay(u).animate({top:k+s[m].distance},300).animate({top:k},300)}u+=100}setTimeout(n,u+100)}else{n()}},show2under:function(){$("#task-content-inner a.task-item").removeClass("task-item-current");$("#desk .window-container").removeClass("window-current");$("#desk .window-container .window-mask").show();$("#desk .window-container-flash iframe").hide()},updateFolder:function(e){var t="#w_"+e,i="#t_"+e;var a="";$(HROS.VAR.folder).each(function(){if(this.appid==e){a=this.apps;return false}});if(a!=null){var o="";for(var s=0;s<a.length;s++){o+=appbtnTemp({top:0,left:0,title:a[s]["name"],type:a[s]["type"],id:"d_"+a[s]["appid"],appid:a[s]["appid"],realappid:a[s]["realappid"],imgsrc:a[s]["icon"]})}$(t).find(".folder_body").html("").append(o).on("contextmenu",".appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();TEMP.AppRight=HROS.popupMenu.app($(this));var t=$(window).width()-e.clientX<TEMP.AppRight.width()?e.clientX-TEMP.AppRight.width():e.clientX;var i=$(window).height()-e.clientY<TEMP.AppRight.height()?e.clientY-TEMP.AppRight.height():e.clientY;TEMP.AppRight.css({left:t,top:i}).show();return false})}},handle:function(){$("#desk").on("mousedown",".window-container .title-bar .title-handle a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("dblclick",".window-container .title-bar",function(e){var t=$(this).parents(".window-container");if(t.find(".ha-max").is(":hidden")){t.find(".ha-revert").click()}else{t.find(".ha-max").click()}}).on("click",".window-container .ha-hide",function(){var e=$(this).parents(".window-container");HROS.window.hide(e.attr("appid"))}).on("click",".window-container .ha-max",function(){var e=$(this).parents(".window-container");HROS.window.max(e.attr("appid"))}).on("click",".window-container .ha-revert",function(){var e=$(this).parents(".window-container");HROS.window.revert(e.attr("appid"))}).on("click",".window-container .ha-fullscreen",function(){var e=$(this).parents(".window-container");window.fullScreenApi.requestFullScreen(document.getElementById(e.find("iframe").attr("id")))}).on("click",".window-container .ha-close",function(){var e=$(this).parents(".window-container");HROS.window.close(e.attr("appid"))}).on("click",".window-container .refresh",function(){var e=$(this).parents(".window-container");HROS.window.refresh(e.attr("appid"))}).on("click",".window-container .detail",function(){var e=$(this).parents(".window-container");if(e.attr("realappid")!==0){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+e.attr("realappid"),width:800,height:484,isflash:false,refresh:true})}else{ZENG.msgbox.show("对不起，该应用没有任何详细介绍",1,2e3)}}).on("click",".window-container .star",function(){var e=$(this).parents(".window-container");$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAppStar&id="+e.data("info").realappid}).done(function(t){$.dialog({title:"给“"+e.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({point:Math.floor(t),realpoint:t*20})})});$("body").off("click").on("click","#star ul li",function(){var t=$(this).attr("num");var i=$(this).parent("ul").data("realappid");if(!isNaN(t)&&/^[1-5]$/.test(t)){if(HROS.base.checkLogin()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateAppStar&id="+e.data("info").realappid+"&starnum="+t}).done(function(e){$.dialog.list["star"].close();if(e){ZENG.msgbox.show("打分成功！",4,2e3)}else{ZENG.msgbox.show("你已经打过分了！",1,2e3)}})}else{HROS.base.login()}}})}).on("click",".window-container .share",function(){var e=$(this).parents(".window-container");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey==""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey==""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+e.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+e.data("info").realappid+"%26type=app"})});$("body").off("click").on("click","#share a",function(){$.dialog.list["share"].close()})}).on("contextmenu",".window-container",function(){$(".popup-menu").hide();$(".quick_view_container").remove();return false})},move:function(){$("#desk").on("mousedown",".window-container .title-bar",function(e){var t=$(this).parents(".window-container");if(t.attr("ismax")==1){return false}HROS.window.show2top(t.attr("appid"));var i=t.data("info"),a,o,s;o=e.clientX-t.offset().left;s=e.clientY-t.offset().top;$(document).on("mousemove",function(e){a=HROS.maskBox.desk();a.show();t.find(".ha-revert").hide().prev(".ha-max").show();_l=e.clientX-o;_t=e.clientY-s;_w=i["width"];_h=i["height"];_t=_t<=10?0:_t>=a.height()-30?a.height()-30:_t;t.css({width:_w,height:_h,left:_l,top:_t});t.data("info").left=t.offset().left;t.data("info").top=t.offset().top}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof a!=="undefined"){a.hide()}})})},resize:function(e){$("#desk").on("mousedown",".window-container .window-resize",function(e){var t=$(this).parents(".window-container");var i=$(this),a,o=e.clientX,s=e.clientY,n=t.width(),p=t.height();$(document).on("mousemove",function(e){a=HROS.maskBox.desk();a.show();_x=e.clientX;_y=e.clientY;_x=_x<=10?0:_x>=a.width()-12?a.width()-2:_x;_y=_y<=10?0:_y>=a.height()-12?a.height():_y;switch(i.attr("resize")){case"t":p+s-_y>HROS.CONFIG.windowMinHeight?t.css({height:p+s-_y,top:_y}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"r":n-o+_x>HROS.CONFIG.windowMinWidth?t.css({width:n-o+_x}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"b":p-s+_y>HROS.CONFIG.windowMinHeight?t.css({height:p-s+_y}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"l":n+o-_x>HROS.CONFIG.windowMinWidth?t.css({width:n+o-_x,left:_x}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"rt":p+s-_y>HROS.CONFIG.windowMinHeight?t.css({height:p+s-_y,top:_y}):t.css({height:HROS.CONFIG.windowMinHeight});n-o+_x>HROS.CONFIG.windowMinWidth?t.css({width:n-o+_x}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"rb":n-o+_x>HROS.CONFIG.windowMinWidth?t.css({width:n-o+_x}):t.css({width:HROS.CONFIG.windowMinWidth});p-s+_y>HROS.CONFIG.windowMinHeight?t.css({height:p-s+_y}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"lt":n+o-_x>HROS.CONFIG.windowMinWidth?t.css({width:n+o-_x,left:_x}):t.css({width:HROS.CONFIG.windowMinWidth});p+s-_y>HROS.CONFIG.windowMinHeight?t.css({height:p+s-_y,top:_y}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"lb":n+o-_x>HROS.CONFIG.windowMinWidth?t.css({width:n+o-_x,left:_x}):t.css({width:HROS.CONFIG.windowMinWidth});p-s+_y>HROS.CONFIG.windowMinHeight?t.css({height:p-s+_y}):t.css({height:HROS.CONFIG.windowMinHeight});break}}).on("mouseup",function(){if(typeof a!=="undefined"){a.hide()}t.data("info").width=t.width();t.data("info").height=t.height();t.data("info").left=t.offset().left;t.data("info").top=t.offset().top;t.data("info").emptyW=$(window).width()-t.width();t.data("info").emptyH=$(window).height()-t.height();$(this).off("mousemove").off("mouseup")})})}}}();HROS.zoom=function(){return{init:function(){$("body").append('<div id="zoombox"></div>');swfobject.embedSWF("js/zoom.swf?onchange=HROS.zoom.check","zoombox","10","10","6.0.0","expressInstall.swf","",{allowScriptAccess:"always",wmode:"transparent",scale:"noScale"},{id:"accessory_zoom",name:"zoom_detect"})},check:function(e){var t=e.scale,i=t>1?"放大":"缩小";if(t!=1){HROS.VAR.zoomLevel=t;$("#zoom-tip").show().find("span").text("您的浏览器目前处于"+i+"状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！")}else{if(t!=HROS.VAR.zoomLevel){$("#zoom-tip").fadeOut()}}},close:function(){$("#zoom-tip").remove()}}}();