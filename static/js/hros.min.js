var version="3.3.3";var ajaxUrl="ajax.php";var HROS={};HROS.maskBoxCache={};HROS.templateCache={};HROS.CONFIG={website:"http://"+location.hostname+location.pathname,memberID:0,desk:1,dockPos:"",appXY:"",appSize:48,appMarginTop:20,appMarginLeft:20,appVerticalSpacing:50,appHorizontalSpacing:50,windowIndexid:1e4,widgetIndexid:1,windowMinWidth:215,windowMinHeight:59,wallpaperState:1,wallpaper:"",wallpaperType:"",wallpaperWidth:0,wallpaperHeight:0};HROS.VAR={zoomLevel:1,isAppMoving:false,dock:[],desk1:[],desk2:[],desk3:[],desk4:[],desk5:[],folder:[]};HROS.app=function(){return{init:function(){$("#desk").on("click",".add",function(){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php",width:800,height:484,isflash:false})});HROS.app.move();HROS.app.moveScrollbar();$("body").on("contextmenu",".appbtn:not(.add)",function(e){HROS.popupMenu.hide();switch($(this).attr("type")){case"window":case"widget":HROS.popupMenu.app(e,$(this));break;case"pwindow":case"pwidget":HROS.popupMenu.papp(e,$(this));break;case"folder":HROS.popupMenu.folder(e,$(this));break;case"file":HROS.popupMenu.file(e,$(this));break}return false});HROS.app.get()},updateXY:function(e){if(HROS.CONFIG.appXY!=e){HROS.CONFIG.appXY=e;HROS.deskTop.resize();if(HROS.base.checkLogin()){$.ajax({data:{ac:"setAppXY",appxy:e}})}}},updateSize:function(e){if(HROS.CONFIG.appSize!=e){HROS.CONFIG.appSize=e;HROS.deskTop.resize();if(HROS.base.checkLogin()){$.ajax({data:{ac:"setAppSize",appsize:e}})}}},updateVertical:function(e){if(HROS.CONFIG.appVerticalSpacing!=e){HROS.CONFIG.appVerticalSpacing=e;HROS.deskTop.resize();if(HROS.base.checkLogin()){$.ajax({data:{ac:"setAppVerticalSpacing",appverticalspacing:e}})}}},updateHorizontal:function(e){if(HROS.CONFIG.appHorizontalSpacing!=e){HROS.CONFIG.appHorizontalSpacing=e;HROS.deskTop.resize();if(HROS.base.checkLogin()){$.ajax({data:{ac:"setAppHorizontalSpacing",apphorizontalspacing:e}})}}},get:function(){$.ajax({data:{ac:"getMyApp"},beforeSend:function(){HROS.VAR.isAppMoving=true}}).done(function(e){HROS.VAR.isAppMoving=false;if(typeof e=="object"){if(typeof e["dock"]=="object"){HROS.VAR.dock=e["dock"]}if(typeof e["desk1"]=="object"){HROS.VAR.desk1=e["desk1"]}if(typeof e["desk2"]=="object"){HROS.VAR.desk2=e["desk2"]}if(typeof e["desk3"]=="object"){HROS.VAR.desk3=e["desk3"]}if(typeof e["desk4"]=="object"){HROS.VAR.desk4=e["desk4"]}if(typeof e["desk5"]=="object"){HROS.VAR.desk5=e["desk5"]}if(typeof e["folder"]=="object"){HROS.VAR.folder=e["folder"]}}HROS.app.set()})},set:function(){var dock_append="";if(HROS.VAR.dock!=""){$(HROS.VAR.dock).each(function(){dock_append+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon,appsize:48})})}$("#dock-bar .dock-applist .appbtn").remove();$("#dock-bar .dock-applist").append(dock_append);for(var j=1;j<=5;j++){var desk_append="";var desk=eval("HROS.VAR.desk"+j);if(desk!=""){$(desk).each(function(){desk_append+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon,appsize:HROS.CONFIG.appSize})})}desk_append+=HROS.template.add({appsize:HROS.CONFIG.appSize});$("#desk-"+j+" .desktop-apps-container .appbtn").remove();$("#desk-"+j+" .desktop-apps-container").append(desk_append)}HROS.app.setPos(false);$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))});$("#desk .folder-window").each(function(){HROS.window.updateFolder($(this).attr("appid"))});HROS.app.getScrollbar()},setPos:function(e){$("#desk .desktop-container .appbtn img").width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);$("#desk .desktop-container .appbtn span").width(Number(HROS.CONFIG.appSize)+10);e=e==null?true:e;var t=HROS.grid.getAppGrid(),a=HROS.grid.getDockAppGrid();$("#dock-bar .dock-applist .appbtn").each(function(e){$(this).css({top:HROS.CONFIG.dockPos=="top"?a[e]["startY"]:a[e]["startY"]+5,left:HROS.CONFIG.dockPos=="top"?a[e]["startX"]+5:a[e]["startX"]}).attr("top",$(this).offset().top).attr("left",$(this).offset().left)});for(var i=1;i<=5;i++){$("#desk-"+i+" .appbtn").each(function(a){var i=HROS.CONFIG.appVerticalSpacing/2;var o=HROS.CONFIG.appHorizontalSpacing/2;var n=t[a]["startY"]+i;var s=t[a]["startX"]+o;$(this).stop(true,false).animate({top:n,left:s},e?500:0);switch(HROS.CONFIG.dockPos){case"top":$(this).attr("left",s).attr("top",n+$("#dock-bar").height());break;case"left":$(this).attr("left",s+$("#dock-bar").width()).attr("top",n);break;default:$(this).attr("left",s).attr("top",n)}})}HROS.app.getScrollbar()},add:function(e,t){function a(){t&&t()}if(HROS.base.checkLogin()){$.ajax({data:{ac:"addMyApp",id:e,desk:HROS.CONFIG.desk}}).done(function(e){a()})}else{a()}},remove:function(e,t){function a(){HROS.widget.removeCookie(e);t&&t()}if(HROS.base.checkLogin()){$.ajax({data:{ac:"delMyApp",id:e}}).done(function(e){a()})}else{a()}},move:function(){$("#dock-bar .dock-applist").on("mousedown",".appbtn",function(e){e.preventDefault();e.stopPropagation();if(e.which==1){var t=$(this);var a=$('<div id="shortcut_shadow">'+t.html()+"</div>");var i=e.clientX;var o=e.clientY;var n=e.clientX;var s=e.clientY;var r=i-t.offset().left;var p=o-t.offset().top;var d=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(a);d.show();n=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;if(i!=n||o!=s){a.css({left:n-r,top:s-p}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");a.remove();d.hide();if(i==n&&o==s){switch(t.attr("type")){case"window":case"pwindow":case"file":HROS.window.create(t.attr("appid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("appid"),t.attr("type"));break;case"folder":HROS.folderView.get(t);break}return false}var e=HROS.grid.searchFolderGrid(n,s);if(e!=null){if(t.hasClass("folder")==false){var r=t.attr("appid");var p=t.index();var c=e;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToFolder(r,p,c)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-folder",id:r,from:p,to:c}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToFolder(r,p,c)}}}else{var l=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width();var f=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-container").height()+20)/2;var e=HROS.grid.searchDockAppGrid(n-l,s-f);if(e!=null){if(e!=t.index()){var h=HROS.grid.searchDockAppGrid2(n-l,s-f);var r=t.attr("appid");var p=t.index();var c=e;var u=h%2==0?"b":"a";if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDock(r,p,c,u)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-dock",id:r,from:p,to:c,boa:u}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDock(r,p,c,u)}}}else{var l=HROS.CONFIG.dockPos=="left"?$("#dock-bar").width():0;var f=HROS.CONFIG.dockPos=="top"?$("#dock-bar").height():0;var k=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft();var w=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();var e=HROS.grid.searchAppGrid(n-l+k,s-f+w);if(e!=null){var h=HROS.grid.searchAppGrid2(n-l+k,s-f+w);var r=t.attr("appid");var p=t.index();var c=e;var u=h%2==0?"b":"a";var O=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDesk(r,p,c,u,O)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-desk",id:r,from:p,to:c,boa:u,desk:O}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDesk(r,p,c,u,O)}}}}})}});$("#desktop .desktop-apps-container").on("mousedown",".appbtn",function(e){e.preventDefault();e.stopPropagation();if(e.which==1&&!$(this).hasClass("add")){var t=$(this);var a=$('<div id="shortcut_shadow">'+t.html()+"</div>");var i=e.clientX;var o=e.clientY;var n=e.clientX;var s=e.clientY;var r=i-t.offset().left;var p=o-t.offset().top;var d=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(a);d.show();n=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;if(i!=n||o!=s){a.css({left:n-r,top:s-p}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");a.remove();d.hide();if(i==n&&o==s){switch(t.attr("type")){case"window":case"pwindow":case"file":HROS.window.create(t.attr("appid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("appid"),t.attr("type"));break;case"folder":HROS.folderView.get(t);break}return false}var e=HROS.grid.searchFolderGrid(n,s);if(e!=null){if(t.attr("type")!="folder"){var r=t.attr("appid");var p=t.index();var c=e;var l=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToFolder(r,p,c,l)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-folder",id:r,from:p,to:c,desk:l}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToFolder(r,p,c,l)}}}else{var f=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width();var h=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-container").height()+20)/2;var e=HROS.grid.searchDockAppGrid(n-f,s-h);if(e!=null){var u=HROS.grid.searchDockAppGrid2(n-f,s-h);var r=t.attr("appid");var p=t.index();var c=e;var k=u%2==0?"b":"a";var l=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDock(r,p,c,k,l)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-dock",id:r,from:p,to:c,boa:k,desk:l}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDock(r,p,c,k,l)}}else{var f=HROS.CONFIG.dockPos=="left"?$("#dock-bar").width():0;var h=HROS.CONFIG.dockPos=="top"?$("#dock-bar").height():0;var w=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft();var O=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();var e=HROS.grid.searchAppGrid(n-f+w,s-h+O);if(e!=null&&e!=t.index()){var u=HROS.grid.searchAppGrid2(n-f+w,s-h+O);var r=t.attr("appid");var p=t.index();var c=e;var k=u%2==0?"b":"a";var l=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDesk(r,p,c,k,l)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-desk",id:r,from:p,to:c,boa:k,desk:l}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDesk(r,p,c,k,l)}}}}})}});$("body").on("mousedown",".folder_body .appbtn, .quick_view_container .appbtn",function(e){e.preventDefault();e.stopPropagation();if(e.which==1){var t=$(this);var a=$('<div id="shortcut_shadow">'+t.html()+"</div>");var i=e.clientX;var o=e.clientY;var n=e.clientX;var s=e.clientY;var r=i-t.offset().left;var p=o-t.offset().top;var d=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(a);d.show();n=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;if(i!=n||o!=s){a.css({left:n-r,top:s-p}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");a.remove();d.hide();if(i==n&&o==s){switch(t.attr("type")){case"window":case"pwindow":case"file":HROS.window.create(t.attr("appid"),t.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(t.attr("appid"),t.attr("type"));break}return false}var e=HROS.grid.searchFolderGrid(n,s);if(e!=null){if((t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid"))!=e){var r=t.attr("appid");var p=t.index();var c=e;var l=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToFolder(r,p,c,l)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-folder",id:r,from:p,to:c}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToFolder(r,p,c,l)}}}else{var f=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width();var h=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-container").height()+20)/2;var e=HROS.grid.searchDockAppGrid(n-f,s-h);if(e!=null){var u=HROS.grid.searchDockAppGrid2(n-f,s-h);var r=t.attr("appid");var p=t.index();var c=e;var l=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid");var k=u%2==0?"b":"a";var w=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToDock(r,p,c,l,k,w)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-dock",id:r,to:c,boa:k,desk:w}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToDock(r,p,c,l,k,w)}}else{var f=HROS.CONFIG.dockPos=="left"?$("#dock-bar").width():0;var h=HROS.CONFIG.dockPos=="top"?$("#dock-bar").height():0;var O=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft();var m=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop();var e=HROS.grid.searchAppGrid(n-f+O,s-h+m);if(e!=null){var u=HROS.grid.searchAppGrid2(n-f+O,s-h+m);var r=t.attr("appid");var p=t.index();var c=e;var l=t.parents(".folder-window").attr("appid")||t.parents(".quick_view_container").attr("appid");var k=u%2==0?"b":"a";var w=HROS.CONFIG.desk;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataFolderToDesk(r,p,c,l,k,w)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-desk",id:r,to:c,boa:k,desk:w}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataFolderToDesk(r,p,c,l,k,w)}}}}})}})},getScrollbar:function(){setTimeout(function(){$("#desk .desktop-container").each(function(){var e=$(this).children(".desktop-apps-container"),t=$(this).children(".scrollbar");var a=e.nextAll(".scrollbar-x").position().left,i=e.nextAll(".scrollbar-y").position().top;t.hide();e.scrollLeft(0).scrollTop(0);if(HROS.CONFIG.appXY=="x"){var o=parseInt(e.children(".add").css("top"))+parseInt(e.children(".add").outerHeight());if(e.height()<o){e.nextAll(".scrollbar-y").height(e.height()/o*e.height());i=i+e.nextAll(".scrollbar-y").height()>e.height()?e.height()-e.nextAll(".scrollbar-y").height():i;e.nextAll(".scrollbar-y").css("top",i).show();e.scrollTop(i/e.height()*o)}}else{var n=parseInt(e.children(".add").css("left"))+parseInt(e.children(".add").outerWidth());if(e.width()<n){e.nextAll(".scrollbar-x").width(e.width()/n*e.width());a=a+e.nextAll(".scrollbar-x").width()>e.width()?e.width()-e.nextAll(".scrollbar-w").width():a;e.nextAll(".scrollbar-x").css("left",a).show();e.scrollLeft(a/e.width()*n)}}})},500)},moveScrollbar:function(){$("#desk .scrollbar").on("mousedown",function(e){var t,a,i,o,n,s,r,p;var d=$(this),c=d.prevAll(".desktop-apps-container");n=parseInt(c.children(".add").css("left"))+parseInt(c.children(".add").outerWidth());s=parseInt(c.children(".add").css("top"))+parseInt(c.children(".add").outerHeight());r=c.width()-d.width();p=c.height()-d.height();if(d.hasClass("scrollbar-x")){t=e.clientX-d.position().left}else{a=e.clientY-d.position().top}$(document).on("mousemove",function(e){if(d.hasClass("scrollbar-x")){i=e.clientX-t<0?0:e.clientX-t>r?r:e.clientX-t;d.css("left",i);c.scrollLeft(i/c.width()*n)}else{o=e.clientY-a<0?0:e.clientY-a>p?p:e.clientY-a;d.css("top",o);c.scrollTop(o/c.height()*s)}}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});for(var e=1;e<=5;e++){$("#desk-"+e).on("mousewheel",function(e,t){var a=$(this).find(".desktop-apps-container");if(HROS.CONFIG.appXY=="x"){var i=parseInt(a.find(".add").css("top"))+parseInt(a.children(".add").outerHeight()),o;if(t<0){o=a.scrollTop()+200>i-a.height()?i-a.height():a.scrollTop()+200}else{o=a.scrollTop()-200<0?0:a.scrollTop()-200}a.stop(false,true).animate({scrollTop:o},300);a.nextAll(".scrollbar-y").stop(false,true).animate({top:o/i*a.height()},300)}else{var n=parseInt(a.find(".add").css("left"))+parseInt(a.children(".add").outerWidth()),s;if(t<0){s=a.scrollLeft()+200>n-a.width()?n-a.width():a.scrollLeft()+200}else{s=a.scrollLeft()-200<0?0:a.scrollLeft()-200}a.stop(false,true).animate({scrollLeft:s},300);a.nextAll(".scrollbar-x").stop(false,true).animate({left:s/n*a.width()},300)}})}},checkIsMoving:function(){var e=false;if(HROS.VAR.isAppMoving){swal({type:"warning",title:"温馨提示",text:"数据正在处理中，请稍后…",timer:2e3,showConfirmButton:false});e=true}else{HROS.VAR.isAppMoving=true}return e},dataWarning:function(){swal({type:"error",title:"温馨提示",text:"数据错误，请刷新后重试",timer:2e3,showConfirmButton:false})},dataDockToFolder:function(e,t,a){var i=false;$(HROS.VAR.dock).each(function(t){if(this.appid==e){$(HROS.VAR.folder).each(function(e){if(this.appid==a){HROS.VAR.folder[e].apps.push(HROS.VAR.dock[t]);HROS.VAR.folder[e].apps=Sugar.Array(HROS.VAR.folder[e].apps).sortBy(function(e){return e.appid},true).raw;HROS.VAR.dock.splice(t,1);i=true;return false}});return false}});if(i){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return i},dataDockToDock:function(e,t,a,i){var o=false;if(HROS.VAR.dock[t]!=null){if(a==0){if(i=="b"){HROS.VAR.dock.splice(0,0,HROS.VAR.dock[t])}else{HROS.VAR.dock.splice(1,0,HROS.VAR.dock[t])}}else{if(i=="b"){HROS.VAR.dock.splice(a,0,HROS.VAR.dock[t])}else{HROS.VAR.dock.splice(a+1,0,HROS.VAR.dock[t])}}if(t>a){HROS.VAR.dock.splice(t+1,1)}else{HROS.VAR.dock.splice(t,1)}o=true}if(o){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return o},dataDockToDesk:function(id,from,to,boa,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(HROS.VAR.dock[from]!=null){if(to==0){if(boa=="b"){desk.splice(0,0,HROS.VAR.dock[from])}else{desk.splice(1,0,HROS.VAR.dock[from])}}else{if(boa=="b"){desk.splice(to,0,HROS.VAR.dock[from])}else{desk.splice(to+1,0,HROS.VAR.dock[from])}}HROS.VAR.dock.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDockToOtherdesk:function(id,from,todesk){var rtn=false;todesk=eval("HROS.VAR.desk"+todesk);if(HROS.VAR.dock[from]!=null){todesk.push(HROS.VAR.dock[from]);HROS.VAR.dock.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDockToDelete:function(e,t){var a=false;if(HROS.VAR.dock[t]!=null){HROS.VAR.dock.splice(t,1);a=true}if(a){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return a},dataDeskToFolder:function(id,from,to,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==to&&desk[from]!=null){HROS.VAR.folder[e].apps.push(desk[from]);HROS.VAR.folder[e].apps=Sugar.Array(HROS.VAR.folder[e].apps).sortBy(function(e){return e.appid},true).raw;desk.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToDock:function(id,from,to,boa,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(desk[from]!=null){if(to==0){if(boa=="b"){HROS.VAR.dock.splice(0,0,desk[from])}else{HROS.VAR.dock.splice(1,0,desk[from])}}else{if(boa=="b"){HROS.VAR.dock.splice(to,0,desk[from])}else{HROS.VAR.dock.splice(to+1,0,desk[from])}}desk.splice(from,1);if(HROS.VAR.dock.length>7){desk.push(HROS.VAR.dock[7]);HROS.VAR.dock.splice(7,1)}rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToDesk:function(id,from,to,boa,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);if(desk[from]!=null){if(to==0){if(boa=="b"){desk.splice(0,0,desk[from])}else{desk.splice(1,0,desk[from])}}else{if(boa=="b"){desk.splice(to,0,desk[from])}else{desk.splice(to+1,0,desk[from])}}if(from>to){desk.splice(from+1,1)}else{desk.splice(from,1)}rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataDeskToOtherdesk:function(id,from,to,boa,todesk,fromdesk){var rtn=false;fromdesk=eval("HROS.VAR.desk"+fromdesk);todesk=eval("HROS.VAR.desk"+todesk);if(fromdesk[from]!=null){if(to==0){if(boa=="b"){todesk.splice(0,0,fromdesk[from])}else{todesk.splice(1,0,fromdesk[from])}}else{if(boa=="b"){todesk.splice(to,0,fromdesk[from])}else{todesk.splice(to+1,0,fromdesk[from])}}fromdesk.splice(from,1);rtn=true}if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToFolder:function(e,t,a,i){var o=false,n=0,s,r;$(HROS.VAR.folder).each(function(e){if(this.appid==i&&HROS.VAR.folder[e].apps[t]!=null){s=e;n+=1}if(this.appid==a){r=e;n+=1}});if(n==2){HROS.VAR.folder[r].apps.push(HROS.VAR.folder[s].apps[t]);HROS.VAR.folder[r].apps=Sugar.Array(HROS.VAR.folder[r].apps).sortBy(function(e){return e.appid},true).raw;HROS.VAR.folder[s].apps.splice(t,1);o=true}if(o){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return o},dataFolderToDock:function(id,from,to,fromFolderId,boa,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){if(to==0){if(boa=="b"){HROS.VAR.dock.splice(0,0,HROS.VAR.folder[e].apps[from])}else{HROS.VAR.dock.splice(1,0,HROS.VAR.folder[e].apps[from])}}else{if(boa=="b"){HROS.VAR.dock.splice(to,0,HROS.VAR.folder[e].apps[from])}else{HROS.VAR.dock.splice(to+1,0,HROS.VAR.folder[e].apps[from])}}HROS.VAR.folder[e].apps.splice(from,1);if(HROS.VAR.dock.length>7){desk.push(HROS.VAR.dock[7]);HROS.VAR.dock.splice(7,1)}rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToDesk:function(id,from,to,fromFolderId,boa,desk){var rtn=false;desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){if(to==0){if(boa=="b"){desk.splice(0,0,HROS.VAR.folder[e].apps[from])}else{desk.splice(1,0,HROS.VAR.folder[e].apps[from])}}else{if(boa=="b"){desk.splice(to,0,HROS.VAR.folder[e].apps[from])}else{desk.splice(to+1,0,HROS.VAR.folder[e].apps[from])}}HROS.VAR.folder[e].apps.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataFolderToOtherdesk:function(id,from,todesk,fromFolderId){var rtn=false;todesk=eval("HROS.VAR.desk"+todesk);$(HROS.VAR.folder).each(function(e){if(this.appid==fromFolderId&&HROS.VAR.folder[e].apps[from]!=null){todesk.push(HROS.VAR.folder[e].apps[from]);HROS.VAR.folder[e].apps.splice(from,1);rtn=true;return false}});if(rtn){if($("#desktop").is(":visible")){HROS.app.set()}else{HROS.appmanage.set()}}else{HROS.app.dataWarning()}return rtn},dataAllDockToDesk:function(desk){desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.dock).each(function(e){desk.push(HROS.VAR.dock[e])});HROS.VAR.dock.splice(0,HROS.VAR.dock.length)},dataDeleteByAppid:function(appid){$(HROS.VAR.dock).each(function(e){if(this.appid==appid){HROS.VAR.dock.splice(e,1);return false}});for(var i=1;i<=5;i++){var desk=eval("HROS.VAR.desk"+i);$(desk).each(function(e){if(this.appid==appid){desk.splice(e,1);if(this.type=="folder"){$(HROS.VAR.folder).each(function(e){if(this.appid==appid){HROS.VAR.folder.splice(e,1);return false}})}return false}})}$(HROS.VAR.folder).each(function(e){$(this.apps).each(function(t){if(this.appid==appid){HROS.VAR.folder[e].apps.splice(t,1);return false}})})}}}();HROS.appmanage=function(){return{init:function(){$("#appmanage .amg_close").off("click").on("click",function(){HROS.appmanage.close()});$("#amg_dock_container, #amg_folder_container").on("contextmenu",".appbtn",function(){return false});HROS.appmanage.move();HROS.appmanage.moveScrollbar()},set:function(){$("#desktop").hide();$("#appmanage").show();$("#amg_folder_container .folderItem").show().addClass("folderItem_turn");$("#amg_folder_container .folderInner").height($(window).height()-80);var dock_append="";if(HROS.VAR.dock!=""){$(HROS.VAR.dock).each(function(e){dock_append+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon,appsize:48})})}$("#amg_dock_container .appbtn").remove();$("#amg_dock_container").append(dock_append);for(var j=0;j<5;j++){var desk_append="",desk=eval("HROS.VAR.desk"+(j+1));if(desk!=""){$(desk).each(function(e){desk_append+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid==0?this.appid:this.realappid,imgsrc:this.icon,appsize:26})})}$("#amg_folder_container .folderItem:eq("+j+") .folderInner .appbtn").remove();$("#amg_folder_container .folderItem:eq("+j+") .folderInner").append(desk_append)}HROS.appmanage.setPos();HROS.appmanage.getScrollbar()},setPos:function(){var e=HROS.grid.getManageDockAppGrid(),t=HROS.grid.getManageAppGrid();$("#amg_dock_container .appbtn").each(function(t){$(this).css({top:10,left:e[t]["startX"]+6})});for(var a=0;a<5;a++){$("#amg_folder_container .folderItem:eq("+a+") .folderInner .appbtn").each(function(e){$(this).css({top:t[e]["startY"]+5,left:0})})}},move:function(){$("#amg_dock_container").on("mousedown",".appbtn",function(e){e.preventDefault();e.stopPropagation();if(e.which==1){var t=$(this);var a=$('<div id="shortcut_shadow">'+t.html()+"</div>");var i=e.clientX;var o=e.clientY;var n=e.clientX;var s=e.clientY;var r=i-t.offset().left;var p=o-t.offset().top;var d=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(a);d.show();n=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;if(i!=n||o!=s){a.css({left:n-r,top:s-p}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");a.remove();d.hide();if(i==n&&o==s){HROS.appmanage.close();switch(t.attr("type")){case"widget":case"pwidget":HROS.widget.create(t.attr("appid"),t.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(t.attr("appid"),t.attr("type"));break}return false}if(s<=80){var e=HROS.grid.searchManageDockAppGrid(n);if(e!=null&&e!=t.index()){var r=HROS.grid.searchManageDockAppGrid2(n);var p=t.attr("appid");var c=t.index();var l=e;var f=r%2==0?"b":"a";if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDock(p,c,l,f)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-dock",id:p,from:c,to:l,boa:f}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDock(p,c,l,f)}}}else{var h=parseInt(n/($(window).width()/5));var e=HROS.grid.searchManageAppGrid(s-80+$("#amg_folder_container .folderItem:eq("+h+") .folderInner").scrollTop());if(e!=null){var r=HROS.grid.searchManageAppGrid2(s-80+$("#amg_folder_container .folderItem:eq("+h+") .folderInner").scrollTop());var p=t.attr("appid");var c=t.index();var l=e;var f=r%2==0?"b":"a";var u=h+1;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDockToDesk(p,c,l,f,u)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-desk",id:p,from:c,to:l,boa:f,desk:u}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDockToDesk(p,c,l,f,u)}}}})}return false});$("#amg_folder_container").on("mousedown",".appbtn:not(.add)",function(e){e.preventDefault();e.stopPropagation();if(e.which==1){var t=$(this);var a=$('<div id="shortcut_shadow2">'+t.html()+"</div>");var i=e.clientX;var o=e.clientY;var n=e.clientX;var s=e.clientY;var r=i-t.offset().left;var p=o-t.offset().top;var d=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(a);d.show();n=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;s=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;if(i!=n||o!=s){a.css({left:n-r,top:s-p}).show()}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");a.remove();d.hide();if(i==n&&o==s){HROS.appmanage.close();switch(t.attr("type")){case"widget":case"pwidget":HROS.widget.create(t.attr("appid"),t.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(t.attr("appid"),t.attr("type"));break}return false}if(s<=80){function e(){var e=HROS.grid.searchManageDockAppGrid(n);if(e!=null){var a=HROS.grid.searchManageDockAppGrid2(n);var i=t.attr("appid");var o=t.index();var s=e;var r=a%2==0?"b":"a";var p=t.parent().attr("desk");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDock(i,o,s,r,p)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-dock",id:i,from:o,to:s,boa:r,desk:p}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDock(i,o,s,r,p)}}}if(HROS.CONFIG.dockPos=="none"){swal({type:"warning",title:"温馨提示",text:"当前应用码头处于停用状态，是否开启？",showCancelButton:true,confirmButtonText:"是的",cancelButtonText:"不用"},function(){HROS.dock.updatePos("top");e()})}else{e()}}else{var r=parseInt(n/($(window).width()/5));var p=HROS.grid.searchManageAppGrid(s-80+$("#amg_folder_container .folderItem:eq("+r+") .folderInner").scrollTop());if(r+1==t.parent().attr("desk")){if(p!=null&&p!=t.index()){var c=HROS.grid.searchManageAppGrid2(s-80+$("#amg_folder_container .folderItem:eq("+r+") .folderInner").scrollTop());var l=t.attr("appid");var f=t.index();var h=p;var u=c%2==0?"b":"a";var k=r+1;if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToDesk(l,f,h,u,k)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-desk",id:l,from:f,to:h,boa:u,desk:k}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToDesk(l,f,h,u,k)}}}else{if(p!=null){var c=HROS.grid.searchManageAppGrid2(s-80+$("#amg_folder_container .folderItem:eq("+r+") .folderInner").scrollTop());var l=t.attr("appid");var f=t.index();var h=p;var u=c%2==0?"b":"a";var w=r+1;var O=t.parent().attr("desk");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){if(HROS.app.dataDeskToOtherdesk(l,f,h,u,w,O)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-otherdesk",id:l,from:f,to:h,boa:u,fromdesk:O,todesk:w}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{HROS.app.dataDeskToOtherdesk(l,f,h,u,w,O)}}}}})}return false})},getScrollbar:function(){$("#amg_folder_container .folderInner").height($(window).height()-80);$("#amg_folder_container .folderItem").each(function(){var e=$(this).find(".folderInner"),t=parseInt(e.children(".appbtn:last").css("top"))+41,a=e.next(".scrollBar");var i=a.position().top;a.hide();e.scrollTop(0);if(e.height()/t<1){a.height(e.height()/t*e.height());i=i+a.height()>e.height()?e.height()-a.height():i;a.css("top",i).show();e.scrollTop(i/e.height()*t)}})},moveScrollbar:function(){$(".scrollBar").on("mousedown",function(e){var t,a,i,o;var n=$(this),s=n.prev(".folderInner");i=parseInt(s.children(".appbtn:last").css("top"))+41;o=s.height()-n.height();t=e.clientY-n.offset().top;$(document).on("mousemove",function(e){a=e.clientY-t-80<0?0:e.clientY-t-80>o?o:e.clientY-t-80;n.css("top",a);s.scrollTop(a/s.height()*i)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("#amg_folder_container .folderInner").on("mousewheel",function(e,t){var a=$(this),i=parseInt(a.children(".appbtn:last").css("top"))+41,o;if(t<0){o=a.scrollTop()+120>i-a.height()?i-a.height():a.scrollTop()+120}else{o=a.scrollTop()-120<0?0:a.scrollTop()-120}a.stop(false,true).animate({scrollTop:o},300);a.next(".scrollBar").stop(false,true).animate({top:o/i*a.height()},300)})},resize:function(){HROS.appmanage.getScrollbar()},close:function(){$("#amg_dock_container").html("");$("#amg_folder_container .folderInner").html("");$("#desktop").show();$("#appmanage").hide();$("#amg_folder_container .folderItem").removeClass("folderItem_turn");HROS.app.set();HROS.deskTop.resize()}}}();HROS.base=function(){return{init:function(){$.ajaxSetup({url:ajaxUrl,type:"POST",dataType:"json"});$(document).ajaxSuccess(function(e,t,a){if($.trim(t.responseText)=="ERROR_NOT_LOGGED_IN"&&HROS.CONFIG.memberID!=0){HROS.base.loginDialog()}});HROS.CONFIG.memberID=Cookies.get(cookie_prefix+"memberID");$("body").on("contextmenu",function(){return false});HROS.copyright.init();HROS.zoom.init();HROS.deskTop.init();HROS.wallpaper.init();HROS.searchBar.init();HROS.startMenu.init();HROS.taskBar.init();HROS.dock.init();HROS.app.init();HROS.widget.init();HROS.window.init();HROS.folderView.init();HROS.appmanage.init();HROS.popupMenu.init();HROS.lock.init();HROS.hotkey.init();HROS.base.run()},loginDialog:function(e){e=typeof e==="undefined"?"系统检测到您尚未登录，或者长时间未操作已登出<br>为了更好的操作，是否登录？":e;HROS.CONFIG.memberID=0;swal({type:"warning",title:"温馨提示",text:e,html:true,showCancelButton:true,confirmButtonText:"走，去登录！",cancelButtonText:"我再逛逛…"},function(){HROS.base.login()})},login:function(){$("#lrbox").animate({top:0},500,function(){changeTabindex()})},logout:function(){$.ajax({url:"login.ajax.php",data:{ac:"logout"}}).done(function(){location.reload()})},checkLogin:function(){return HROS.CONFIG.memberID!=0?true:false},setSkin:function(e,t){$("#window-skin").attr("id","window-skin-ready2remove");var a=loadCSS("static/img/skins/"+e+".css?"+version);onloadCSS(a,function(){$("body link").last().attr("id","window-skin");$("#window-skin-ready2remove").remove();HROS.CONFIG.skin=e;t&&t()})},run:function(){var e=location.search;var t=new Object;if(e.indexOf("?")!=-1){var a=e.substr(1);strs=a.split("&");for(var i=0;i<strs.length;i++){t[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}if(typeof t["run"]!="undefined"&&typeof t["type"]!="undefined"){if(HROS.base.checkLogin()){$.ajax({data:{ac:"getAppidByRealappid",id:t["run"]}}).done(function(e){if(t["type"]=="app"){HROS.window.create(e)}else{if(!HROS.widget.checkCookie(e,t["type"])){HROS.widget.create(e)}}})}else{HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+t["run"],width:800,height:484,isflash:false,refresh:true})}}}}}();HROS.copyright=function(){return{init:function(){$("#copyright .close").on("click",function(){HROS.copyright.hide()})},show:function(){var e=HROS.maskBox.copyright();e.show();$("#copyright").show()},hide:function(){var e=HROS.maskBox.copyright();e.hide();$("#copyright").hide()}}}();HROS.deskTop=function(){return{init:function(){$(window).on("resize",function(){HROS.deskTop.resize()});$("body").on("click","#desktop",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchBar.hide();HROS.startMenu.hide()}).on("contextmenu","#desktop",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchBar.hide();HROS.startMenu.hide();HROS.popupMenu.desk(e);return false})},resize:function(){if($("#desktop").is(":visible")){HROS.dock.setPos();HROS.app.setPos();HROS.window.setPos();HROS.folderView.setPos()}else{HROS.appmanage.resize()}HROS.wallpaper.set(false)},updateDefaultDesk:function(e){if(HROS.base.checkLogin()){$.ajax({data:{ac:"setDesk",desk:e}})}}}}();HROS.dock=function(){return{init:function(){HROS.dock.setPos();HROS.dock.move();var e;$("#dock-container").on("mouseenter",function(){e=setTimeout(function(){$("#dock-container").addClass("showtop")},300)}).on("mouseleave",function(){clearInterval(e);$(this).removeClass("showtop")});$("body").on("contextmenu","#dock-container",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchBar.hide();HROS.startMenu.hide();HROS.popupMenu.dock(e);return false});$("#dock-bar .dock-tool-setting").on("mousedown",function(){return false}).on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"sysapp/desksetting/index.php",width:800,height:450,isflash:false})}else{HROS.base.login()}});$("#dock-bar .dock-tool-style").on("mousedown",function(){return false}).on("click",function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isflash:false})}else{HROS.base.login()}});$("#dock-bar .dock-tool-appmanage").on("mousedown",function(){return false}).on("click",function(){HROS.appmanage.set()});$("#dock-bar .dock-tool-search").on("mousedown",function(e){return false}).on("click",function(e){e.stopPropagation();HROS.searchBar.get()});$("#dock-bar .pagination").on("mousedown",function(){return false}).on("click",function(){HROS.dock.switchDesk($(this).attr("index"))});$("#dock-bar .dock-tool-start").on("mousedown",function(){return false}).on("click",function(){HROS.startMenu.show();return false})},setPos:function(){HROS.dock.switchDesk(HROS.CONFIG.desk);var e=$("#desk-"+HROS.CONFIG.desk),t=$("#desk .desktop-container");var a=e.css("width","100%").width(),i=e.css("height","100%").height();$("#dock-container").removeClass("dock-top dock-left dock-right");$("#dock-bar").removeClass("top-bar left-bar right-bar").hide();if(HROS.CONFIG.dockPos=="top"){$("#dock-bar").addClass("top-bar").children("#dock-container").addClass("dock-top");t.css({width:a,height:i-$("#task-bar").height()-$("#dock-bar").height(),left:a,top:$("#dock-bar").height()});e.css({left:0});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="left"){$("#dock-bar").addClass("left-bar").children("#dock-container").addClass("dock-left");t.css({width:a-$("#dock-bar").width(),height:i-$("#task-bar").height(),left:a+$("#dock-bar").width(),top:0});e.css({left:$("#dock-bar").width()});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="right"){$("#dock-bar").addClass("right-bar").children("#dock-container").addClass("dock-right");t.css({width:a-$("#dock-bar").width(),height:i-$("#task-bar").height(),left:a,top:0});e.css({left:0});$("#dock-bar").show()}else if(HROS.CONFIG.dockPos=="none"){t.css({width:a,height:i-$("#task-bar").height(),left:a,top:0});e.css({left:0})}HROS.taskBar.resize();HROS.folderView.setPos()},updatePos:function(e){if(e!=HROS.CONFIG.dockPos&&typeof e!="undefined"){HROS.CONFIG.dockPos=e;if(e=="none"){HROS.app.dataAllDockToDesk(HROS.CONFIG.desk)}HROS.dock.setPos();HROS.app.set();if(HROS.base.checkLogin()){$.ajax({data:{ac:"setDockPos",dock:e,desk:HROS.CONFIG.desk}})}}},move:function(){$("#dock-container").on("mousedown",function(e){if(e.which==1){var t=HROS.maskBox.dock(),a;$(document).on("mousemove",function(e){t.show();if(e.clientY<t.height()*.2){a="top"}else if(e.clientX<t.width()*.5){a="left"}else{a="right"}$(".dock_drap_effect").removeClass("hover");$(".dock_drap_effect_"+a).addClass("hover")}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");t.hide();HROS.dock.updatePos(a)})}})},switchDesk:function(e){e=/^\+?[1-5]*$/.test(e)?e:1;var t=$("#dock-bar .dock-pagination"),a=HROS.CONFIG.desk,i=e,o=$("#desk-"+a).offset().left,n=$("#desk-"+i).offset().left;if(a!=i){if(!$("#desk-"+i).hasClass("animated")&&!$("#desk-"+a).hasClass("animated")){$("#desk-"+a).addClass("animated").animate({left:n},500,"easeInOutCirc",function(){$(this).removeClass("animated")});$("#desk-"+i).addClass("animated").animate({left:o},500,"easeInOutCirc",function(){$(this).removeClass("animated");t.removeClass("current-pagination-"+a).addClass("current-pagination-"+i);HROS.CONFIG.desk=i})}}else{t.removeClass("current-pagination-"+a).addClass("current-pagination-"+i)}}}}();HROS.folderView=function(){return{init:function(){$("body").on("click",".quick_view_container",function(){HROS.popupMenu.hide()}).on("click",".quick_view_container_open",function(){HROS.window.create($(this).parents(".quick_view_container").attr("appid"),"folder");HROS.folderView.hide()}).on("click",".appbtn",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchBar.hide();HROS.startMenu.hide()});HROS.folderView.moveScrollbar()},get:function(e){setTimeout(function(){var t=false;$("body .quick_view_container").each(function(){if($(this).attr("realappid")==e.attr("realappid")){t=true;return false}});if(t){var a="#qv_"+e.attr("appid")}else{HROS.folderView.hide()}var i="";$(HROS.VAR.folder).each(function(){if(this.appid==e.attr("appid")){i=this.apps;return false}});var o="",n=0;if(i!=""){$(i).each(function(){o+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid,imgsrc:this.icon,appsize:32})});if(i.length%4==0){n+=Math.floor(i.length/4)*60}else{n+=(Math.floor(i.length/4)+1)*60}}else{o="文件夹为空";n+=30}var s,r;if(e.parent("div").hasClass("dock-applist")){s=parseInt(e.attr("left"))+e.width();r=parseInt(e.attr("top"))}else{s=parseInt(e.attr("left"))+e.width();r=parseInt(e.attr("top"))-20}var p=false;if(n+r+44>$(window).height()){var d=n+r+44-$(window).height();if(d<=r){r-=d}else{n-=d-r;r=0;p=true}}if(s+330>$(window).width()){s-=330+e.width();if(t){$(a+" .quick_view_container_list_in").html("").append(o);$(a).stop(true,false).animate({left:s,top:r},500);$(a+" .perfect_nine_m_l_t").stop(true,false).animate({top:0,height:Math.ceil((n+24)/2)},200);$(a+" .perfect_nine_m_l_m").stop(true,false).animate({top:Math.ceil((n+24)/2)},200).hide();$(a+" .perfect_nine_m_l_b").stop(true,false).animate({top:Math.ceil((n+24)/2),height:Math.ceil((n+24)/2)+20},200);$(a+" .perfect_nine_m_r_t").stop(true,false).animate({top:0,height:e.offset().top-r},200);$(a+" .perfect_nine_m_r_m").stop(true,false).animate({top:parseInt(e.attr("top"))-r},200).show();$(a+" .perfect_nine_m_r_b").stop(true,false).animate({top:parseInt(e.attr("top"))-r+20,height:n+24-(parseInt(e.attr("top"))-r)-20+20},200);$(a+" .quick_view_container_list_in").stop(true,false).animate({height:n},200)}else{$("body").append(HROS.template.folderView({id:"qv_"+e.attr("appid"),appid:e.attr("appid"),realappid:e.attr("realappid"),apps:o,top:r,left:s,height:n,mlt:Math.ceil((n+24)/2),mlm:false,mlb:Math.ceil((n+24)/2),mrt:e.offset().top-r,mrm:true,mrb:n+24-(e.offset().top-r)-20}))}}else{if(t){$(a+" .quick_view_container_list_in").html("").append(o);$(a).stop(true,false).animate({left:s,top:r},500);$(a+" .perfect_nine_m_l_t").stop(true,false).animate({top:0,height:parseInt(e.attr("top"))-r},200);$(a+" .perfect_nine_m_l_m").stop(true,false).animate({top:parseInt(e.attr("top"))-r},200).show();$(a+" .perfect_nine_m_l_b").stop(true,false).animate({top:parseInt(e.attr("top"))-r+20,height:n+24-(parseInt(e.attr("top"))-r)-20},200);$(a+" .perfect_nine_m_r_t").stop(true,false).animate({top:0,height:Math.ceil((n+24)/2)},200);$(a+" .perfect_nine_m_r_m").stop(true,false).animate({top:Math.ceil((n+24)/2)},200).hide();$(a+" .perfect_nine_m_r_b").stop(true,false).animate({top:Math.ceil((n+24)/2),height:Math.ceil((n+24)/2)},200);$(a+" .quick_view_container_list_in").stop(true,false).animate({height:n},200)}else{$("body").append(HROS.template.folderView({id:"qv_"+e.attr("appid"),appid:e.attr("appid"),realappid:e.attr("realappid"),apps:o,top:r,left:s,height:n,mlt:e.offset().top-r,mlm:true,mlb:n+24-(e.offset().top-r)-20,mrt:Math.ceil((n+24)/2),mrm:false,mrb:Math.ceil((n+24)/2)}))}}var c="#quick_view_container_list_in_"+e.attr("appid");var l="#quick_view_container_list_"+e.attr("appid")+" .scrollBar";$("#quick_view_container_list_"+e.attr("appid")+" .scrollBar_bgc").hide();$(l).hide().height(0);if(p){$("#quick_view_container_list_"+e.attr("appid")+" .scrollBar_bgc").show();$(l).show().height($(c).height()/(Math.ceil($(c).children().length/4)*60)*$(c).height())}},0)},setPos:function(){$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))})},moveScrollbar:function(){$("body").on("mousedown",".quick_view_container .quick_view_container_list .scrollBar",function(e){var t=$(this),a=t.prev(".quick_view_container_list_in");var i=a.offset().top;var o,n,s,r;s=Math.ceil(a.children().length/4)*60;r=a.height()-t.height();o=e.clientY-t.offset().top;$(document).on("mousemove",function(e){n=e.clientY-o-i<0?0:e.clientY-o-i>r?r:e.clientY-o-i;t.css("top",n);a.scrollTop(n/a.height()*s)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("body").on("mousewheel",".quick_view_container_list_in",function(e,t){var a=$(this),i=Math.ceil($(this).children().length/4)*60,o;if(t<0){o=a.scrollTop()+40>i-a.height()?i-a.height():a.scrollTop()+40}else{o=a.scrollTop()-40<0?0:a.scrollTop()-40}a.stop(false,true).animate({scrollTop:o},300);$(this).next(".scrollBar").stop(false,true).animate({top:o/i*a.height()},300)})},hide:function(){$(".quick_view_container").remove()}}}();HROS.grid=function(){return{getAppGrid:function(){var e=$("#desk-"+HROS.CONFIG.desk).width()-HROS.CONFIG.appMarginLeft;var t=$("#desk-"+HROS.CONFIG.desk).height()-HROS.CONFIG.appMarginTop;var a=HROS.CONFIG.appMarginTop;var i=HROS.CONFIG.appMarginLeft;var o=[];var n=$("#desk-1 .add").outerHeight()+HROS.CONFIG.appVerticalSpacing;var s=$("#desk-1 .add").outerWidth()+HROS.CONFIG.appHorizontalSpacing;for(var r=0;r<500;r++){o.push({startY:a,endY:a+n,startX:i,endX:i+s});if(HROS.CONFIG.appXY=="x"){i+=s;if(i+s>e){a+=n;i=HROS.CONFIG.appMarginLeft}}else{a+=n;if(a+n>t){a=HROS.CONFIG.appMarginTop;i+=s}}}return o},searchAppGrid:function(e,t){var a=HROS.grid.getAppGrid();var i=null;for(var o=0;o<a.length;o++){if(e>=a[o].startX&&e<=a[o].endX&&t>=a[o].startY&&t<=a[o].endY){i=o;break}}return i},searchAppGrid2:function(e,t){var a=HROS.grid.getAppGrid();var i=[];for(var o=0;o<a.length;o++){var n=a[o].endY-a[o].startY;var s=a[o].endX-a[o].startX;var r=n/2;var p=s/2;if(HROS.CONFIG.appXY=="x"){i.push({startY:a[o].startY,endY:a[o].startY+n,startX:a[o].startX,endX:a[o].startX+p},{startY:a[o].startY,endY:a[o].startY+n,startX:a[o].startX+p,endX:a[o].endX})}else{i.push({startY:a[o].startY,endY:a[o].startY+r,startX:a[o].startX,endX:a[o].startX+s},{startY:a[o].startY+r,endY:a[o].endY,startX:a[o].startX,endX:a[o].startX+s})}}var d=null;for(var o=0;o<i.length;o++){if(e>=i[o].startX&&e<=i[o].endX&&t>=i[o].startY&&t<=i[o].endY){d=o;break}}return d},getDockAppGrid:function(){var e=$("#dock-bar .dock-applist").height();var t=[];var a=0;var i=0;var o=68;var n=68;for(var s=0;s<7;s++){t.push({startY:a,endY:a+o,startX:i,endX:i+n});a+=o;if(a+o>e){a=0;i+=n}}return t},searchDockAppGrid:function(e,t){var a=HROS.grid.getDockAppGrid();var i=null;for(var o=0;o<a.length;o++){if(e>=a[o].startX&&e<=a[o].endX&&t>=a[o].startY&&t<=a[o].endY){i=o;break}}return i},searchDockAppGrid2:function(e,t){var a=HROS.grid.getDockAppGrid();var i=[];for(var o=0;o<a.length;o++){var n=a[o].endY-a[o].startY;var s=a[o].endX-a[o].startX;var r=n/2;var p=s/2;if(HROS.CONFIG.dockPos=="top"){i.push({startY:a[o].startY,endY:a[o].startY+n,startX:a[o].startX,endX:a[o].startX+p},{startY:a[o].startY,endY:a[o].startY+n,startX:a[o].startX+p,endX:a[o].endX})}else{i.push({startY:a[o].startY,endY:a[o].startY+r,startX:a[o].startX,endX:a[o].startX+s},{startY:a[o].startY+r,endY:a[o].endY,startX:a[o].startX,endX:a[o].startX+s})}}var d=null;for(var o=0;o<i.length;o++){if(e>=i[o].startX&&e<=i[o].endX&&t>=i[o].startY&&t<=i[o].endY){d=o;break}}return d},getFolderGrid:function(){var e=[];$(".quick_view_container, .folder-window:visible").each(function(){e.push({zIndex:$(this).css("z-index"),id:$(this).attr("appid"),startY:$(this).offset().top,endY:$(this).offset().top+$(this).height(),startX:$(this).offset().left,endX:$(this).offset().left+$(this).width()})});e.sort(function(e,t){return t["zIndex"]-e["zIndex"]});return e},searchFolderGrid:function(e,t){var a=HROS.grid.getFolderGrid();var i=null;for(var o=0;o<a.length;o++){if(e>=a[o].startX&&e<=a[o].endX&&t>=a[o].startY&&t<=a[o].endY){i=a[o]["id"];break}}return i},getManageDockAppGrid:function(){var e=[];var t=20;for(var a=0;a<50;a++){e.push({startX:t,endX:t+70});t+=70}return e},searchManageDockAppGrid:function(e){var t=HROS.grid.getManageDockAppGrid();var a=null;for(var i=0;i<t.length;i++){if(e>=t[i].startX&&e<=t[i].endX){a=i;break}}return a},searchManageDockAppGrid2:function(e){var t=HROS.grid.getManageDockAppGrid();var a=[];for(var i=0;i<t.length;i++){var o=t[i].endX-t[i].startX;var n=o/2;a.push({startX:t[i].startX,endX:t[i].startX+n},{startX:t[i].startX+n,endX:t[i].endX})}var s=null;for(var i=0;i<a.length;i++){if(e>=a[i].startX&&e<=a[i].endX){s=i;break}}return s},getManageAppGrid:function(){var e=[];var t=0;for(var a=0;a<500;a++){e.push({startY:t,endY:t+40});t+=40}return e},searchManageAppGrid:function(e){var t=HROS.grid.getManageAppGrid();var a=null;for(var i=0;i<t.length;i++){if(e>=t[i].startY&&e<=t[i].endY){a=i;break}}return a},searchManageAppGrid2:function(e){var t=HROS.grid.getManageAppGrid();var a=[];for(var i=0;i<t.length;i++){var o=t[i].endY-t[i].startY;var n=t[i].endX-t[i].startX;var s=o/2;a.push({startY:t[i].startY,endY:t[i].startY+s},{startY:t[i].startY+s,endY:t[i].endY})}var r=null;for(var i=0;i<a.length;i++){if(e>=a[i].startY&&e<=a[i].endY){r=i;break}}return r}}}();HROS.hotkey=function(){return{init:function(){Mousetrap.bind(["backspace"],function(){return false});Mousetrap.bind(["alt+d"],function(){HROS.window.hideAll();return false});Mousetrap.bind(["ctrl+up","command+up"],function(){HROS.appmanage.set();return false});Mousetrap.bind(["ctrl+f","command+f"],function(){HROS.searchBar.get();return false});Mousetrap.bind(["ctrl+1","command+1"],function(){HROS.dock.switchDesk(1);return false});Mousetrap.bind(["ctrl+2","command+2"],function(){HROS.dock.switchDesk(2);return false});Mousetrap.bind(["ctrl+3","command+3"],function(){HROS.dock.switchDesk(3);return false});Mousetrap.bind(["ctrl+4","command+4"],function(){HROS.dock.switchDesk(4);return false});Mousetrap.bind(["ctrl+5","command+5"],function(){HROS.dock.switchDesk(5);return false});Mousetrap.bind(["ctrl+left","command+left"],function(){if(parseInt(HROS.CONFIG.desk)-1<1){HROS.dock.switchDesk(5)}else{HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)-1)}return false});Mousetrap.bind(["ctrl+right","command+right"],function(){if(parseInt(HROS.CONFIG.desk)+1>5){HROS.dock.switchDesk(1)}else{HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)+1)}return false});Mousetrap.bind(["ctrl+l","command+l"],function(){HROS.lock.show();return false})}}}();HROS.lock=function(){return{init:function(){Mousetrap.bind(["space"],function(){$("#lock").click();return false});$("body").on("click","#lock",function(){if($("#lock-info").is(":visible")){$("#lock .title").animate({top:"10%"},500);$("#lock .tip").animate({top:"80%"},500);$("#lock-info").fadeOut();Mousetrap.bind(["space"],function(){$("#lock").click();return false});Mousetrap.unbind("esc")}else{$("#lock .title").animate({top:"-200px"},500);$("#lock .tip").animate({top:"100%"},500);$("#lock-info").fadeIn();$("#lockpassword").val("").focus();$("#lock-info .text-tip").text("");Mousetrap.bind(["esc"],function(){$("#lock").click();return false});Mousetrap.unbind("space")}});$("body").on("click","#lock-info",function(){return false});$("body").on("click","#lockbtn",function(){if($("#lockpassword").val()!=""){$.ajax({url:"login.ajax.php",data:{ac:"unlock",password:$("#lockpassword").val()}}).done(function(e){if(e=="ERROR_LOCKPASSWORD"){$("#lockpassword").val("").focus();$("#lock-info .text-tip").text("解锁密码错误")}else{HROS.lock.hide()}})}else{$("#lock-info .text-tip").text("请输入解锁密码")}});$("body").on("keydown","#lockpassword",function(e){if(e.keyCode=="13"){$("#lockbtn").click()}})},show:function(){if($("#lock").length==0){if(!HROS.base.checkLogin()){HROS.base.loginDialog("锁定功能需要登录后才能使用，为了更好的操作，是否登录？")}else{var e=function(){$.ajax({url:"login.ajax.php",data:{ac:"logout"}});$("#desktop").hide();var e=Cookies.get(cookie_prefix+"userinfo");if(typeof e!=="undefined"){e=JSON.parse(e);$("body").append(HROS.template.lock({avatar:e.avatar,username:e.username}))}var t=function(){var e=new Date;$("#lock .time").text((e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()));var t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+"，星期";switch(e.getDay()){case"1":t+="一";break;case"1":t+="二";break;case"1":t+="三";break;case"1":t+="四";break;case"1":t+="五";break;case"1":t+="六";break;default:t+="日"}$("#lock .week").text(t)};t();lockFunc=setInterval(function(){var e=false;if($("#desktop").is(":visible")){e=true}if($("#lock").length==0){e=true}if($("#lock").is(":hidden")){e=true}if(e){clearInterval(lockFunc);$("#lock").remove();HROS.lock.show()}t()},1e3)};if(Cookies.get(cookie_prefix+"isfirstlock"+HROS.CONFIG.memberID)==null){Cookies.set(cookie_prefix+"isfirstlock"+HROS.CONFIG.memberID,1);swal({type:"warning",title:"温馨提示",text:"解锁密码默认为登录密码，是否要先进行修改？",showCancelButton:true,confirmButtonText:"继续锁定",cancelButtonText:"修改解锁密码"},function(t){if(t){e()}else{HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"sysapp/account/security.php",width:550,height:580})}})}else{e()}}}},hide:function(){clearInterval(lockFunc);$("#lock").remove();$("#desktop").show()}}}();HROS.maskBox=function(){return{desk:function(){if(!HROS.maskBoxCache.desk){HROS.maskBoxCache.desk=$('<div class="maskbox"></div>');$("body").append(HROS.maskBoxCache.desk)}return HROS.maskBoxCache.desk},dock:function(){if(!HROS.maskBoxCache.dock){HROS.maskBoxCache.dock=$('<div class="maskbox maskbox-dark">'+'<div class="dock_drap_effect dock_drap_effect_top"></div>'+'<div class="dock_drap_effect dock_drap_effect_left"></div>'+'<div class="dock_drap_effect dock_drap_effect_right"></div>'+'<div class="dock_drap_mask">'+'<div class="dock_drop_region_top"><div class="text">拖放至顶部</div></div>'+'<div class="dock_drop_region_left"><div class="text">拖放至左侧</div></div>'+'<div class="dock_drop_region_right"><div class="text">拖放至右侧</div></div>'+"</div>"+"</div>");$("body").append(HROS.maskBoxCache.dock)}return HROS.maskBoxCache.dock},copyright:function(){if(!HROS.maskBoxCache.copyright){HROS.maskBoxCache.copyright=$('<div class="maskbox maskbox-dark"></div>');$("body").append(HROS.maskBoxCache.copyright)}return HROS.maskBoxCache.copyright}}}();HROS.popupMenu=function(){return{init:function(){$(".popup-menu").on("contextmenu",function(){return false});$("body").on("mouseenter",".popup-menu li",function(){if($(this).children(".popup-menu").length==1){$(this).children("a").addClass("focus");$(this).children(".popup-menu").show();if($(this).parents(".popup-menu").offset().left+$(this).parents(".popup-menu").outerWidth()*2+10<$(window).width()){$(this).children(".popup-menu").css({left:$(this).parents(".popup-menu").outerWidth()-2,top:0})}else{$(this).children(".popup-menu").css({left:$(this).parents(".popup-menu").outerWidth()*-1,top:0})}if($(this).children(".popup-menu").offset().top+$(this).children(".popup-menu").height()+10>$(window).height()){$(this).children(".popup-menu").css({top:$(window).height()-$(this).children(".popup-menu").height()-$(this).children(".popup-menu").offset().top-10})}}}).on("mouseleave",".popup-menu li",function(){$(this).children("a").removeClass("focus");$(this).children(".popup-menu").hide()})},calcPosition:function(e,t){var a=$(window).width()-e.clientX<t.width()?e.clientX-t.width():e.clientX;var i=$(window).height()-e.clientY<t.height()?e.clientY-t.height():e.clientY;t.css({left:a,top:i}).show()},app:function(e,t){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuApp.art")){$("body").on("click",'.app-menu a[menu="moveto"]:not(.disabled)',function(){var e=$(this).parents(".app-menu").data();var t=e.obj.attr("appid"),a=e.obj.index(),i=99999,o=$(this).attr("desk"),n=HROS.CONFIG.desk,s=e.obj.parents(".folder-window").attr("appid")||e.obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving()){var r=false;if(e.obj.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,a,o)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-otherdesk",id:t,from:a,todesk:o}}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.obj.parent().hasClass("desktop-apps-container")){if(HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-otherdesk",id:t,from:a,to:i,todesk:o,fromdesk:n}}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.obj.parent().hasClass("folder_body")){if(HROS.app.dataFolderToOtherdesk(t,a,o,s)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-otherdesk",id:t,from:a,todesk:o,fromfolderid:s}}).done(function(e){HROS.VAR.isAppMoving=false})}}}}else{if(e.obj.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,a,o)}else if(e.obj.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)}else if(e.obj.parent().hasClass("folder_body")){HROS.app.dataFolderToOtherdesk(t,a,o,s)}}HROS.popupMenu.hide()});$("body").on("click",'.app-menu a[menu="open"]',function(){var e=$(this).parents(".app-menu").data();switch(e.obj.attr("type")){case"window":HROS.window.create(e.obj.attr("appid"),e.obj.attr("type"));break;case"widget":HROS.widget.create(e.obj.attr("appid"),e.obj.attr("type"));break}HROS.popupMenu.hide()});$("body").on("click",'.app-menu a[menu="edit"]',function(){var e=$(this).parents(".app-menu").data();if(HROS.base.checkLogin()){dialog({id:"editdialog",title:"编辑应用“"+e.obj.attr("title")+"”",url:"sysapp/dialog/app.php?id="+e.obj.attr("appid"),padding:0,width:770,height:450}).showModal()}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.app-menu a[menu="del"]',function(){var e=$(this).parents(".app-menu").data();HROS.app.dataDeleteByAppid(e.obj.attr("appid"));HROS.widget.removeCookie(e.obj.attr("realappid"),e.obj.attr("type"));HROS.app.remove(e.obj.attr("appid"),function(){e.obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.obj.remove();HROS.deskTop.resize()})});HROS.popupMenu.hide()})}var a={obj:t,desk:HROS.CONFIG.desk};$("body").append(HROS.template.renderFile("popupMenuApp.art",a));var i=$("body > .popup-menu:last-child");i.data(a);HROS.popupMenu.calcPosition(e,i)},papp:function(e,t){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuPapp.art")){$("body").on("click",'.papp-menu a[menu="moveto"]:not(.disabled)',function(){var e=$(this).parents(".papp-menu").data();var t=e.obj.attr("appid"),a=e.obj.index(),i=99999,o=$(this).attr("desk"),n=HROS.CONFIG.desk,s=e.obj.parents(".folder-window").attr("appid")||e.obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){var r=false;if(e.obj.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,a,o)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-otherdesk",id:t,from:a,todesk:o}}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.obj.parent().hasClass("desktop-apps-container")){if(HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-otherdesk",id:t,from:a,to:i,todesk:o,fromdesk:n}}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.obj.parent().hasClass("folder_body")){if(HROS.app.dataFolderToOtherdesk(t,a,o,s)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-otherdesk",id:t,from:a,todesk:o,fromfolderid:s}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{if(e.obj.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,a,o)}else if(e.obj.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)}else if(e.obj.parent().hasClass("folder_body")){HROS.app.dataFolderToOtherdesk(t,a,o,s)}}HROS.popupMenu.hide()});$("body").on("click",'.papp-menu a[menu="open"]',function(){var e=$(this).parents(".papp-menu").data();switch(e.obj.attr("type")){case"pwindow":HROS.window.create(e.obj.attr("appid"),e.obj.attr("type"));break;case"pwidget":HROS.widget.create(e.obj.attr("appid"),e.obj.attr("type"));break}HROS.popupMenu.hide()});$("body").on("click",'.papp-menu a[menu="edit"]',function(){var e=$(this).parents(".papp-menu").data();if(HROS.base.checkLogin()){dialog({id:"editdialog",title:"编辑私人应用“"+e.obj.attr("title")+"”",url:"sysapp/dialog/papp.php?id="+e.obj.attr("appid"),padding:0,width:770,height:450}).showModal()}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.papp-menu a[menu="del"]',function(){var e=$(this).parents(".papp-menu").data();HROS.app.dataDeleteByAppid(e.obj.attr("appid"));HROS.widget.removeCookie(e.obj.attr("realappid"),e.obj.attr("type"));HROS.app.remove(e.obj.attr("appid"),function(){e.obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.obj.remove();HROS.deskTop.resize()})});HROS.popupMenu.hide()})}var a={obj:t,desk:HROS.CONFIG.desk};$("body").append(HROS.template.renderFile("popupMenuPapp.art",a));var i=$("body > .popup-menu:last-child");i.data(a);HROS.popupMenu.calcPosition(e,i)},folder:function(e,t){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuFolder.art")){$("body").on("click",'.folder-menu a[menu="view"]',function(){var e=$(this).parents(".folder-menu").data();HROS.folderView.get(e.obj);HROS.popupMenu.hide()});$("body").on("click",'.folder-menu a[menu="open"]',function(){var e=$(this).parents(".folder-menu").data();HROS.window.create(e.obj.attr("appid"),e.obj.attr("type"));HROS.popupMenu.hide()});$("body").on("click",'.folder-menu a[menu="moveto"]:not(.disabled)',function(){var e=$(this).parents(".folder-menu").data();var t=e.obj.attr("appid"),a=e.obj.index(),i=99999,o=$(this).attr("desk"),n=HROS.CONFIG.desk,s=e.obj.parents(".folder-window").attr("appid")||e.obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){var r=false;if(e.obj.parent().hasClass("dock-applist")){if(HROS.app.dataDockToOtherdesk(t,a,o)){$.ajax({data:{ac:"moveMyApp",movetype:"dock-otherdesk",id:t,from:a,todesk:o}}).done(function(e){HROS.VAR.isAppMoving=false})}}else if(e.obj.parent().hasClass("desktop-apps-container")){if(HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)){$.ajax({data:{ac:"moveMyApp",movetype:"desk-otherdesk",id:t,from:a,to:i,todesk:o,fromdesk:n}}).done(function(e){HROS.VAR.isAppMoving=false})}}else{if(HROS.app.dataFolderToOtherdesk(t,a,o,s)){$.ajax({data:{ac:"moveMyApp",movetype:"folder-otherdesk",id:t,from:a,todesk:o,fromfolderid:s}}).done(function(e){HROS.VAR.isAppMoving=false})}}}else{if(e.obj.parent().hasClass("dock-applist")){HROS.app.dataDockToOtherdesk(t,a,o)}else if(e.obj.parent().hasClass("desktop-apps-container")){HROS.app.dataDeskToOtherdesk(t,a,i,"a",o,n)}else{HROS.app.dataFolderToOtherdesk(t,a,o,s)}}HROS.popupMenu.hide()});$("body").on("click",'.folder-menu a[menu="rename"]',function(){var e=$(this).parents(".folder-menu").data();if(HROS.base.checkLogin()){swal({type:"input",title:"重命名“"+e.obj.attr("title")+"”文件夹",showCancelButton:true,closeOnConfirm:false,confirmButtonText:"修改",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入文件夹名称",inputValue:e.obj.attr("title")},function(t){if(t===false){return false}if(t===""){swal.showInputError("文件夹名称不能为空");return false}$.ajax({data:{ac:"updateFolder",name:t,id:e.obj.attr("appid")}}).done(function(e){HROS.app.get();swal({type:"success",title:"修改成功"})})})}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.folder-menu a[menu="del"]',function(){var e=$(this).parents(".folder-menu").data();swal({type:"warning",title:"删除“"+e.obj.attr("title")+"”文件夹",text:"删除文件夹的同时会删除文件夹内所有应用，确认要删除么？",showCancelButton:true,confirmButtonText:"确认删除",cancelButtonText:"我点错了"},function(){HROS.app.remove(e.obj.attr("appid"),function(){HROS.app.dataDeleteByAppid(e.obj.attr("appid"));e.obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.obj.remove();HROS.deskTop.resize()})})});HROS.popupMenu.hide()})}var a={obj:t,desk:HROS.CONFIG.desk};$("body").append(HROS.template.renderFile("popupMenuFolder.art",a));var i=$("body > .popup-menu:last-child");i.data(a);HROS.popupMenu.calcPosition(e,i)},file:function(e,t){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuFile.art")){$("body").on("click",'.file-menu a[menu="download"]',function(){var e=$(this).parents(".file-menu").data();$("body").append(HROS.template.fileDownload({appid:e.obj.attr("appid")}));HROS.popupMenu.hide()});$("body").on("click",'.file-menu a[menu="del"]',function(){var e=$(this).parents(".file-menu").data();HROS.app.dataDeleteByAppid(e.obj.attr("appid"));HROS.app.remove(e.obj.attr("appid"),function(){e.obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){e.obj.remove();HROS.deskTop.resize()})});HROS.popupMenu.hide()})}var a={obj:t};$("body").append(HROS.template.renderFile("popupMenuFile.art",a));var i=$("body > .popup-menu:last-child");i.data(a);HROS.popupMenu.calcPosition(e,i)},dock:function(e){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuDock.art")){$("body").on("click",'.dock-menu a[menu="dockPos"]:not(.disabled)',function(){if($(this).attr("pos")=="none"){if(Cookies.get(cookie_prefix+"isfirsthidedock"+HROS.CONFIG.memberID)==null){Cookies.set(cookie_prefix+"isfirsthidedock"+HROS.CONFIG.memberID,1);swal({type:"warning",title:"温馨提示",text:"如果应用码头存在应用，隐藏后会将应用转移到当前桌面<br>若需要再次开启，可在桌面空白处点击右键<br>进入「 桌面设置 」里开启",html:true,confirmButtonText:"我知道了"},function(){HROS.dock.updatePos("none")})}else{HROS.dock.updatePos("none")}}else{HROS.dock.updatePos($(this).attr("pos"))}HROS.popupMenu.hide()})}var t={pos:HROS.CONFIG.dockPos};$("body").append(HROS.template.renderFile("popupMenuDock.art",t));var a=$("body > .popup-menu:last-child");a.data(t);HROS.popupMenu.calcPosition(e,a)},task:function(e,t){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuTask.art")){$("body").on("click",'.task-menu a[menu="show"]:not(.disabled)',function(){var e=$(this).parents(".task-menu").data();HROS.window.show2top(e.obj.attr("appid"));HROS.popupMenu.hide()});$("body").on("click",'.task-menu a[menu="hide"]:not(.disabled)',function(){var e=$(this).parents(".task-menu").data();HROS.window.hide(e.obj.attr("appid"));HROS.popupMenu.hide()});$("body").on("click",'.task-menu a[menu="close"]',function(){var e=$(this).parents(".task-menu").data();HROS.window.close(e.obj.attr("appid"));HROS.popupMenu.hide()})}var a={obj:t,state:$("#w_"+t.attr("appid")).attr("state")};$("body").append(HROS.template.renderFile("popupMenuTask.art",a));var i=$("body > .popup-menu:last-child");i.data(a);HROS.popupMenu.calcPosition(e,i)},desk:function(e){HROS.window.show2under();if(!HROS.template.checkCache("popupMenuDesk.art")){$("body").on("click",'.desk-menu a[menu="orderby"]:not(.disabled)',function(){HROS.app.updateXY($(this).attr("orderby"));HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="size"]:not(.disabled)',function(){HROS.app.updateSize($(this).attr("size"));HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="hideall"]',function(){HROS.window.hideAll();HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="closeall"]',function(){HROS.window.closeAll();HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="addfolder"]',function(){if(HROS.base.checkLogin()){swal({type:"input",title:"新建文件夹",showCancelButton:true,closeOnConfirm:false,confirmButtonText:"创建",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入文件夹名称"},function(e){if(e===false){return false}if(e===""){swal.showInputError("文件夹名称不能为空");return false}$.ajax({data:{ac:"addFolder",name:e,desk:HROS.CONFIG.desk}}).done(function(e){HROS.app.get();swal({type:"success",title:"创建成功",timer:2e3,showConfirmButton:false})})})}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="addpapp"]',function(){if(HROS.base.checkLogin()){dialog({id:"editdialog",title:"新建私人应用",url:"sysapp/dialog/papp.php?desk="+HROS.CONFIG.desk,padding:0,width:770,height:450}).showModal()}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="uploadfile"]',function(){HROS.window.createTemp({appid:"hoorayos-scwj",title:"上传文件",url:"sysapp/upload/index.php",width:750,height:600,isflash:false});HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="themes"]',function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isflash:false})}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="setting"]',function(){if(HROS.base.checkLogin()){HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"sysapp/desksetting/index.php",width:800,height:500,isflash:false})}else{HROS.base.login()}HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="lock"]',function(){HROS.lock.show();HROS.popupMenu.hide()});$("body").on("click",'.desk-menu a[menu="logout"]',function(){HROS.base.logout();HROS.popupMenu.hide()})}var t={xy:HROS.CONFIG.appXY,size:HROS.CONFIG.appSize};$("body").append(HROS.template.renderFile("popupMenuDesk.art",t));var a=$("body > .popup-menu:last-child");a.data(t);HROS.popupMenu.calcPosition(e,a)},hide:function(){$(".popup-menu").remove()}}}();HROS.searchBar=function(){return{init:function(){$("#pageletSearchInput").on("click",function(){return false});$("#search-suggest .resultBox").on("click","li",function(){switch($(this).attr("type")){case"window":HROS.window.create($(this).attr("appid"),$(this).attr("type"));break;case"widget":HROS.widget.create($(this).attr("appid"),$(this).attr("type"));break}});$("#search-suggest .openAppMarket a, #pageletSearchButton").on("click",function(){HROS.searchBar.openAppMarket($("#pageletSearchInput").val())});$("#pageletSearchInput").on("keydown",function(e){if(e.keyCode=="13"){if($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0){HROS.searchBar.openAppMarket($(this).val())}else{$("#search-suggest .resultList a.selected").click()}}})},get:function(){var e="";searchFunc=setInterval(function(){var t=$("#pageletSearchInput").val();if(t!=""){$("#search-suggest").show();if(t!=e){e=t;HROS.searchBar.getSuggest(t)}$("#search-bar").removeClass("above").addClass("above")}else{$("#search-suggest").hide();$("#search-bar").removeClass("above")}},1e3);HROS.searchBar.set();Mousetrap.bind(["up"],function(){if($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0){$("#search-suggest > .resultList:last a").addClass("selected")}else{if($("#search-suggest .resultBox .resultList:first a").hasClass("selected")){$("#search-suggest .resultList a").removeClass("selected")}else{if($("#search-suggest > .resultList a.selected").length!=0){var e=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");if(e>1){$("#search-suggest > .resultList:eq("+(e-1)+") a").addClass("selected")}else{$("#search-suggest .resultBox .resultList:last a").addClass("selected")}}else{var e=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");if(e>0){$("#search-suggest .resultBox .resultList:eq("+(e-1)+") a").addClass("selected")}}}}return false});Mousetrap.bind(["down"],function(){if($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0){if($("#search-suggest .resultBox .resultList").length==0){$("#search-suggest > .resultList:first a").addClass("selected")}else{$("#search-suggest .resultBox .resultList:first a").addClass("selected")}}else{if($("#search-suggest > .resultList:last a").hasClass("selected")){$("#search-suggest .resultList a").removeClass("selected")}else{if($("#search-suggest .resultBox .resultList a.selected").length!=0){var e=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");if(e<$("#search-suggest .resultBox .resultList").length-1){$("#search-suggest .resultBox .resultList:eq("+(e+1)+") a").addClass("selected")}else{$("#search-suggest > .resultList:first a").addClass("selected")}}else{var e=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");if(e<$("#search-suggest > .resultList").length-1){$("#search-suggest > .resultList:eq("+(e+1)+") a").addClass("selected")}else{$("#search-suggest .resultBox .resultList:first a").addClass("selected")}}}}return false});Mousetrap.bind(["backspace"],function(){})},set:function(){$("#search-bar").show();$("#search-suggest .resultList a").removeClass("selected");$("#pageletSearchInput").focus()},getSuggest:function(val){var apps=[];$(HROS.VAR.dock).each(function(){if($.inArray(this.type,["window","widget"])>=0){apps.push(this)}});for(var i=1;i<=5;i++){var desk=eval("HROS.VAR.desk"+i);$(desk).each(function(){if($.inArray(this.type,["window","widget"])>=0){apps.push(this)}})}$(HROS.VAR.folder).each(function(){$(this.apps).each(function(){if($.inArray(this.type,["window","widget"])>=0){apps.push(this)}})});var suggest="";$(apps).each(function(){if(this.name.indexOf(val)>=0){suggest+=HROS.template.suggest({name:this.name,appid:this.appid,realappid:this.realappid,type:this.type})}});$("#search-suggest .resultBox").html(suggest);if(suggest==""){$("#search-suggest .resultBox").hide()}else{$("#search-suggest .resultBox").show()}HROS.searchBar.set()},openAppMarket:function(e){if(e!=""){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?searchkey="+e,width:800,height:484,isflash:false,refresh:true})}HROS.searchBar.hide()},hide:function(){if(typeof searchFunc!="undefined"){clearInterval(searchFunc)}$("#search-bar").removeClass("above");$("#search-bar, #search-suggest").hide();$("#pageletSearchInput").val("");$("#search-suggest .resultBox").html("");Mousetrap.unbind(["up","down"])}}}();HROS.startMenu=function(){return{init:function(){HROS.startMenu.getAvatar();$("#startmenu-container").on("mousedown",function(e){e.preventDefault()});$("#startmenu-container .startmenu-nick a, #startmenu-container .startmenu-avatar img").on("click",function(){HROS.startMenu.openAccount()});$("#startmenu-container .startmenu-exit a").on("click",function(){HROS.base.logout()});$("#startmenu-container .startmenu-lock").on("click",function(){HROS.lock.show()});$("#startmenu-container .startmenu-feedback").on("click",function(){HROS.window.createTemp({appid:"hoorayos-feedback",title:"反馈",url:"http://hoorayos.com/feedback.html",width:700,height:500,isflash:false})});$("#startmenu-container .startmenu a").on("click",function(){switch($(this).attr("class")){case"about":HROS.copyright.show();break}})},getAvatar:function(){$.ajax({data:{ac:"getAvatar"}}).done(function(e){$("#startmenu-container .startmenu-avatar img").attr("src",e["avatar"]+"?"+Date.parse(new Date))})},openAccount:function(){if(HROS.CONFIG.memberID!=0){HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"sysapp/account/index.php",width:780,height:580})}else{HROS.base.login()}},show:function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchBar.hide();$("#startmenu-container").css({top:"auto",left:"auto",right:"auto",bottom:"auto"}).show();switch(HROS.CONFIG.dockPos){case"top":$("#startmenu-container").css({top:$("#dock-container").height()-1,right:$("#dock-container").offset().left});break;case"left":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,left:$("#dock-container").width()-1});break;case"right":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,right:$("#dock-container").width()-1});break}},hide:function(){$("#startmenu-container").hide()}}}();HROS.taskBar=function(){return{init:function(){$(window).on("resize",function(){HROS.taskBar.resize()});HROS.taskBar.move();HROS.taskBar.pageClick();$("#task-content-inner").on("contextmenu",".task-item",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();HROS.popupMenu.task(e,$(this));return false})},pageClick:function(){$("#task-next-btn").on("click",function(){if($(this).hasClass("disable")==false){var e=$("#task-content-inner .task-item").width();var t=parseInt($("#task-content-inner").css("margin-left"))-e;var a=$("#task-bar").width()-$("#task-next").outerWidth(true)-$("#task-prev").outerWidth(true)-$("#task-content-inner .task-item").length*e;if(t<=a){t=a;$("#task-next a").addClass("disable")}$("#task-prev a").removeClass("disable");$("#task-content-inner").animate({marginLeft:t},200)}});$("#task-prev-btn").on("click",function(){if($(this).hasClass("disable")==false){var e=$("#task-content-inner .task-item").width();var t=parseInt($("#task-content-inner").css("margin-left"))+e;if(t>=0){t=0;$("#task-prev a").addClass("disable")}$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginLeft:t},200)}})},resize:function(){if(HROS.CONFIG.dockPos=="left"){$("#task-bar").css({left:$("#dock-bar").width(),right:0})}else if(HROS.CONFIG.dockPos=="right"){$("#task-bar").css({left:0,right:$("#dock-bar").width()})}else{$("#task-bar").css({left:0,right:0})}var e=$("#task-content-inner .task-item").length*$("#task-content-inner .task-item").width();var t=$("#task-bar").width()-$("#task-next").outerWidth(true)-$("#task-prev").outerWidth(true);if(e>=t){$("#task-next, #task-prev").show();$("#task-content").css("width",t);$("#task-content-inner").stop(true,false).animate({marginLeft:0},200);$("#task-next a").removeClass("disable");$("#task-prev a").addClass("disable")}else{$("#task-next, #task-prev").hide();$("#task-content").css("width","100%");$("#task-content-inner").css({marginLeft:0})}},move:function(){$("#task-content-inner").on("mousedown",".task-item",function(e){e.preventDefault();e.stopPropagation();if(e.which==1){var t=$(this);var a=t.offset().left;var i=t.width();var o=t.clone().addClass("task-dragging").css({left:a});var n;var s=e.clientX;var r=e.clientX;var p=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(o);t.css("opacity",0);p.show();r=e.clientX;var n=r-s+a;o.css("left",n);$("#task-content-inner").find(".task-item").each(function(e){var a=$(this).offset().left;if(n>a&&n<a+i/2){if(t.attr("id")!=$(this).attr("id")){d($(this).attr("id"),"b")}}else if(n<a&&n>a-i/2){if(t.attr("id")!=$(this).attr("id")){d($(this).attr("id"),"a")}}})}).on("mouseup",function(e){$(document).off("mousemove").off("mouseup");p.hide();o.animate({left:t.offset().left},200,function(){$(this).remove();t.css("opacity",1)});if(s==r){if(t.hasClass("task-item-current")){HROS.window.hide(t.attr("appid"))}else{HROS.window.show2top(t.attr("appid"))}}});var d=function(e,a){if(!(t.is(":animated")&&n==e)){n=e;t.stop(true,true);$("#task-content-inner").find(".task-temp").remove();var o=t.clone().insertAfter(t).addClass("task-temp");if(a=="b"){$("#"+e).before(t.css({width:0}))}else{$("#"+e).after(t.css({width:0}))}t.animate({width:i},100);o.animate({width:0},100,function(){$(this).remove()})}}}})}}}();HROS.template=function(){return{checkCache:function(e){return HROS.templateCache.hasOwnProperty(e)?true:false},renderFile:function(e,t){var a;if(HROS.template.checkCache(e)){a=HROS.templateCache[e](t)}else{$.ajax({type:"GET",url:"static/template/"+e,dataType:"text",async:false}).done(function(i){var o=template.compile(i);a=o(t);HROS.templateCache[e]=o})}return a},app:function(e){return HROS.template.renderFile("app.art",e)},add:function(e){return HROS.template.renderFile("add.art",e)},task:function(e){return HROS.template.renderFile("task.art",e)},widget:function(e){return HROS.template.renderFile("widget.art",e)},window:function(e){return HROS.template.renderFile("window.art",e)},folder:function(e){return HROS.template.renderFile("folder.art",e)},folderView:function(e){return HROS.template.renderFile("folderView.art",e)},fileDownload:function(e){return HROS.template.renderFile("fileDownload.art",e)},suggest:function(e){return HROS.template.renderFile("suggest.art",e)},starDialog:function(e){return HROS.template.renderFile("starDialog.art",e)},lock:function(e){return HROS.template.renderFile("lock.art",e)}}}();HROS.wallpaper=function(){return{init:function(){HROS.wallpaper.set()},get:function(e){$.ajax({data:{ac:"getWallpaper"}}).done(function(t){var a=t["wallpaper"].split("<{|}>");HROS.CONFIG.wallpaperState=parseInt(a[0]);switch(HROS.CONFIG.wallpaperState){case 1:case 2:HROS.CONFIG.wallpaper=a[1];HROS.CONFIG.wallpaperType=a[2];HROS.CONFIG.wallpaperWidth=parseInt(a[3]);HROS.CONFIG.wallpaperHeight=parseInt(a[4]);break;case 3:HROS.CONFIG.wallpaper=a[1];break}e&&e()})},set:function(e){var e=typeof e=="undefined"?true:e;if(e){$("#zoomWallpaperGrid").attr("id","zoomWallpaperGrid-ready2remove").css("zIndex",-11);setTimeout(function(){$("#zoomWallpaperGrid-ready2remove").remove();$("#zoomWallpaperGrid").removeClass("radi")},1500)}var t=$(window).width(),a=$(window).height();switch(HROS.CONFIG.wallpaperState){case 1:case 2:switch(HROS.CONFIG.wallpaperType){case"pingpu":if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') repeat"></div>')}break;case"juzhong":if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') no-repeat 50% 50%"></div>')}break;case"tianchong":var i=(a-HROS.CONFIG.wallpaperHeight)/2,o=(t-HROS.CONFIG.wallpaperWidth)/2;if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+a+"px;width:"+t+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+HROS.CONFIG.wallpaperHeight+"px;width:"+HROS.CONFIG.wallpaperWidth+"px;top:"+i+"px;left:"+o+'px"><div style="position:absolute;height:'+a+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>')}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:a+"px",width:t+"px"});$("#zoomWallpaper").css({top:i+"px",left:o+"px"})}break;case"shiying":var n,s,i,o;if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth>a/t){n=a;s=HROS.CONFIG.wallpaperWidth*(a/HROS.CONFIG.wallpaperHeight);i=0;o=(t-s)/2}else if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth<a/t){s=t;n=HROS.CONFIG.wallpaperHeight*(t/HROS.CONFIG.wallpaperWidth);o=0;i=(a-n)/2}else{n=HROS.CONFIG.wallpaperHeight;s=HROS.CONFIG.wallpaperWidth;i=o=0}if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+a+"px;width:"+t+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+n+"px;width:"+s+"px;top:"+i+"px;left:"+o+'px"><div style="position:absolute;height:'+a+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>')}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:a+"px",width:t+"px"});$("#zoomWallpaper").css({height:n+"px",width:s+"px",top:i+"px",left:o+"px"})}break;case"lashen":if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+a+"px;width:"+t+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+a+"px;width:"+t+'px;top:0;left:0"><div style="position:absolute;height:'+a+"px;width:"+t+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>')}else{$("#zoomWallpaperGrid").css({height:a+"px",width:t+"px"}).children("#zoomWallpaper, div").css({height:a+"px",width:t+"px"})}break}break;case 3:if(e){$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div></div><iframe id="iframeWallpaper" frameborder="no" border="0" scrolling="no" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="'+HROS.CONFIG.wallpaper+'"></iframe></div>')}break}},update:function(e,t,a){function i(){HROS.wallpaper.get(function(){HROS.wallpaper.set()})}if(HROS.base.checkLogin()){$.ajax({data:{ac:"setWallpaper",wpstate:e,wptype:t,wp:a}}).done(function(e){i()})}else{i()}}}}();HROS.widget=function(){return{init:function(){HROS.widget.handle();HROS.widget.move();HROS.widget.reduction();$("#desk").on("mouseover",".widget",function(){$(this).children(".move").show()}).on("mouseout",".widget",function(){$(this).children(".move").hide()})},createTemp:function(e){var t=e.appid==null?Date.parse(new Date):e.appid;var a=false;$("#desk .widget").each(function(){if($(this).attr("appid")==t){a=true;return false}});if(!a){function i(e){var t="#w_"+e.appid;var a={width:e.width,height:e.height,type:"widgetTemp",id:"w_"+e.appid,appid:e.appid,realappid:e.appid,top:e.top,right:e.right,url:e.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:0};$("#desk").append(HROS.template.widget(a));$(t).data("info",a).css({opacity:0,scale:1.1}).transition({opacity:1,scale:1},200);HROS.CONFIG.widgetIndexid+=1}i({appid:t,url:e.url,width:e.width,height:e.height,top:e.top==null?0:e.top,right:e.right==null?0:e.right})}},create:function(e,t,a){var t=t==null?"widget":t;var i=false;$("#desk .widget").each(function(){if($(this).attr("appid")==e){i=true;return false}});if(!i&&$("#d_"+e).attr("opening")!=1){$("#d_"+e).attr("opening",1);function o(a){var i="#w_"+a.appid;if(HROS.widget.checkCookie(e,t)){var o=JSON.parse(Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID));$(o).each(function(){if(this.appid==a.appid&&this.type==a.type){a.top=this.top;a.right=this.right}})}else{HROS.widget.addCookie(a.appid,a.type,0,0)}var n={title:a.title,width:a.width,height:a.height,type:a.type,id:"w_"+a.appid,appid:a.appid,realappid:a.realappid==0?a.appid:a.realappid,top:typeof a.top=="undefined"?0:a.top,right:typeof a.right=="undefined"?0:a.right,url:a.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:1};$("#desk").append(HROS.template.widget(n));$(i).data("info",n).css({opacity:0,scale:1.1}).transition({opacity:1,scale:1},200);HROS.CONFIG.widgetIndexid+=1}$.ajax({data:{ac:"getMyAppById",id:e,type:t}}).done(function(i){if(i!=null){if(i["error"]=="ERROR_NOT_FOUND"){swal({type:"error",title:"小挂件不存在，建议删除",timer:2e3,showConfirmButton:false});HROS.widget.removeCookie(e,t)}else if(i["error"]=="ERROR_NOT_INSTALLED"){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+(a==null?$("#d_"+e).attr("realappid"):a),width:800,height:484,isflash:false,refresh:true});HROS.widget.removeCookie(e,t)}else{o({appid:i["appid"],realappid:i["realappid"],title:i["name"],url:i["url"],type:i["type"],width:i["width"],height:i["height"],top:0,right:0})}}else{swal({type:"error",title:"小挂件加载失败",timer:2e3,showConfirmButton:false})}$("#d_"+e).attr("opening",0)})}},reduction:function(){var e=Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID);if(typeof e!=="undefined"){e=JSON.parse(e);$(e).each(function(){HROS.widget.create(this.appid,this.type)})}},checkCookie:function(e,t){var a=false;var i=Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID);if(typeof i!=="undefined"){i=JSON.parse(i);$(i).each(function(){if(this.appid==e&&this.type==t){a=true}})}return a},addCookie:function(e,t,a,i){if(t=="widget"||t=="pwidget"){if(HROS.widget.checkCookie(e,t)){var o=JSON.parse(Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID));$(o).each(function(){if(this.appid==e&&this.type==t){this.top=a;this.right=i}})}else{var o=Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID);if(typeof o!=="undefined"){o=JSON.parse(o)}else{o=[]}o.push({appid:e,type:t,top:a,right:i})}Cookies.set(cookie_prefix+"widgetState"+HROS.CONFIG.memberID,$.toJSON(o),{expires:95})}},removeCookie:function(e,t){if(t=="widget"||t=="pwidget"){if(HROS.widget.checkCookie(e,t)){var a=JSON.parse(Cookies.get(cookie_prefix+"widgetState"+HROS.CONFIG.memberID));$(a).each(function(i){if(this.appid==e&&this.type==t){a.splice(i,1);return false}});Cookies.set(cookie_prefix+"widgetState"+HROS.CONFIG.memberID,$.toJSON(a),{expires:95})}}},move:function(){$("#desk").on("mousedown",".widget .move",function(e){var t=$(this).parents(".widget");HROS.widget.show2top(t.attr("appid"));var a=e.clientX-t.offset().left;var i=e.clientY-t.offset().top;var o;var n;var s;$(document).on("mousemove",function(e){o=HROS.maskBox.desk();o.show();n=e.clientY-i<0?0:e.clientY-i;s=$(window).width()-t.width()-(e.clientX-a);t.css({top:n,right:s})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof o!=="undefined"){o.hide()}if(t.attr("type")!="widgetTemp"){HROS.widget.addCookie(t.attr("appid"),t.attr("type"),n,s)}})})},close:function(e){var t="#w_"+e;HROS.widget.removeCookie($(t).attr("appid"),$(t).attr("type"));$(t).css({opacity:1,scale:1}).transition({opacity:0,scale:1.1},200,function(){$(this).removeData("info").html("").remove()})},show2top:function(e){var t="#w_"+e;$(t).css("z-index",HROS.CONFIG.widgetIndexid);HROS.CONFIG.widgetIndexid+=1},handle:function(){$("#desk").on("mousedown",".widget a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("click",".widget .ha-close",function(e){var t=$(this).parents(".widget");HROS.widget.close(t.attr("appid"))})}}}();HROS.window=function(){return{init:function(){HROS.window.handle();HROS.window.move();HROS.window.resize();$("#desk").on("click",".window-container .window-mask, .window-container .folder_body",function(){HROS.window.show2top($(this).parents(".window-container").attr("appid"),true)});$("#desk").on("contextmenu",".window-container",function(){return false});$("#desk").on("click",".folder_body li",function(){return false}).on("contextmenu",".folder_body .appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();switch($(this).attr("type")){case"window":case"widget":HROS.popupMenu.app(e,$(this));break;case"pwindow":case"pwidget":HROS.popupMenu.papp(e,$(this));break}return false})},createTemp:function(e){var t="window",a=e.appid==null?Date.parse(new Date):e.appid;var i=false;$("#task-content-inner .task-item").each(function(){if($(this).attr("appid")==a){i=true;HROS.window.show2top($(this).attr("appid"));return false}});if(!i){function o(e){var t="#w_"+e.appid;$("#task-content-inner").append(HROS.template.task({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.appid,title:e.title,imgsrc:e.imgsrc}));HROS.taskBar.resize();var a={top:($(window).height()-e.height)/2<=0?0:($(window).height()-e.height)/2,left:($(window).width()-e.width)/2<=0?0:($(window).width()-e.width)/2,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,width:e.width,height:e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.appid,title:e.title,url:e.url,imgsrc:e.imgsrc,isresize:e.isresize,isopenmax:e.isopenmax,istitlebar:e.isresize,istitlebarFullscreen:e.isresize?window.fullScreenApi.supportsFullScreen==true?true:false:false,issetbar:e.issetbar,isflash:e.isflash};$("#desk").append(HROS.template.window(a));$(t).data("info",a).css({opacity:0,scale:1.1}).transition({opacity:1,scale:1},200);HROS.CONFIG.windowIndexid+=1;HROS.window.show2top(e.appid)}o({type:t,appid:a,realappid:a,imgsrc:"static/img/default_icon.png",title:e.title,url:e.url,width:e.width,height:e.height,isresize:typeof e.isresize=="undefined"?false:e.isresize,isopenmax:typeof e.isopenmax=="undefined"?false:e.isopenmax,issetbar:false,isflash:typeof e.isflash=="undefined"?true:e.isflash})}else{if(e.refresh){var n="#w_"+a;$(n).find("iframe").attr("src",e.url)}}},create:function(e,t,a){var t=t==null?"window":t;var i=false;$("#task-content-inner .task-item").each(function(){if($(this).attr("appid")==e){i=true;HROS.window.show2top(e);return false}});if(!i&&$("#d_"+e).attr("opening")!=1){$("#d_"+e).attr("opening",1);function o(e){var t="#w_"+e.appid;var a=($(window).height()-e.height)/2<=0?0:($(window).height()-e.height)/2;var i=($(window).width()-e.width)/2<=0?0:($(window).width()-e.width)/2;switch(e.type){case"window":case"pwindow":$("#task-content-inner").append(HROS.template.task({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc}));HROS.taskBar.resize();var o={top:a,left:i,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,width:e.width,height:e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,url:e.url,imgsrc:e.imgsrc,isresize:e.isresize==1?true:false,isopenmax:e.isresize==1?e.isopenmax==1?true:false:false,istitlebar:e.isresize==1?true:false,istitlebarFullscreen:e.isresize==1?window.fullScreenApi.supportsFullScreen==true?true:false:false,issetbar:e.issetbar==1?true:false,isflash:e.isflash==1?true:false};$("#desk").append(HROS.template.window(o));$(t).data("info",o).css({opacity:0,scale:1.1}).transition({opacity:1,scale:1},200);HROS.CONFIG.windowIndexid+=1;HROS.window.show2top(e.appid);break;case"folder":$("#task-content-inner").append(HROS.template.task({type:e.type,id:"t_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc}));HROS.taskBar.resize();var n={top:a,left:i,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,width:e.width,height:e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc};$("#desk").append(HROS.template.folder(n));$(t).data("info",n).css({opacity:0,scale:1.1}).transition({opacity:1,scale:1},200);HROS.CONFIG.windowIndexid+=1;var s="";$(HROS.VAR.folder).each(function(){if(this.appid==e.appid){s=this.apps;return false}});if(s!=""){var r="";$(s).each(function(){r+=HROS.template.app({title:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,realappid:this.realappid,imgsrc:this.icon,appsize:48})});$(t).find(".folder_body").append(r)}HROS.window.show2top(e.appid);break;case"file":var p={top:a,left:i,emptyW:$(window).width()-e.width,emptyH:$(window).height()-e.height,width:e.width,height:e.height,zIndex:HROS.CONFIG.windowIndexid,type:e.type,id:"w_"+e.appid,appid:e.appid,realappid:e.realappid,title:e.title,imgsrc:e.imgsrc};$("body").append(HROS.template.fileDownload(p));break}}$.ajax({data:{ac:"getMyAppById",id:e,type:t}}).done(function(t){if(t!=null){if(t["error"]=="ERROR_NOT_FOUND"){swal({type:"error",title:"应用不存在，建议删除",timer:2e3,showConfirmButton:false})}else if(t["error"]=="ERROR_NOT_INSTALLED"){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+(a==null?$("#d_"+e).attr("realappid"):a),width:800,height:484,isflash:false,refresh:true})}else{o({type:t["type"],appid:t["appid"],realappid:t["realappid"],title:t["name"],imgsrc:t["icon"],url:t["url"],width:t["width"],height:t["height"],isresize:t["isresize"],isopenmax:t["isopenmax"],issetbar:t["issetbar"],isflash:t["isflash"]})}}else{swal({type:"error",title:"应用加载失败",timer:2e3,showConfirmButton:false})}$("#d_"+e).attr("opening",0)})}},setPos:function(){$("#desk .window-container").each(function(){var e=$(this).data("info");var t=$(window).width()-$(this).width();var a=$(window).height()-$(this).height();var i=e["left"]/e["emptyW"]*t>=t?t:e["left"]/e["emptyW"]*t;i=i<=0?0:i;var o=e["top"]/e["emptyH"]*a>=a?a:e["top"]/e["emptyH"]*a;o=o<=0?0:o;if($(this).attr("state")!="hide"){$(this).stop(true,false).animate({left:i,top:o},500,function(){e["left"]=i;e["top"]=o;e["emptyW"]=$(window).width()-$(this).width();e["emptyH"]=$(window).height()-$(this).height()})}else{e["left"]=i;e["top"]=o;e["emptyW"]=$(window).width()-$(this).width();e["emptyH"]=$(window).height()-$(this).height()}})},close:function(e){var t="#w_"+e,a="#t_"+e;$(t).css({opacity:1,scale:1}).transition({opacity:0,scale:1.1},200,function(){$(this).removeData("info").html("").remove()});$("#task-content-inner "+a).html("").remove();var i=true;$("#desk .window-container").each(function(){if($(this).attr("state")=="show"&&$(this).attr("ismax")==1){i=false}});if(i){$("#task-bar").removeClass("min-zIndex")}HROS.taskBar.resize()},closeAll:function(){$("#desk .window-container").each(function(){HROS.window.close($(this).attr("appid"))})},hide:function(e){var t="#w_"+e,a="#t_"+e;$(t).css({opacity:1,scale:1,y:0}).transition({opacity:0,scale:.9,y:50},200,function(){$(this).css("left",-1e4).attr("state","hide")});$("#task-content-inner "+a).removeClass("task-item-current");if($(t).attr("ismax")==1){$("#task-bar").removeClass("min-zIndex")}},hideAll:function(){$("#task-content-inner .task-item").removeClass("task-item-current");$("#desk-"+HROS.CONFIG.desk).nextAll("div.window-container").css("left",-1e4).attr("state","hide")},max:function(e){HROS.window.show2top(e);var t="#w_"+e,a="#t_"+e;$(t+" .title-handle .ha-max").hide().next(".ha-revert").show();$(t).addClass("window-maximize").attr("ismax",1).animate({width:"100%",height:"100%",top:0,left:0},200);$("#task-bar").addClass("min-zIndex")},revert:function(e){HROS.window.show2top(e);var t="#w_"+e,a="#t_"+e,i=$(t).data("info");$(t+" .title-handle .ha-revert").hide().prev(".ha-max").show();$(t).removeClass("window-maximize").attr("ismax",0).animate({width:i["width"],height:i["height"],left:i["left"],top:i["top"]},500);$("#task-bar").removeClass("min-zIndex")},refresh:function(e){HROS.window.show2top(e);var t="#w_"+e,a="#t_"+e;if($(t+"_iframe").length!=0){$(t+"_iframe").attr("src",$(t+"_iframe").attr("src"))}else{HROS.window.updateFolder(e)}},show2top:function(e,t){t=t==null?false:t;var a="#w_"+e,i="#t_"+e,o=$(a).data("info");var n=[];function s(){HROS.window.show2under();$("#task-content-inner "+i).addClass("task-item-current");if($(a).attr("ismax")==1){$("#task-bar").addClass("min-zIndex")}$(a).addClass("window-current").css({zIndex:HROS.CONFIG.windowIndexid,left:o["left"],top:o["top"]});if($(a).attr("ismax")==1){$(a).css({left:0,top:0})}$(a+" .window-mask").hide();$(a+" iframe").show();HROS.CONFIG.windowIndexid+=1;if($(a).attr("state")=="hide"){$(a).css({opacity:0,scale:.9,y:50}).transition({opacity:1,scale:1,y:0},200,function(){$(this).attr("state","show")})}}if(t){var r=$(a).offset().left,p=r+$(a).width();var d=$(a).offset().top,c=d+$(a).height();var l=r+$(a).width()/2,f=d+$(a).height()/2;var h=parseInt($(a).css("zIndex"));$("#desk .window-container:not("+a+")").each(function(){var e=$(this).offset().left,t=e+$(this).width();var a=$(this).offset().top,i=a+$(this).height();var o=e+$(this).width()/2,s=a+$(this).height()/2;var u=parseInt($(this).css("zIndex"));var k="";if(u>h){if(e>=r&&e<=p&&a>=d&&a<=c||e>=r&&e<=p&&i>=d&&i<=c||t>=r&&t<=p&&a>=d&&a<=c||t>=r&&t<=p&&i>=d&&i<=c){k="x"}if(e>=r&&e<=p&&a<d&&i>c||t>=r&&t<=p&&a<d&&i>c){k="x"}if(a>=d&&a<=c&&e<r&&t>p||i>=d&&i<=c&&e<r&&t>p){k="y"}if(e>=r&&e<=p&&i>=d&&i<=c&&(t>=r&&t<=p&&i>=d&&i<=c)||e>=r&&e<=p&&a>=d&&a<=c&&(t>=r&&t<=p&&a>=d&&a<=c)){k="y"}}if(k!=""){var w,O;if(k=="x"){if(o>l){w="right";O=p-e+30}else{w="left";O=t-r+30}}else{if(s>f){w="bottom";O=c-a+30}else{w="top";O=i-d+30}}n.push({id:$(this).attr("id"),direction:w,distance:O})}});var u=0;for(var k=0;k<n.length;k++){var w=$("#"+n[k].id).offset().left,O=$("#"+n[k].id).offset().top;if(n[k].direction=="left"){$("#"+n[k].id).delay(u).animate({left:w-n[k].distance},300).animate({left:w},300)}else if(n[k].direction=="right"){$("#"+n[k].id).delay(u).animate({left:w+n[k].distance},300).animate({left:w},300)}else if(n[k].direction=="top"){$("#"+n[k].id).delay(u).animate({top:O-n[k].distance},300).animate({top:O},300)}else if(n[k].direction=="bottom"){$("#"+n[k].id).delay(u).animate({top:O+n[k].distance},300).animate({top:O},300)}u+=100}setTimeout(s,u+100)}else{s()}},show2under:function(){$("#task-content-inner .task-item").removeClass("task-item-current");$("#desk .window-container").removeClass("window-current");$("#desk .window-container .window-mask").show();$("#desk .window-container-flash iframe").hide()},updateFolder:function(e){var t="#w_"+e,a="#t_"+e;var i="";$(HROS.VAR.folder).each(function(){if(this.appid==e){i=this.apps;return false}});if(i!=null){var o="";for(var n=0;n<i.length;n++){o+=HROS.template.app({top:0,left:0,title:i[n]["name"],type:i[n]["type"],id:"d_"+i[n]["appid"],appid:i[n]["appid"],realappid:i[n]["realappid"],imgsrc:i[n]["icon"],appsize:48})}$(t).find(".folder_body").html("").append(o).on("contextmenu",".appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();HROS.popupMenu.app(e,$(this));return false})}},handle:function(){$("#desk").on("mousedown",".window-container .title-bar .title-handle a, .window-container .set-bar a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("dblclick",".window-container .title-bar .title",function(e){console.log(1);var t=$(this).parents(".window-container");if(t.find(".ha-max").is(":hidden")){t.find(".ha-revert").click()}else{t.find(".ha-max").click()}}).on("click",".window-container .set-bar",function(){var e=$(this).parents(".window-container");HROS.window.show2top(e.attr("appid"))}).on("click",".window-container .ha-hide",function(){var e=$(this).parents(".window-container");HROS.window.hide(e.attr("appid"))}).on("click",".window-container .ha-max",function(){var e=$(this).parents(".window-container");HROS.window.max(e.attr("appid"))}).on("click",".window-container .ha-revert",function(){var e=$(this).parents(".window-container");HROS.window.revert(e.attr("appid"))}).on("click",".window-container .ha-fullscreen",function(){var e=$(this).parents(".window-container");window.fullScreenApi.requestFullScreen(document.getElementById(e.find("iframe").attr("id")))}).on("click",".window-container .ha-close",function(){var e=$(this).parents(".window-container");HROS.window.close(e.attr("appid"))}).on("click",".window-container .refresh",function(){var e=$(this).parents(".window-container");HROS.window.refresh(e.attr("appid"))}).on("click",".window-container .detail",function(){var e=$(this).parents(".window-container");if(e.attr("realappid")!==0){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"sysapp/appmarket/index.php?id="+e.attr("realappid"),width:800,height:484,isflash:false,refresh:true})}else{swal({type:"warning",title:"温馨提示",text:"该应用没有任何详细介绍",timer:2e3,showConfirmButton:false})}}).on("contextmenu",".window-container",function(){$(".popup-menu").hide();$(".quick_view_container").remove();return false})},move:function(){$("#desk").on("mousedown",".window-container .title-bar, .window-container .set-bar",function(e){var t=$(this).parents(".window-container");if(t.attr("ismax")==1){return false}HROS.window.show2top(t.attr("appid"));var a=t.data("info");var i=e.clientX-t.offset().left;var o=e.clientY-t.offset().top;var n;$(document).on("mousemove",function(e){n=HROS.maskBox.desk();n.show();t.find(".ha-revert").hide().prev(".ha-max").show();t.css({width:a["width"],height:a["height"],left:e.clientX-i,top:e.clientY-o<=10?0:e.clientY-o>=n.height()-30?n.height()-30:e.clientY-o});t.data("info").left=t.offset().left;t.data("info").top=t.offset().top}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof n!=="undefined"){n.hide()}})})},resize:function(e){$("#desk").on("mousedown",".window-container .window-resize",function(e){var t=$(this).parents(".window-container");var a=$(this);var i;var o=e.clientX;var n=e.clientY;var s=t.width();var r=t.height();$(document).on("mousemove",function(e){i=HROS.maskBox.desk();i.show();var p=e.clientX<=10?0:e.clientX>=i.width()-12?i.width()-2:e.clientX;var d=e.clientY<=10?0:e.clientY>=i.height()-12?i.height():e.clientY;switch(a.attr("resize")){case"t":r+n-d>HROS.CONFIG.windowMinHeight?t.css({height:r+n-d,top:d}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"r":s-o+p>HROS.CONFIG.windowMinWidth?t.css({width:s-o+p}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"b":r-n+d>HROS.CONFIG.windowMinHeight?t.css({height:r-n+d}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"l":s+o-p>HROS.CONFIG.windowMinWidth?t.css({width:s+o-p,left:p}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"rt":r+n-d>HROS.CONFIG.windowMinHeight?t.css({height:r+n-d,top:d}):t.css({height:HROS.CONFIG.windowMinHeight});s-o+p>HROS.CONFIG.windowMinWidth?t.css({width:s-o+p}):t.css({width:HROS.CONFIG.windowMinWidth});break;case"rb":s-o+p>HROS.CONFIG.windowMinWidth?t.css({width:s-o+p}):t.css({width:HROS.CONFIG.windowMinWidth});r-n+d>HROS.CONFIG.windowMinHeight?t.css({height:r-n+d}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"lt":s+o-p>HROS.CONFIG.windowMinWidth?t.css({width:s+o-p,left:p}):t.css({width:HROS.CONFIG.windowMinWidth});r+n-d>HROS.CONFIG.windowMinHeight?t.css({height:r+n-d,top:d}):t.css({height:HROS.CONFIG.windowMinHeight});break;case"lb":s+o-p>HROS.CONFIG.windowMinWidth?t.css({width:s+o-p,left:p}):t.css({width:HROS.CONFIG.windowMinWidth});r-n+d>HROS.CONFIG.windowMinHeight?t.css({height:r-n+d}):t.css({height:HROS.CONFIG.windowMinHeight});break}}).on("mouseup",function(){if(typeof i!=="undefined"){i.hide()}t.data("info").width=t.width();t.data("info").height=t.height();t.data("info").left=t.offset().left;t.data("info").top=t.offset().top;t.data("info").emptyW=$(window).width()-t.width();t.data("info").emptyH=$(window).height()-t.height();$(this).off("mousemove").off("mouseup")})})}}}();HROS.zoom=function(){return{init:function(){$("body").append('<div id="zoombox"></div>');swfobject.embedSWF("static/js/zoom.swf?onchange=HROS.zoom.check",document.getElementById("zoombox"),10,10,10,"expressInstall.swf","",{allowScriptAccess:"always",wmode:"transparent",scale:"noScale"},{id:"accessory_zoom",name:"zoom_detect"})},check:function(e){var t=e.scale,a=t>1?"放大":"缩小";if(t!=1){HROS.VAR.zoomLevel=t;$("#zoom-tip").show().find("span").text("您的浏览器目前处于"+a+"状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！")}else{if(t!=HROS.VAR.zoomLevel){$("#zoom-tip").fadeOut()}}},close:function(){$("#zoom-tip").remove()}}}();